<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en">


  <head>
    <meta http-equiv="Content-Type"
          content="text/html;charset=utf-8" />

    <title>
        Jes Closure Cut Flow
        &mdash;
        D0Wiki
    </title>

    
      
        <base href="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita/JESClosure/jesclosurecutflow" />
      
    

    <meta name="generator" content="Plone - http://plone.org" />

    <meta content="Jes Closure Cut Flow Description"
          name="description" />
    <meta content="Jes Closure Cut Flow Description"
          name="DC.description" />
    <meta content="kvita" name="DC.creator" />
    <meta content="2006-08-31 15:30:06"
          name="DC.date.created" />
    <meta content="2006-08-31 15:31:03"
          name="DC.date.modified" />
    <meta content="Document" name="DC.type" />
    <meta content="text/plain" name="DC.format" />

    <!-- Basic crude style for Netscape4.x - This can be removed
         if you don't want the special NS4 look - it will still work,
         just be plain text instead. Column layout for Netscape4.x included -->
    <link rel="Stylesheet" type="text/css"
          href="https://plone4.fnal.gov/P1/D0Wiki/ploneNS4.css" />

    <!-- Column style sheet. -->
    <style type="text/css" media="screen"><!-- @import url(https://plone4.fnal.gov/P1/D0Wiki/ploneColumns.css); --></style>

    <!-- Main style sheets for CSS2 capable browsers -->
    <style type="text/css" media="screen"><!-- @import url(https://plone4.fnal.gov/P1/D0Wiki/plone.css); --></style>

    <!-- Old style sheet from Plone 1.0, remove tal:condition="nothing" if you need to use the old styles.
         Will be removed in Plone 2.1. -->
    

    <!-- Alternate style sheets for the bigger/smaller text switcher -->
    <link rel="alternate stylesheet" type="text/css"
          media="screen"
          href="https://plone4.fnal.gov/P1/D0Wiki/ploneTextSmall.css"
          title="Small Text" />
    <link rel="alternate stylesheet" type="text/css"
          media="screen"
          href="https://plone4.fnal.gov/P1/D0Wiki/ploneTextLarge.css"
          title="Large Text" />

    <!-- Style sheet used for printing -->
    <link rel="stylesheet" type="text/css" media="print"
          href="https://plone4.fnal.gov/P1/D0Wiki/plonePrint.css" />

    <!-- Style sheet used for presentations (Opera is the only browser supporting this at the moment) -->
    <link rel="stylesheet" type="text/css"
          media="projection"
          href="https://plone4.fnal.gov/P1/D0Wiki/plonePresentation.css" />

    <!-- Internet Explorer CSS Fixes -->
    <!--[if IE]>
    <style type="text/css" media="all">@import url(https://plone4.fnal.gov/P1/D0Wiki/ploneIEFixes.css);</style>
    <![endif]-->


    <!-- Custom style sheet if available -->
    <style type="text/css" media="all"><!-- @import url(https://plone4.fnal.gov/P1/D0Wiki/ploneCustom.css); --></style>

    <link rel="shortcut icon"
          href="https://plone4.fnal.gov/P1/D0Wiki/favicon.ico"
          type="image/x-icon" />

    <link rel="search"
          href="https://plone4.fnal.gov/P1/D0Wiki/search_form"
          title="Search this site" />

    

    <link rel="up"
          href="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita/JESClosure"
          title="Up one level" />

    

    <!-- Disable IE6 image toolbar -->
    <meta http-equiv="imagetoolbar" content="no" />

    
      <!-- A slot where you can insert CSS in the header from a template -->
      
    

    

      
    
    
    
    
    


      
      <!-- A slot where you can insert elements in the header from a template -->
    

    
      <!-- A slot where you can insert javascript in the header from a template -->
      
    

    <!-- Common Plone ECMAScripts -->

    <!-- Pull-down ECMAScript menu, only active if logged in -->
    

    <!-- Define dynamic server-side variables for javascripts in this one  -->
    <script type="text/javascript"
            src="https://plone4.fnal.gov/P1/D0Wiki/plone_javascript_variables.js">
    </script>

    <script type="text/javascript"
            src="https://plone4.fnal.gov/P1/D0Wiki/plone_javascripts.js">
    </script>

    

      <!-- Old JS from Plone 1.0, remove tal:condition="nothing" if you need to use the old pop-ups.
           Will be removed in Plone 2.1 -->
      

    
  </head>

  <body class="section-Members">

    <div id="visual-portal-wrapper">

      <div id="portal-top">

        <a class="hiddenStructure"
           href="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita/JESClosure/jesclosurecutflow#documentContent">Skip to content</a>

           <ul id="portal-siteactions">

    <li id="siteaction-small_text"><a
    href="javascript:setActiveStyleSheet('Small Text', 1);"
    title="Small Text">Small Text</a></li>
    <li id="siteaction-normal_text"><a
    href="javascript:setActiveStyleSheet('', 1);"
    title="Normal Text">Normal Text</a></li>
    <li id="siteaction-large_text"><a
    href="javascript:setActiveStyleSheet('Large Text', 1);"
    title="Large Text">Large Text</a></li>

</ul>

           <div id="portal-searchbox">
    <form name="searchform"
          action="https://plone4.fnal.gov/P1/D0Wiki/search">
        <label for="searchGadget" class="hiddenStructure">Search</label>
        <input id="searchGadget" name="SearchableText"
               type="text" size="20" alt="Search"
               title="Search" accesskey="s"
               class="visibility:visible" tabindex="30001" />
        <input class="searchButton" type="submit"
               value="Search" accesskey="s" tabindex="30002" />
    </form>
</div>

           <h1 id="portal-logo">
    <a href="https://plone4.fnal.gov/P1/D0Wiki">D0Wiki</a>
</h1>

           <div id="portal-skinswitcher">
  
</div>

           
    <h5 class="hiddenStructure">Sections</h5>

    <ul id="portal-globalnav">
        
        <li id="portaltab-index_html" class="plain">
            <a href="https://plone4.fnal.gov/P1/D0Wiki"
               accesskey="t">Home</a>
        </li>
        
        
        <li id="portaltab-Members" class="selected">
            <a href="https://plone4.fnal.gov/P1/D0Wiki/Members"
               accesskey="t">Members</a>
        </li>
        
    </ul>



           

<h5 class="hiddenStructure">Personal tools</h5>

<ul id="portal-personaltools">
    

    <li class="portalNotLoggedIn">
              You are not logged in
    </li>

       
    
        <li>
            <a href="https://plone4.fnal.gov/P1/D0Wiki/login_form"
               accesskey="u">
               Log in
            </a>
        </li>
    

</ul>


           <div id="portal-breadcrumbs">

    You are here:
    
            <a href="https://plone4.fnal.gov/P1/D0Wiki/">Home</a>
            <span class="breadcrumbSeparator">&raquo;</span>
    
    
    <span>
        
            <a href="https://plone4.fnal.gov/P1/D0Wiki/Members/"
               accesskey="accesskeys-breadcrumbs">Members</a>
            <span class="breadcrumbSeparator"> &raquo; </span>
            
         
    </span>
    <span>
        
            <a href="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita/"
               accesskey="accesskeys-breadcrumbs">kvita's Home</a>
            <span class="breadcrumbSeparator"> &raquo; </span>
            
         
    </span>
    <span>
        
            <a href="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita/JESClosure/"
               accesskey="accesskeys-breadcrumbs">JES Closure package</a>
            <span class="breadcrumbSeparator"> &raquo; </span>
            
         
    </span>
    <span>
        
            
            
            <span>Jes Closure Cut Flow</span>
         
    </span>
</div>
      </div>

      <div class="visualClear"></div>

      <!-- The wrapper table. It contains the three columns. There's a table-less
           alternative in the plone_tableless skin layer that you can use if you
           prefer layouts that don't use tables. -->
      <table id="portal-columns">
        <tbody>
          <tr>
            <!-- start of the left (by default at least) column -->
            <td id="portal-column-one">
              <div class="visualPadding">
                
                  

    

        
            
        

        
    
    

        
            
    <div class="portlet" id="portlet-navigation-tree">
    <div>
        <h5>Navigation</h5>
        <div class="portletBody">
            <div class="portletContent odd">
                
                
                    
                        

                        <a href="https://plone4.fnal.gov/P1/D0Wiki/"
                           accesskey="n"
                           class="navItem navRootItem"
                           title="D0Wiki">
                            <img
    src="https://plone4.fnal.gov/P1/D0Wiki/site_icon.gif"
    height="16" width="16" alt="" class="navIconRoot"
    title="Plone Site" />
                            <span class="navItemText">
                                  Home
                            </span>
                        </a>
                    
                
                
                    
                        <a href="https://plone4.fnal.gov/P1/D0Wiki/Members/"
                           accesskey="n"
                           class="navItem navLevel1"
                           title="Container for portal members' home directories">
                            <img
    src="https://plone4.fnal.gov/P1/D0Wiki/folder_icon.gif"
    height="16" width="16" alt="" class="navIcon"
    title="Folder" />
                            <span class="navItemText">Members</span>
                        </a>

                        
                    
                
                
                    
                        <a href="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita/"
                           accesskey="n"
                           class="navItem navLevel2"
                           title="Home page area that contains the items created and collected by kvita">
                            <img
    src="https://plone4.fnal.gov/P1/D0Wiki/folder_icon.gif"
    height="16" width="16" alt="" class="navIcon"
    title="Folder" />
                            <span class="navItemText">kvita's Home</span>
                        </a>

                        
                    
                
                
                    
                        <a href="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita/JESClosure/"
                           accesskey="n"
                           class="navItem navLevel3 currentNavItem"
                           title="jes_closure package documentation">
                            <img
    src="https://plone4.fnal.gov/P1/D0Wiki/folder_icon.gif"
    height="16" width="16" alt="" class="navIcon"
    title="Folder" />
                            <span class="navItemText">JES Closure package</span>
                        </a>

                        
                    
                
                
            </div>
        </div>
    </div>
</div>

        

        
    
    

        
            

    

    <div class="portlet" id="portlet-login">

        <h5>Log in</h5>

        <div class="portletBody">

            <div class="portletContent odd">
                <form action="https://plone4.fnal.gov/P1/D0Wiki/logged_in"
                      name="loginform" method="post">

                    <input type="hidden" name="came_from"
                           value="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita/JESClosure/jesclosurecutflow"
                           tabindex="10001" />

                    <div class="field">
                        <label for="__ac_name">Name</label>
                        <br />
                        <input type="text" size="10"
    alt="Username" accesskey="accesskeys-login"
    tabindex="10002" name="__ac_name" value=""
    id="__ac_name" />
                    </div>
                    
                    <div class="field">
                        <label for="__ac_password">Password</label>
                        <br />
                        <input type="password" size="10"
    alt="Password" accesskey="l" tabindex="10003"
    name="__ac_password" id="__ac_password" />
                    </div>
                    
                    
                    <div class="formControls">
                    
                        <input class="context" type="submit"
    name="submit" value="Log in" alt="Log in"
    accesskey="accesskeys-login" tabindex="10004" />
                    </div>
                </form>
            </div>

            <div class="portletContent even">
                <a href="https://plone4.fnal.gov/P1/D0Wiki/mail_password_form"
                   accesskey="l">
                   <img src="https://plone4.fnal.gov/P1/D0Wiki/linkTransparent.gif" alt="" title="" longdesc="" height="11" width="6" />
                   Forgot your password?
                </a>
            </div>

            

        </div>

    </div>


        

        
    
    

        
            
        

        
    
    

        
            
        

        
    
    

        
            
        

        
    
    

        
            
        

        
    

                
                &nbsp;
              </div>
            </td>
            <!-- end of the left (by default at least) column -->

            <!-- start of main content block -->
            <td id="portal-column-content">

              
                <div id="content" class="">

                  

                  <div class="documentContent" id="region-content">

                    <a name="documentContent"></a>

                    

                    

                    
    
        <h1 class="documentFirstHeading">Jes Closure Cut Flow</h1>
    
        <div class="documentActions">

    <h5 class="hiddenStructure">Document Actions</h5>

    <ul>
    
        <li>
            <a href="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita/JESClosure/jesclosurecutflow/sendto_form">
            
                <img src="https://plone4.fnal.gov/P1/D0Wiki/mail_icon.gif"
                     alt="Send this page to somebody"
                     title="Send this page to somebody"
                     height="16" width="16" />
            </a>
        </li>
    
    
        <li>
            <a href="javascript:this.print();">
            
                <img src="https://plone4.fnal.gov/P1/D0Wiki/print_icon.gif"
                     alt="Print this page"
                     title="Print this page" height="16"
                     width="16" />
            </a>
        </li>
    

    </ul>

    

</div>
    
        <div class="documentDescription">Jes Closure Cut Flow Description</div>
    
        
    
        <div class="plain">
            <p>Main processor is ClosureTreeHistos.
It rus on skimmed or unskimmed data (original CAF trees).
Skimmed data are preferred and faster.
See MakeClosureTree.cpp, ClosureInput.cpp
and skimming configs like</p>
<p>makeClosureTreeData.config
makeClosureTreeMC_p17.09.01_refixed.config
makeClosureTreeMC_em-jet_p17.09.01_refixed.config</p>
<p>The cuts flow in ClosureTreeHistos.cpp:</p>
<p>Read config files.</p>
<p>MC config files use groups, so we do not want to return from each time of running the processor. Therefore we use if statements.
The only situations we return false are as follow:
<ul>
<li>no PV vertex collection is found 
 -  required final state flavour partons are not found.
 -  error running realistic particle jets (should not happen, could be in fact dangerous to leave this return! see ClosureTools MakeRealistic...)
Otherwise we always return true.</li>

</ul>
</p>
<p>JCCA or JCCB are to be run separately.
Eventually, we store all jets, be it Reco/particle/trackcaljets in the beginning, into a TLorentzVector array of GoodJets.</p>
<h2>Cuts flow, importat variables assignments:</h2>

<ul>
<li>Check Photon ID, enclose everything into an if statement.
   - check for asked gluaon or quark accompanying the photon (MC only).
   - if MC, get the truth gamma, we use this in particle jets mode, but also at reco level in Direct closure.
   - get Event and MC weights.
   - get Primary Vertices, return false if none exist.
   - get vertex z position, lumi or overlay lumi, MC pThat.
<ul>
<li>in the RECO case:
     - get skimmed/unskimmed photons, gamma deteta
     - if skimmed, get MET from skimmed tree.
     - Z option only partially supported at the moment...
     - scale MCReco photon if required, correct MET for it.
     - use the truth photon in MC reco otherwise (default)
     - TrackCalJets block: make track cal jets collection
<ul>
<li>Standard Reco jets: get them from the skimmed tree or get them from original CAF tree, check for good (but EM overlap is not checked! Works for dijets, perhaps also gamma jets, checking for good could be sufficient...need to check this; at least Jochen's bjet closure tests look OK.
       - get the old JES correction to MET
       - apply new JES by running jetcorr by hand in ClosureTools::DoJES(...): GoodRECOJets -> GoodCorrRECOJets
       - GoodJets = ClosureTools::MakeLorentz(GoodCorrRECOJets);
       - similarly for track cal jets
       - recompute MET in case of dijets, unskimmed trees.
       - recorrect MET for new JES
       - Get dijet jet indices (tag/probe)
       - follow the same in an (unused) option of not re-aplying JES (and use whatever is in CAF trees).
       - at each reco stage, compute jet detector eta from GoodCorrRECOJets or GoodRECOJets
       - _Nbadjets = BadRECOJets.size();</li>
<li>Particle jets:
       - a scatch of a Z option
       - get particle jets from skimmed tree or via ClosureInput::getParticleJets(...). This is crutial for signal MC, as we need to remove the particle jet associated with the photon! For dijets, it's in principle fine to use those directly from CAF trees. For running on mixer or emjet when using the reco photon with particle jets, one should also take the original particle jets and only remove the particle jet overlapping with the reco gamma.
<ul>
<li>Get the reco photon in case we need it in signal+background mixed sample
         -  get particle jets and particle phoon jets; merge them
         -  find the overlap of the reco photon to a particle jet, remove such jet from the collection</li>
<li>Standard particle jets:
         -      GoodJets = ClosureTools::MakeLorentz(ParticleJets);</li>
<li>Realistic particle jets:
         - prepare realistic particle MET
         - ClosureTools::MakeRealisticParticleJets(...). So far, one resolution for comparison to Data or MCReco. Needs an update.
         - Or: ClosureTools::MakeRealisticParticleJetsResponseOnly (not default)
         -      GoodJets = ClosureTools::MakeLorentz(RealisticJets);
         -      _Nbadjets = ParticleJets.size() - GoodJets.size();
         -      _Histos -> FillTH1F("dNjets", ParticleJets.size() - GoodJets.size());
         - Use realisic particles for dijet indices.   
       -  JetDetEta = GoodJets<a href="#refijetprobe">[ijetprobe]</a>.Eta();    </li>

</ul>
</li>
<li>Common code:
       - Use the Data Average GammaSF correction: this can be used for Data or for MC if we choose to run on the S+BG mixed sample. Correct the MET correspondingly.
       - 
     - Cuts:
       - Cal data quality for Reco (both Data and MC due to the MB overlay!)
       - nPVs > 0 (default, can set via config)
       - Exactly one photon / 2 EMs in isZ / found a dijet solution (oone CC jet in the first two leading ones)
       - possible Z mass window cut
       - at lest one jet (two in dijet case)
       - cut on maximal number of jets, which is at the moment 4 = nJetBins - 1; (HistoMaker.hpp: const int nJetBins = 5;)
       - optional cut on minimal number of jets
       - optin cut on max/min number of bad jets.
       - compute tag-probe delta phi.
       - only now we compute Eprime = theTagObj.Pt()*cosh(GoodJets<a href="#refijetprobe">[ijetprobe]</a>.Eta());
       - compute JetPt for binning; use average in dijets if requested.
       - do spectra reweighting if requested (e.g. njets, pT...). Needs to be tested!
       - delta phi cut: 3.0 default.
       - JetDetEta cuts for the probe jet (called leadjet i the code).
       - optionaly veto events with too forward jets.
       - photon in (CC) or (CC or EC).
       - compute which cal region the probe jet belongs to.
       - optionaly skip event if last pT jet has pT below specified raw pT cut. Not tested for some time.</li>
<li>Fill Histograms 
       - control print out's.
       - fill basic histograms.
       - in MCReco get particle jets (without photon matched jet) and match leading jet to a particle jet; fill the Direct imbalance.
       - Fill histograms with partial JES corrections.
       - compute imbalances (DeltaS, Hemi, MPF) and fill imbalance histos (DeltaS, Hemi, MPF, Direct).</li>

</ul>
</li>

</ul>
</li>

</ul>
<p>That's it!;-)</p>
<p>Documented by
(c) Jiri Kvita, 28-30th August 2006.</p>
<p>Code by 
(c) Dag Gillberg and Jiri Kvita, 2005 - 2006.</p>

        </div>
    
        <div class="documentByLine">

  

  <span>
    Created by
  </span>

  <a href="https://plone4.fnal.gov/P1/D0Wiki/Members/kvita">kvita</a>

  

  <br />

  

  

  <span>
    Last modified
  </span>
  2006-08-31 03:31 PM

  

</div>
    


                    
                      <div class="discussion">

    

        

        <form action="https://plone4.fnal.gov/P1/D0Wiki/login_form?came_from=https%3A//plone4.fnal.gov/P1/D0Wiki/Members/kvita/JESClosure/jesclosurecutflow">

            <input class="standalone" type="submit"
                   value="Log in to add comments" />
        </form>

        <a name="comments"> </a>


    

</div>
                    

                  </div>

                </div>

              
            </td>
            <!-- end of main content block -->

            <!-- start of right (by default at least) column -->
            
            <!-- end of the right (by default at least) column -->
          </tr>
        </tbody>
      </table>
      <!-- end column wrapper -->

      <div class="visualClear">&nbsp;</div>


      <hr class="netscape4" />

      
	<div id="portal-footer">


Plone and its visual design is Copyright &copy; 2000-<span>2009</span>
by
<a href="http://www.plonesolutions.com">Alexander Limi</a>,
<a href="http://www.enfoldsystems.com">Alan Runyan</a>,
<a href="http://blacktar.com">Vidar Andersen</a>.


</div>

	<div id="portal-colophon">
      <!--

	Please keep the Plone Powered button (or a textual link to us) if you use
	Plone on your site. It's a nice token of gratitude, and we appreciate your
	help in promoting the Plone name.

	Plone is powered by the combined forces of Zope and CMF, two absolutely
	great systems made by Zope Corporation (http://zope.com) and they in turn
	are based on the best programming language in the world - Python
	(http://www.python.org). We owe these guys a lot, thanks for making Plone
	possible!

      -->

      <a href="http://plone.org">
	<img src="https://plone4.fnal.gov/P1/D0Wiki/plone_powered.gif"
      height="15" width="80" alt="Powered by Plone"
      title="This Plone site was built using the Plone Content Management System. Click for more information." />
      </a>

      

      <p class="discreet">
	This site conforms to the following standards:
      </p>

      <ul>
	<li>
	  <a href="http://www.section508.gov">
	    <img src="https://plone4.fnal.gov/P1/D0Wiki/colophon_sec508.gif"
          height="15" width="80" alt="Section 508"
          title="This Plone site conforms to the US Government Section 508 Accessibility Guidelines." />
	  </a>
	</li>
	<li>
	  <a href="http://www.w3.org/WAI/WCAG1AA-Conformance"
      title="Explanation of WCAG Conformance">
	    <img src="https://plone4.fnal.gov/P1/D0Wiki/colophon_wai-aa.gif"
          height="15" width="80" alt="WCAG"
          title="This Plone site conforms to the W3C-WAI Web Content Accessibility Guidelines." />
	  </a>
	</li>
	<li>
	  <a href="http://validator.w3.org/check/referer">
	    <img src="https://plone4.fnal.gov/P1/D0Wiki/colophon_xhtml.png"
          height="15" width="80" alt="Valid XHTML"
          title="This Plone site is valid XHTML." />
	  </a>
	</li>
	<li>
	  <a href="http://jigsaw.w3.org/css-validator/check/referer">
	    <img src="https://plone4.fnal.gov/P1/D0Wiki/colophon_css.png"
          height="15" width="80" alt="Valid CSS"
          title="This Plone site was built with valid CSS." />
	  </a>
	</li>
	<li>
	  <a href="http://plone.org/browsersupport">
	    <img src="https://plone4.fnal.gov/P1/D0Wiki/colophon_anybrowser.png"
          height="15" width="80" alt="Usable in any browser"
          title="This Plone site is usable in any web browser." />
	  </a>
	</li>
      </ul>

    </div>
      

    </div>

  </body>
</html>


