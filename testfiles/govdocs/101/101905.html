<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>./atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx</title>
<base href="http://alxr.usatlas.bnl.gov/lxr/">
<link href="lxr.css" rel="STYLESHEET" type="text/css">
</head>

<body>
<table width='100%' border='0' cellpadding='0' cellspacing='0'>
  <tr>
    <td class=redcolor width='25%' valign='top'>
    Report problems to <a href="mailto:undrus@bnl.gov, yesw@bnl.gov, mccarthy@bnl.gov">ATLAS LXR Team</a> (with time and IP address indicated)
    </td>
    <td>
      <table width='100%' border='0' cellpadding='0' cellspacing='0'>
        <tr>
          <td align='center'>
            <h2>The LXR Cross Referencer</h2>
          </td>
        <tr>
          <td align="center"><span class="banner"><a class='banner' href="/lxr/source/">.</a>/ <a class='banner' href="/lxr/source/atlas/">atlas</a>/ <a class='banner' href="/lxr/source/atlas/InnerDetector/">InnerDetector</a>/ <a class='banner' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/">InDetAlignAlgs</a>/ <a class='banner' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/">InDetAlignGenAlgs</a>/ <a class='banner' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/">src</a>/ <a class='banner' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx">iTrkAlign.cxx</a></span></td>
        </tr>
      </table>
    </td>
    <td align='right'>
      
      [&nbsp;<span class='modes-sel'>source navigation</span>&nbsp;]<br>
      [&nbsp;<a class='modes' href="/lxr/diff/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx">diff markup</a>&nbsp;]<br>
      [&nbsp;<a class='modes' href="/lxr/ident">identifier search</a>&nbsp;]<br>
      [&nbsp;<a class="modes" href="/lxr/search">general search</a>&nbsp;]<br>
    </td>
  </tr>
  <tr><td colspan='3'>&nbsp;</td></tr>
  <tr>
   <td>&nbsp;</td>
   <td colspan='2'>
     <table width="100%" border="0" cellpadding='0' cellspacing='0'>
       
       <tr>
         <td align="left">
           Architecture:
         </td>
         <td align="right">
           
           [&nbsp;<span class="var-sel">linux</span>&nbsp;]
           <br>
         </td>
       </tr>
       <tr>
         <td align="left">
           Version:
         </td>
         <td align="right">
           
           [&nbsp;<a class='varlink' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx?v=head">head</a>&nbsp;]
           [&nbsp;<span class="var-sel">nightly</span>&nbsp;]
           [&nbsp;<a class='varlink' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx?v=GaudiDev">GaudiDev</a>&nbsp;]
           <br>
         </td>
       </tr>
     </table>
   </td>
  </tr>
  <tr><td>&nbsp;</td>
  <td>Links to LXR source navigation pages for stable releases</td>
  <td align="right">
  <a href="http://alxr.usatlas.bnl.gov/lxr-stb/source">[ 12.*.* ]</a>&nbsp;&nbsp;
  <a href="http://alxr.usatlas.bnl.gov/lxr-stb2/source">[ 13.*.* ]</a>&nbsp;&nbsp;
  <a href="http://alxr.usatlas.bnl.gov/lxr-stb3/source">[ 14.*.* ]</a>&nbsp;
  </td>
  </tr>
</table>

<hr>
<pre class="file">
<a name=001 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#001">001</a> <span class="comment">// iTrkAlign.cxx</span>
<a name=002 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#002">002</a> <span class="comment"></span><span class="comment">// Richard Hawkings, started 31/3/04</span>
<a name=003 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#003">003</a> <span class="comment"></span><span class="comment">// alignment ntuple methods specific to new Trk::Track class</span>
<a name=004 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#004">004</a> <span class="comment"></span>
<a name=005 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#005">005</a> 
<a name=006 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#006">006</a> #include "GaudiKernel/SmartDataPtr.h"
<a name=007 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#007">007</a> #include "GeneratorObjects/McEventCollection.h"
<a name=008 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#008">008</a> #include "InDetAlignTrkInfo/AlignTrkContainer.h"
<a name=009 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#009">009</a> #include "TrkTrack/Track.h"
<a name=010 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#010">010</a> #include "TrkTrack/TrackCollection.h"
<a name=011 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#011">011</a> #include "TrkTruthData/TrackTruthCollection.h"
<a name=012 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#012">012</a> #include "TrkMaterialOnTrack/MaterialEffectsOnTrack.h"
<a name=013 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#013">013</a> #include "TrkMaterialOnTrack/ScatteringAngles.h" 
<a name=014 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#014">014</a> #include "TrkParameters/MeasuredPerigee.h"
<a name=015 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#015">015</a> #include "TrkRIO_OnTrack/RIO_OnTrack.h"
<a name=016 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#016">016</a> #include "InDetRIO_OnTrack/SiClusterOnTrack.h"
<a name=017 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#017">017</a> #include "InDetRIO_OnTrack/TRT_DriftCircleOnTrack.h"
<a name=018 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#018">018</a> #include "TrkEventPrimitives/ParamDefs.h"
<a name=019 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#019">019</a> #include "TrkExInterfaces/IExtrapolator.h"
<a name=020 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#020">020</a> #include "TrkEventPrimitives/PropDirection.h"
<a name=021 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#021">021</a> #include "TrkPrepRawData/PrepRawData.h"
<a name=022 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#022">022</a> #include "InDetPrepRawData/TRT_DriftCircle.h"
<a name=023 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#023">023</a> #include "InDetIdentifier/PixelID.h"
<a name=024 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#024">024</a> #include "InDetIdentifier/SCT_ID.h"
<a name=025 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#025">025</a> #include "InDetIdentifier/TRT_ID.h"
<a name=026 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#026">026</a> #include "InDetAlignGenAlgs/AlignSiModuleList.h"
<a name=027 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#027">027</a> #include "InDetAlignGenTools/InDetAlignTrackSelTool.h"
<a name=028 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#028">028</a> #include "InDetAlignGenAlgs/InDetAlignNt.h"
<a name=029 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#029">029</a> #include "TrkPseudoMeasurementOnTrack/PseudoMeasurementOnTrack.h"
<a name=030 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#030">030</a> 
<a name=031 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#031">031</a> 
<a name=032 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#032">032</a> 
<a name=033 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#033">033</a> 
<a name=034 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#034">034</a> <span class="comment">// max hits on a track for fixed size scatterer arrays</span>
<a name=035 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#035">035</a> <span class="comment"></span>#define <a class='fid' href="/lxr/ident?i=MAXHITS">MAXHITS</a> 60
<a name=036 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#036">036</a> 
<a name=037 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#037">037</a> <span class='reserved'>void</span> <a class='fid' href="/lxr/ident?i=InDetAlignNt">InDetAlignNt</a>::<a class='fid' href="/lxr/ident?i=FillFromTrkTrack">FillFromTrkTrack</a>(<a class='fid' href="/lxr/ident?i=AlignTrkContainer">AlignTrkContainer</a>* <a class='fid' href="/lxr/ident?i=tracks">tracks</a>, <span class='reserved'>int</span>&amp; <a class='fid' href="/lxr/ident?i=ntrk">ntrk</a>) {
<a name=038 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#038">038</a>   <span class="comment">// retrieve all tracks from TDS</span>
<a name=039 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#039">039</a> <span class="comment"></span>  <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=DataVector">DataVector</a>&lt;<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Track">Track</a>&gt;* <a class='fid' href="/lxr/ident?i=trks">trks</a>;
<a name=040 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#040">040</a>   <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=StatusCode">StatusCode</a>::<a class='fid' href="/lxr/ident?i=SUCCESS">SUCCESS</a>!=<a class='fid' href="/lxr/ident?i=evtStore">evtStore</a>()-&gt;<a class='fid' href="/lxr/ident?i=retrieve">retrieve</a>(<a class='fid' href="/lxr/ident?i=trks">trks</a>,<a class='fid' href="/lxr/ident?i=par_newtrkcol">par_newtrkcol</a>)) {
<a name=041 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#041">041</a>     <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"Cannot find "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=par_newtrkcol">par_newtrkcol</a>  &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=042 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#042">042</a>    
<a name=043 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#043">043</a>   } <span class='reserved'>else</span> {
<a name=044 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#044">044</a>     <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a> ( <span class='string'>"New track filling called found "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=trks">trks</a>-&gt;<a class='fid' href="/lxr/ident?i=size">size</a>() );
<a name=045 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#045">045</a>     <span class="comment">// setup track selection map if needed</span>
<a name=046 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#046">046</a> <span class="comment"></span>    <span class="comment">// no longer needed </span>
<a name=047 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#047">047</a> <span class="comment"></span>    <span class="comment">// if (par_trksel) m_trkseltool-&gt;fillMap(trks);</span>
<a name=048 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#048">048</a> <span class="comment"></span>
<a name=049 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#049">049</a>     <span class='reserved'>for</span> (<a class='fid' href="/lxr/ident?i=DataVector">DataVector</a>&lt;<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Track">Track</a>&gt;::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> <a class='fid' href="/lxr/ident?i=t">t</a>=<a class='fid' href="/lxr/ident?i=trks">trks</a>-&gt;<a class='fid' href="/lxr/ident?i=begin">begin</a>(); 
<a name=050 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#050">050</a>          <a class='fid' href="/lxr/ident?i=t">t</a>!=<a class='fid' href="/lxr/ident?i=trks">trks</a>-&gt;<a class='fid' href="/lxr/ident?i=end">end</a>();++<a class='fid' href="/lxr/ident?i=t">t</a>) {
<a name=051 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#051">051</a>       ++<a class='fid' href="/lxr/ident?i=ntrk">ntrk</a>;
<a name=052 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#052">052</a>       <span class='reserved'>bool</span> <a class='fid' href="/lxr/ident?i=status">status</a>=<span class='reserved'>false</span>;
<a name=053 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#053">053</a>       <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=iTrkTrkSel">iTrkTrkSel</a>(*<a class='fid' href="/lxr/ident?i=t">t</a>)) {
<a name=054 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#054">054</a>         <a class='fid' href="/lxr/ident?i=AlignTrk">AlignTrk</a>* atp=<span class='reserved'>new</span> <a class='fid' href="/lxr/ident?i=AlignTrk">AlignTrk</a>(<a class='fid' href="/lxr/ident?i=TrkTrkProc">TrkTrkProc</a>(<a class='fid' href="/lxr/ident?i=trks">trks</a>,*<a class='fid' href="/lxr/ident?i=t">t</a>,<a class='fid' href="/lxr/ident?i=ntrk">ntrk</a>,<a class='fid' href="/lxr/ident?i=status">status</a>));
<a name=055 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#055">055</a>         <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=status">status</a>) {
<a name=056 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#056">056</a>           <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=par_alignnt">par_alignnt</a>) <a class='fid' href="/lxr/ident?i=FillTrkNtuple">FillTrkNtuple</a>(*atp);
<a name=057 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#057">057</a>           <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=par_overlap">par_overlap</a>) {
<a name=058 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#058">058</a>             <a class='fid' href="/lxr/ident?i=OverlapProc">OverlapProc</a>(*atp);
<a name=059 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#059">059</a>             <a class='fid' href="/lxr/ident?i=FillOverlap">FillOverlap</a>(*atp);
<a name=060 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#060">060</a>           }
<a name=061 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#061">061</a>           <a class='fid' href="/lxr/ident?i=tracks">tracks</a>-&gt;<a class='fid' href="/lxr/ident?i=push_back">push_back</a>(atp);
<a name=062 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#062">062</a>         }
<a name=063 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#063">063</a>       }
<a name=064 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#064">064</a>       <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Exec loop for track "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=ntrk">ntrk</a> );
<a name=065 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#065">065</a>     }
<a name=066 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#066">066</a>   }
<a name=067 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#067">067</a>   <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=INFO">INFO</a>)&lt;&lt;<span class='string'>"Created a total of "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=tracks">tracks</a>-&gt;<a class='fid' href="/lxr/ident?i=size">size</a>() &lt;&lt; <span class='string'>" aligntrks"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=068 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#068">068</a> }
<a name=069 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#069">069</a> 
<a name=070 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#070">070</a> <span class='reserved'>bool</span> <a class='fid' href="/lxr/ident?i=InDetAlignNt">InDetAlignNt</a>::<a class='fid' href="/lxr/ident?i=iTrkTrkSel">iTrkTrkSel</a>(<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Track">Track</a>* <a class='fid' href="/lxr/ident?i=pnt">pnt</a>) {
<a name=071 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#071">071</a>   <span class="comment">// selection for alignment quality tracks</span>
<a name=072 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#072">072</a> <span class="comment"></span>  <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=par_trksel">par_trksel</a>) {
<a name=073 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#073">073</a>     <span class='reserved'>return</span> (<a class='fid' href="/lxr/ident?i=m_trkseltool">m_trkseltool</a>-&gt;<a class='fid' href="/lxr/ident?i=getStatus">getStatus</a>(*<a class='fid' href="/lxr/ident?i=pnt">pnt</a>)!=<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=074 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#074">074</a>   } <span class='reserved'>else</span> {
<a name=075 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#075">075</a>     <span class="comment">// native selection</span>
<a name=076 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#076">076</a> <span class="comment"></span>    <span class="comment">// only selection on momentum currently implemented, no hole/shared info</span>
<a name=077 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#077">077</a> <span class="comment"></span>    <span class='reserved'>bool</span> momok;
<a name=078 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#078">078</a> 
<a name=079 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#079">079</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MeasuredPerigee">MeasuredPerigee</a> *mesp = <a class='fid' href="/lxr/ident?i=0">0</a>;
<a name=080 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#080">080</a>     <a class='fid' href="/lxr/ident?i=DataVector">DataVector</a>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>&gt;::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> tsos_it =
<a name=081 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#081">081</a>       <a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=begin">begin</a>();
<a name=082 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#082">082</a>     <a class='fid' href="/lxr/ident?i=DataVector">DataVector</a>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>&gt;::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> tsos_end =
<a name=083 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#083">083</a>       <a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=end">end</a>();
<a name=084 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#084">084</a>     <span class='reserved'>for</span> (; tsos_it != tsos_end; ++tsos_it) {
<a name=085 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#085">085</a>       <span class='reserved'>if</span> ((**tsos_it).<a class='fid' href="/lxr/ident?i=type">type</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>::<a class='fid' href="/lxr/ident?i=Perigee">Perigee</a>))
<a name=086 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#086">086</a>         mesp = <span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MeasuredPerigee">MeasuredPerigee</a> *&gt;((**tsos_it).<a class='fid' href="/lxr/ident?i=trackParameters">trackParameters</a>());
<a name=087 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#087">087</a>     }
<a name=088 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#088">088</a> 
<a name=089 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#089">089</a>     <span class='reserved'>if</span> (mesp!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=090 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#090">090</a>       momok=(<a class='fid' href="/lxr/ident?i=fabs">fabs</a>(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>])/
<a name=091 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#091">091</a>              <a class='fid' href="/lxr/ident?i=sin">sin</a>(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>]) &lt; <a class='fid' href="/lxr/ident?i=1">1</a>/<a class='fid' href="/lxr/ident?i=par_ptmin">par_ptmin</a>);
<a name=092 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#092">092</a>     } <span class='reserved'>else</span> {
<a name=093 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#093">093</a>       momok=<span class='reserved'>false</span>;
<a name=094 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#094">094</a>     }
<a name=095 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#095">095</a>     <span class='reserved'>return</span> momok;
<a name=096 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#096">096</a>   }
<a name=097 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#097">097</a> }
<a name=098 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#098">098</a> 
<a name=099 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#099">099</a> <a class='fid' href="/lxr/ident?i=AlignTrk">AlignTrk</a> <a class='fid' href="/lxr/ident?i=InDetAlignNt">InDetAlignNt</a>::<a class='fid' href="/lxr/ident?i=TrkTrkProc">TrkTrkProc</a>(<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=DataVector">DataVector</a>&lt;<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Track">Track</a>&gt;* <a class='fid' href="/lxr/ident?i=trks">trks</a>,
<a name=100 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#100">100</a>                                   <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Track">Track</a>* <a class='fid' href="/lxr/ident?i=pnt">pnt</a>,<span class='reserved'>const</span> <span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=nt">nt</a>,<span class='reserved'>bool</span>&amp; <a class='fid' href="/lxr/ident?i=status">status</a>) {
<a name=101 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#101">101</a>   <a class='fid' href="/lxr/ident?i=AlignTrk">AlignTrk</a> aligntrk;
<a name=102 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#102">102</a>   <a class='fid' href="/lxr/ident?i=SetCommon">SetCommon</a>(aligntrk,<a class='fid' href="/lxr/ident?i=nt">nt</a>);
<a name=103 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#103">103</a>   <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"TrkTrkProc for track "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=nt">nt</a> );
<a name=104 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#104">104</a>   <a class='fid' href="/lxr/ident?i=ATH_MSG_VERBOSE">ATH_MSG_VERBOSE</a>(*<a class='fid' href="/lxr/ident?i=pnt">pnt</a> );
<a name=105 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#105">105</a> 
<a name=106 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#106">106</a>     <span class="comment">//  msg &lt;&lt; MSG::VERBOSE &lt;&lt; *pnt &lt;&lt; endreq;</span>
<a name=107 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#107">107</a> <span class="comment"></span>
<a name=108 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#108">108</a>   <span class="comment">// track parameters</span>
<a name=109 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#109">109</a> <span class="comment"></span>  <span class='reserved'>float</span> <a class='fid' href="/lxr/ident?i=dx1">dx1</a>=<a class='fid' href="/lxr/ident?i=1">1</a>.;
<a name=110 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#110">110</a>   <span class='reserved'>float</span> <a class='fid' href="/lxr/ident?i=dx2">dx2</a>=<a class='fid' href="/lxr/ident?i=1">1</a>.;
<a name=111 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#111">111</a>   <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MeasuredPerigee">MeasuredPerigee</a> *mesp = <a class='fid' href="/lxr/ident?i=0">0</a>;
<a name=112 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#112">112</a>   <a class='fid' href="/lxr/ident?i=DataVector">DataVector</a>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>&gt;::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> tsos_it =
<a name=113 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#113">113</a>     <a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=begin">begin</a>();
<a name=114 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#114">114</a>   <a class='fid' href="/lxr/ident?i=DataVector">DataVector</a>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>&gt;::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> tsos_end =
<a name=115 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#115">115</a>     <a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=end">end</a>();
<a name=116 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#116">116</a>   <span class='reserved'>for</span> (; tsos_it != tsos_end; ++tsos_it) {
<a name=117 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#117">117</a>     <span class='reserved'>if</span> ((**tsos_it).<a class='fid' href="/lxr/ident?i=type">type</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>::<a class='fid' href="/lxr/ident?i=Perigee">Perigee</a>))
<a name=118 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#118">118</a>       mesp = <span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MeasuredPerigee">MeasuredPerigee</a> *&gt;((**tsos_it).<a class='fid' href="/lxr/ident?i=trackParameters">trackParameters</a>());
<a name=119 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#119">119</a>   }
<a name=120 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#120">120</a> 
<a name=121 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#121">121</a>   <span class='reserved'>if</span> (mesp!=<a class='fid' href="/lxr/ident?i=NULL">NULL</a>) {
<a name=122 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#122">122</a> 
<a name=123 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#123">123</a>     <span class='reserved'>double</span> <a class='fid' href="/lxr/ident?i=d0">d0</a> = mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=d0">d0</a>];
<a name=124 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#124">124</a>     <span class='reserved'>double</span> <a class='fid' href="/lxr/ident?i=z0">z0</a> = mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=z0">z0</a>];
<a name=125 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#125">125</a>     <span class='reserved'>double</span> <a class='fid' href="/lxr/ident?i=phi0">phi0</a> = mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi0">phi0</a>];
<a name=126 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#126">126</a>     <span class='reserved'>double</span> <a class='fid' href="/lxr/ident?i=theta">theta</a> = mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>];
<a name=127 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#127">127</a>     <span class='reserved'>double</span> <a class='fid' href="/lxr/ident?i=qOverP">qOverP</a> = mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>];
<a name=128 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#128">128</a>     
<a name=129 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#129">129</a>     <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <a class='fid' href="/lxr/ident?i=nt">nt</a> &lt;&lt; <span class='string'>". Track Parameters (d0, z0, phi0, theta, q/p)"</span> );
<a name=130 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#130">130</a>     <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>" "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=d0">d0</a> &lt;&lt; <span class='string'>", "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=z0">z0</a>  &lt;&lt; <span class='string'>", "</span> 
<a name=131 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#131">131</a>         &lt;&lt; <a class='fid' href="/lxr/ident?i=phi0">phi0</a> &lt;&lt; <span class='string'>", "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=theta">theta</a>  &lt;&lt; <span class='string'>", "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=qOverP">qOverP</a> );
<a name=132 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#132">132</a> 
<a name=133 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#133">133</a>     <span class="comment">// transform back to coth(theta), q/pt representation for alignment ntuple</span>
<a name=134 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#134">134</a> <span class="comment"></span>    <a class='fid' href="/lxr/ident?i=dx1">dx1</a>=<a class='fid' href="/lxr/ident?i=1">1</a>./(<a class='fid' href="/lxr/ident?i=pow">pow</a>(<a class='fid' href="/lxr/ident?i=cos">cos</a>(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>]),2));
<a name=135 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#135">135</a>     <a class='fid' href="/lxr/ident?i=dx2">dx2</a>=<a class='fid' href="/lxr/ident?i=1">1</a>./<a class='fid' href="/lxr/ident?i=sin">sin</a>(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>]);
<a name=136 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#136">136</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkpar">set_trkpar</a>(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=d0">d0</a>],<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=137 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#137">137</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkpar">set_trkpar</a>(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=z0">z0</a>],2);
<a name=138 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#138">138</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkpar">set_trkpar</a>(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>],3);
<a name=139 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#139">139</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkpar">set_trkpar</a>(<a class='fid' href="/lxr/ident?i=1">1</a>/<a class='fid' href="/lxr/ident?i=tan">tan</a>(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>]),4);
<a name=140 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#140">140</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkpar">set_trkpar</a>(<a class='fid' href="/lxr/ident?i=dx2">dx2</a>*(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>]),5);
<a name=141 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#141">141</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=ErrorMatrix">ErrorMatrix</a>&amp; ermatrix=mesp-&gt;<a class='fid' href="/lxr/ident?i=localErrorMatrix">localErrorMatrix</a>();
<a name=142 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#142">142</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=d0">d0</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=d0">d0</a>),<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=143 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#143">143</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=z0">z0</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=d0">d0</a>),2);
<a name=144 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#144">144</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=z0">z0</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=z0">z0</a>),3);
<a name=145 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#145">145</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=d0">d0</a>),4);
<a name=146 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#146">146</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=z0">z0</a>),5);
<a name=147 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#147">147</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>),6);
<a name=148 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#148">148</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=dx1">dx1</a>*ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=d0">d0</a>),7);
<a name=149 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#149">149</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=dx1">dx1</a>*ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=z0">z0</a>),8);
<a name=150 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#150">150</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=dx1">dx1</a>*ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>),9);
<a name=151 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#151">151</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=dx1">dx1</a>*<a class='fid' href="/lxr/ident?i=dx1">dx1</a>*ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>),10);
<a name=152 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#152">152</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=dx2">dx2</a>*ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=d0">d0</a>),11);
<a name=153 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#153">153</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=dx2">dx2</a>*ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=z0">z0</a>),12);
<a name=154 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#154">154</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=dx2">dx2</a>*ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>),13);
<a name=155 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#155">155</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=dx1">dx1</a>*<a class='fid' href="/lxr/ident?i=dx2">dx2</a>*ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>),14);
<a name=156 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#156">156</a>     aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=dx2">dx2</a>*<a class='fid' href="/lxr/ident?i=dx2">dx2</a>*ermatrix.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>),15);
<a name=157 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#157">157</a>   } <span class='reserved'>else</span> {
<a name=158 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#158">158</a>     <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"Could not get Trk::MeasuredPerigee"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=159 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#159">159</a>     <span class='reserved'>for</span> (<span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=i">i</a>=<a class='fid' href="/lxr/ident?i=1">1</a>;<a class='fid' href="/lxr/ident?i=i">i</a>&lt;=5;++<a class='fid' href="/lxr/ident?i=i">i</a>) aligntrk.<a class='fid' href="/lxr/ident?i=set_trkpar">set_trkpar</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=i">i</a>);
<a name=160 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#160">160</a>     <span class='reserved'>for</span> (<span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=i">i</a>=<a class='fid' href="/lxr/ident?i=1">1</a>;<a class='fid' href="/lxr/ident?i=i">i</a>&lt;=15;++<a class='fid' href="/lxr/ident?i=i">i</a>) aligntrk.<a class='fid' href="/lxr/ident?i=set_trkcov">set_trkcov</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=i">i</a>);
<a name=161 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#161">161</a>   }
<a name=162 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#162">162</a> 
<a name=163 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#163">163</a>   <span class="comment">// truth info</span>
<a name=164 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#164">164</a> <span class="comment"></span>  <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=par_truth">par_truth</a>) <a class='fid' href="/lxr/ident?i=TrkSetTruth">TrkSetTruth</a>(<a class='fid' href="/lxr/ident?i=trks">trks</a>,<a class='fid' href="/lxr/ident?i=pnt">pnt</a>,aligntrk);
<a name=165 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#165">165</a>   <span class='reserved'>bool</span> outofslice=<span class='reserved'>false</span>;
<a name=166 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#166">166</a> 
<a name=167 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#167">167</a>   <span class="comment">// make a preliminary table of trackpar and scatterers, with positions</span>
<a name=168 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#168">168</a> <span class="comment"></span>  <span class="comment">// this is needed for the iPatRec track model where scatters and trackpars</span>
<a name=169 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#169">169</a> <span class="comment"></span>  <span class="comment">// are not associated to RIO_OnTracks</span>
<a name=170 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#170">170</a> <span class="comment"></span>  <span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=nscat">nscat</a>=<a class='fid' href="/lxr/ident?i=0">0</a>;
<a name=171 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#171">171</a>   <span class='reserved'>int</span> nhitscat[<a class='fid' href="/lxr/ident?i=MAXHITS">MAXHITS</a>];
<a name=172 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#172">172</a>   <a class='fid' href="/lxr/ident?i=HepPoint3D">HepPoint3D</a> posscat[<a class='fid' href="/lxr/ident?i=MAXHITS">MAXHITS</a>];
<a name=173 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#173">173</a>   <span class="comment">// reset the curvature measurement from the TRT segment:</span>
<a name=174 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#174">174</a> <span class="comment"></span>  aligntrk.<a class='fid' href="/lxr/ident?i=set_trtcons">set_trtcons</a>(<a class='fid' href="/lxr/ident?i=0">0</a>., <a class='fid' href="/lxr/ident?i=0">0</a>.);
<a name=175 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#175">175</a>   <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* tparpscat[<a class='fid' href="/lxr/ident?i=MAXHITS">MAXHITS</a>];
<a name=176 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#176">176</a>   <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=ScatteringAngles">ScatteringAngles</a>* saospscat[<a class='fid' href="/lxr/ident?i=MAXHITS">MAXHITS</a>];
<a name=177 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#177">177</a> 
<a name=178 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#178">178</a>   <span class='reserved'>for</span> (<a class='fid' href="/lxr/ident?i=std">std</a>::<a class='fid' href="/lxr/ident?i=vector">vector</a>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>*&gt;::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> <a class='fid' href="/lxr/ident?i=tsos">tsos</a>=<a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=begin">begin</a>(); 
<a name=179 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#179">179</a>        <a class='fid' href="/lxr/ident?i=tsos">tsos</a>!=<a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=end">end</a>(); ++<a class='fid' href="/lxr/ident?i=tsos">tsos</a>) {
<a name=180 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#180">180</a> 
<a name=181 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#181">181</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* tparp=((*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=trackParameters">trackParameters</a>());
<a name=182 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#182">182</a>     <span class="comment">// Try to recover the Q/p measurement from the TRT segment:</span>
<a name=183 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#183">183</a> <span class="comment"></span>    <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MeasurementBase">MeasurementBase</a>* mesb=(*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=measurementOnTrack">measurementOnTrack</a>();
<a name=184 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#184">184</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=PseudoMeasurementOnTrack">PseudoMeasurementOnTrack</a>* trtm=<span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=PseudoMeasurementOnTrack">PseudoMeasurementOnTrack</a>*&gt;(mesb);
<a name=185 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#185">185</a>     <span class='reserved'>if</span> (trtm!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=186 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#186">186</a>       <span class="comment">// the pseudo measurement has been found!</span>
<a name=187 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#187">187</a> <span class="comment"></span>      <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"The TRT pseudo-measurement has been found! "</span> );
<a name=188 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#188">188</a>       <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Q/p_t(perigee), Q/p_t(TRT), sigma(1,1) =  "</span> &lt;&lt; 
<a name=189 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#189">189</a>         <a class='fid' href="/lxr/ident?i=dx2">dx2</a>*(mesp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>]) &lt;&lt; <span class='string'>",  "</span> &lt;&lt;
<a name=190 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#190">190</a>         <a class='fid' href="/lxr/ident?i=dx2">dx2</a>*(trtm-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>]) &lt;&lt; <span class='string'>",  "</span> &lt;&lt;
<a name=191 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#191">191</a>         <a class='fid' href="/lxr/ident?i=dx2">dx2</a>*<a class='fid' href="/lxr/ident?i=getErrorQonP">getErrorQonP</a>(trtm) );    <span class="comment">// This is NOT a bug. This is a FEATURE!!!</span>
<a name=192 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#192">192</a> <span class="comment"></span>      aligntrk.<a class='fid' href="/lxr/ident?i=set_trtcons">set_trtcons</a>(<a class='fid' href="/lxr/ident?i=dx2">dx2</a>*(trtm-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>]),  <a class='fid' href="/lxr/ident?i=dx2">dx2</a>*<a class='fid' href="/lxr/ident?i=getErrorQonP">getErrorQonP</a>(trtm));
<a name=193 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#193">193</a>     }
<a name=194 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#194">194</a> 
<a name=195 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#195">195</a>     <span class='reserved'>if</span> ((*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=type">type</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>::<a class='fid' href="/lxr/ident?i=Scatterer">Scatterer</a>)) {
<a name=196 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#196">196</a>       <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=GlobalPosition">GlobalPosition</a>&amp; globp=tparp-&gt;<a class='fid' href="/lxr/ident?i=position">position</a>();
<a name=197 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#197">197</a>       posscat[<a class='fid' href="/lxr/ident?i=nscat">nscat</a>]=globp;
<a name=198 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#198">198</a>       tparpscat[<a class='fid' href="/lxr/ident?i=nscat">nscat</a>]=tparp;
<a name=199 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#199">199</a>       <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MaterialEffectsBase">MaterialEffectsBase</a>* meb = (*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=materialEffectsOnTrack">materialEffectsOnTrack</a>();
<a name=200 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#200">200</a>       <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MaterialEffectsOnTrack">MaterialEffectsOnTrack</a>* meot = <span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MaterialEffectsOnTrack">MaterialEffectsOnTrack</a>*&gt;(meb);
<a name=201 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#201">201</a>       <span class='reserved'>if</span> (meot!=<a class='fid' href="/lxr/ident?i=NULL">NULL</a>) {
<a name=202 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#202">202</a>         saospscat[<a class='fid' href="/lxr/ident?i=nscat">nscat</a>]=(meot)-&gt;<a class='fid' href="/lxr/ident?i=scatteringAngles">scatteringAngles</a>();
<a name=203 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#203">203</a>         <a class='fid' href="/lxr/ident?i=ATH_MSG_VERBOSE">ATH_MSG_VERBOSE</a>( <span class='string'>"Scattering angle ("</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=nscat">nscat</a> &lt;&lt; <span class='string'>"): "</span> &lt;&lt; saospscat[<a class='fid' href="/lxr/ident?i=nscat">nscat</a>]);
<a name=204 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#204">204</a>           <span class="comment">//msg &lt;&lt; MSG::VERBOSE &lt;&lt; "Scattering angle (" &lt;&lt; nscat &lt;&lt; "): " &lt;&lt; saospscat[nscat] &lt;&lt; endreq;</span>
<a name=205 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#205">205</a> <span class="comment"></span>      }
<a name=206 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#206">206</a>       nhitscat[<a class='fid' href="/lxr/ident?i=nscat">nscat</a>]=<a class='fid' href="/lxr/ident?i=0">0</a>;
<a name=207 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#207">207</a>       ++<a class='fid' href="/lxr/ident?i=nscat">nscat</a>;
<a name=208 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#208">208</a>     }
<a name=209 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#209">209</a> 
<a name=210 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#210">210</a>   } <span class="comment">// end of preliminary trackpar/scatterer loop</span>
<a name=211 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#211">211</a> <span class="comment"></span>
<a name=212 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#212">212</a>   <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Number of Scatterers found: "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=nscat">nscat</a> );
<a name=213 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#213">213</a> 
<a name=214 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#214">214</a>   <span class="comment">// loop over all the silicon hits</span>
<a name=215 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#215">215</a> <span class="comment"></span>  <span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=nhits">nhits</a>=<a class='fid' href="/lxr/ident?i=0">0</a>;
<a name=216 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#216">216</a>   <span class='reserved'>bool</span> seenhit=<span class='reserved'>false</span>;
<a name=217 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#217">217</a>   <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=GlobalPosition">GlobalPosition</a> <a class='fid' href="/lxr/ident?i=lastpos">lastpos</a>,<a class='fid' href="/lxr/ident?i=pos">pos</a>;
<a name=218 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#218">218</a>   <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Begin loop over "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=size">size</a>() &lt;&lt; <span class='string'>" TSOS"</span> );
<a name=219 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#219">219</a>   <span class='reserved'>for</span> (<a class='fid' href="/lxr/ident?i=std">std</a>::<a class='fid' href="/lxr/ident?i=vector">vector</a>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>*&gt;::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> <a class='fid' href="/lxr/ident?i=tsos">tsos</a>=
<a name=220 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#220">220</a>          <a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=begin">begin</a>(); 
<a name=221 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#221">221</a>        <a class='fid' href="/lxr/ident?i=tsos">tsos</a>!=<a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=end">end</a>(); ++<a class='fid' href="/lxr/ident?i=tsos">tsos</a>) {
<a name=222 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#222">222</a> 
<a name=223 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#223">223</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MeasurementBase">MeasurementBase</a>* mesb=(*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=measurementOnTrack">measurementOnTrack</a>();
<a name=224 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#224">224</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=RIO_OnTrack">RIO_OnTrack</a>* rotp=<span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=RIO_OnTrack">RIO_OnTrack</a>*&gt;(mesb);
<a name=225 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#225">225</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* tparp=((*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=trackParameters">trackParameters</a>());
<a name=226 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#226">226</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=ScatteringAngles">ScatteringAngles</a>* saosp;
<a name=227 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#227">227</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MaterialEffectsBase">MaterialEffectsBase</a>* meb = (*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=materialEffectsOnTrack">materialEffectsOnTrack</a>();
<a name=228 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#228">228</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MaterialEffectsOnTrack">MaterialEffectsOnTrack</a>* meot = <span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MaterialEffectsOnTrack">MaterialEffectsOnTrack</a>*&gt;(meb);
<a name=229 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#229">229</a>     <span class='reserved'>if</span> (meot!=<a class='fid' href="/lxr/ident?i=NULL">NULL</a>) {
<a name=230 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#230">230</a>       saosp=(meot)-&gt;<a class='fid' href="/lxr/ident?i=scatteringAngles">scatteringAngles</a>();
<a name=231 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#231">231</a>       <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Scattering angles del "</span> &lt;&lt; saosp-&gt;<a class='fid' href="/lxr/ident?i=deltaTheta">deltaTheta</a>() 
<a name=232 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#232">232</a>           &lt;&lt; <span class='string'>","</span> &lt;&lt; saosp-&gt;<a class='fid' href="/lxr/ident?i=deltaPhi">deltaPhi</a>() &lt;&lt; <span class='string'>","</span> &lt;&lt; saosp-&gt;<a class='fid' href="/lxr/ident?i=sigmaDeltaTheta">sigmaDeltaTheta</a>() &lt;&lt; <span class='string'>","</span> &lt;&lt; saosp-&gt;<a class='fid' href="/lxr/ident?i=sigmaDeltaPhi">sigmaDeltaPhi</a>() );
<a name=233 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#233">233</a>     }
<a name=234 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#234">234</a>     <span class='reserved'>else</span> saosp = <a class='fid' href="/lxr/ident?i=NULL">NULL</a>;
<a name=235 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#235">235</a>         <a class='fid' href="/lxr/ident?i=ATH_MSG_VERBOSE">ATH_MSG_VERBOSE</a>(  <span class='string'>"Si "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=nhits">nhits</a> 
<a name=236 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#236">236</a>         &lt;&lt; <span class='string'>" pointers ROT/TP/SO "</span> &lt;&lt; rotp 
<a name=237 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#237">237</a>         &lt;&lt; <span class='string'>","</span> &lt;&lt; tparp &lt;&lt; <span class='string'>","</span> &lt;&lt; saosp);
<a name=238 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#238">238</a>         <span class="comment">//msg &lt;&lt; MSG::VERBOSE &lt;&lt; "Si " &lt;&lt; nhits &lt;&lt; " pointers ROT/TP/SO " &lt;&lt; rotp &lt;&lt; "," &lt;&lt; tparp &lt;&lt; "," &lt;&lt; saosp &lt;&lt; endreq;</span>
<a name=239 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#239">239</a> <span class="comment"></span>    
<a name=240 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#240">240</a>     <span class="comment">// if we have track parameters, print their location</span>
<a name=241 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#241">241</a> <span class="comment"></span>    <span class='reserved'>if</span> (tparp!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=242 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#242">242</a>       <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=GlobalPosition">GlobalPosition</a>&amp; globp=tparp-&gt;<a class='fid' href="/lxr/ident?i=position">position</a>();
<a name=243 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#243">243</a>       <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Track par position ["</span> &lt;&lt; globp.<a class='fid' href="/lxr/ident?i=x">x</a>() &lt;&lt; <span class='string'>","</span> &lt;&lt;
<a name=244 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#244">244</a>         globp.<a class='fid' href="/lxr/ident?i=y">y</a>() &lt;&lt; <span class='string'>","</span> &lt;&lt; globp.<a class='fid' href="/lxr/ident?i=z">z</a>() &lt;&lt; <span class='string'>"]"</span> );
<a name=245 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#245">245</a>     }
<a name=246 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#246">246</a>   
<a name=247 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#247">247</a>     <span class='reserved'>bool</span> sharedscat=<span class='reserved'>false</span>;
<a name=248 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#248">248</a>     <span class='reserved'>if</span> (rotp!=<a class='fid' href="/lxr/ident?i=0">0</a> &amp;&amp; (*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=type">type</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>::<a class='fid' href="/lxr/ident?i=Measurement">Measurement</a>)) {
<a name=249 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#249">249</a>       <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=PrepRawData">PrepRawData</a>* <a class='fid' href="/lxr/ident?i=rio">rio</a>=rotp-&gt;<a class='fid' href="/lxr/ident?i=prepRawData">prepRawData</a>();
<a name=250 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#250">250</a>         <a class='fid' href="/lxr/ident?i=ATH_MSG_VERBOSE">ATH_MSG_VERBOSE</a>( <span class='string'>"RIO PRD pointer "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=rio">rio</a> );
<a name=251 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#251">251</a>       <span class="comment">// Identifier ident=rio-&gt;identify();</span>
<a name=252 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#252">252</a> <span class="comment"></span>      <a class='fid' href="/lxr/ident?i=Identifier">Identifier</a> <a class='fid' href="/lxr/ident?i=ident">ident</a>=rotp-&gt;<a class='fid' href="/lxr/ident?i=identify">identify</a>();
<a name=253 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#253">253</a>       <a class='fid' href="/lxr/ident?i=Identifier">Identifier</a> mident;
<a name=254 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#254">254</a>       <span class='reserved'>bool</span> sihit=<span class='reserved'>false</span>;
<a name=255 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#255">255</a>       <span class='reserved'>bool</span> pix=<span class='reserved'>false</span>;
<a name=256 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#256">256</a>       <span class='reserved'>bool</span> sctec=<span class='reserved'>false</span>;
<a name=257 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#257">257</a>       <span class="comment">// work around the pixel_id problem for testbeam geometry only </span>
<a name=258 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#258">258</a> <span class="comment"></span>      <span class="comment">// assume all hits which are not SCT or TRT are actually pixels</span>
<a name=259 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#259">259</a> <span class="comment"></span>      <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=m_pixid">m_pixid</a>-&gt;<a class='fid' href="/lxr/ident?i=is_pixel">is_pixel</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>) || (<a class='fid' href="/lxr/ident?i=par_layout">par_layout</a>==11 &amp;&amp; 
<a name=260 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#260">260</a>                                        (!(<a class='fid' href="/lxr/ident?i=m_sctid">m_sctid</a>-&gt;<a class='fid' href="/lxr/ident?i=is_sct">is_sct</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>) || <a class='fid' href="/lxr/ident?i=m_trtid">m_trtid</a>-&gt;<a class='fid' href="/lxr/ident?i=is_trt">is_trt</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>))))) {
<a name=261 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#261">261</a>         mident=<a class='fid' href="/lxr/ident?i=m_pixid">m_pixid</a>-&gt;<a class='fid' href="/lxr/ident?i=wafer_id">wafer_id</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>);
<a name=262 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#262">262</a>         sihit=<span class='reserved'>true</span>;
<a name=263 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#263">263</a>         pix=<span class='reserved'>true</span>;
<a name=264 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#264">264</a>       } <span class='reserved'>else</span> <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=m_sctid">m_sctid</a>-&gt;<a class='fid' href="/lxr/ident?i=is_sct">is_sct</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>)) {
<a name=265 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#265">265</a>         <span class="comment">// for SCT, wafter does not include side, so construct ID by hand</span>
<a name=266 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#266">266</a> <span class="comment"></span>        mident=<a class='fid' href="/lxr/ident?i=m_sctid">m_sctid</a>-&gt;<a class='fid' href="/lxr/ident?i=wafer_id">wafer_id</a>(<a class='fid' href="/lxr/ident?i=m_sctid">m_sctid</a>-&gt;<a class='fid' href="/lxr/ident?i=barrel_ec">barrel_ec</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>),
<a name=267 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#267">267</a>                                  <a class='fid' href="/lxr/ident?i=m_sctid">m_sctid</a>-&gt;<a class='fid' href="/lxr/ident?i=layer_disk">layer_disk</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>),<a class='fid' href="/lxr/ident?i=m_sctid">m_sctid</a>-&gt;<a class='fid' href="/lxr/ident?i=phi_module">phi_module</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>),
<a name=268 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#268">268</a>                                  <a class='fid' href="/lxr/ident?i=m_sctid">m_sctid</a>-&gt;<a class='fid' href="/lxr/ident?i=eta_module">eta_module</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>),<a class='fid' href="/lxr/ident?i=m_sctid">m_sctid</a>-&gt;<a class='fid' href="/lxr/ident?i=side">side</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>));
<a name=269 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#269">269</a>         sihit=<span class='reserved'>true</span>;
<a name=270 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#270">270</a>       }
<a name=271 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#271">271</a>       <span class='reserved'>if</span> (sihit) {
<a name=272 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#272">272</a>         <a class='fid' href="/lxr/ident?i=AlignSiHit">AlignSiHit</a> newhit;
<a name=273 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#273">273</a>         <a class='fid' href="/lxr/ident?i=nhits">nhits</a>++;
<a name=274 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#274">274</a>         <span class="comment">// find associated SiClusterOnTrack and hit position</span>
<a name=275 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#275">275</a> <span class="comment"></span>        <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=InDet">InDet</a>::<a class='fid' href="/lxr/ident?i=SiClusterOnTrack">SiClusterOnTrack</a>* siclus=
<a name=276 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#276">276</a>           <span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=InDet">InDet</a>::<a class='fid' href="/lxr/ident?i=SiClusterOnTrack">SiClusterOnTrack</a>*&gt;(rotp);
<a name=277 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#277">277</a>         <span class='reserved'>if</span> (siclus!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=278 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#278">278</a>           <a class='fid' href="/lxr/ident?i=pos">pos</a>=siclus-&gt;<a class='fid' href="/lxr/ident?i=globalPosition">globalPosition</a>();
<a name=279 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#279">279</a>         } <span class='reserved'>else</span> {
<a name=280 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#280">280</a>           <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"Could not determine hit position"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=281 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#281">281</a>         }
<a name=282 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#282">282</a>         newhit.<a class='fid' href="/lxr/ident?i=set_sinlocal">set_sinlocal</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.<a class='fid' href="/lxr/ident?i=0">0</a>);       <span class="comment">// reset the sinlocal info</span>
<a name=283 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#283">283</a> <span class="comment"></span>        <a class='fid' href="/lxr/ident?i=AlignSiModuleList">AlignSiModuleList</a>::<a class='fid' href="/lxr/ident?i=ModuleIDMap">ModuleIDMap</a>::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> 
<a name=284 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#284">284</a>           itmod=<a class='fid' href="/lxr/ident?i=p_modlist">p_modlist</a>-&gt;<a class='fid' href="/lxr/ident?i=idmap">idmap</a>.<a class='fid' href="/lxr/ident?i=find">find</a>(mident);
<a name=285 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#285">285</a>         <span class='reserved'>if</span> (itmod != <a class='fid' href="/lxr/ident?i=p_modlist">p_modlist</a>-&gt;<a class='fid' href="/lxr/ident?i=idmap">idmap</a>.<a class='fid' href="/lxr/ident?i=end">end</a>()) {
<a name=286 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#286">286</a>           newhit.<a class='fid' href="/lxr/ident?i=set_index">set_index</a>(itmod-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>);
<a name=287 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#287">287</a>           <span class='reserved'>if</span> (itmod-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=288 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#288">288</a>             <span class='reserved'>if</span> (!pix) newhit.<a class='fid' href="/lxr/ident?i=set_sinlocal">set_sinlocal</a>((<a class='fid' href="/lxr/ident?i=m_detelep">m_detelep</a>[(itmod-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>)-<a class='fid' href="/lxr/ident?i=1">1</a>])-&gt;
<a name=289 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#289">289</a>                                           <a class='fid' href="/lxr/ident?i=sinStereoLocal">sinStereoLocal</a>(<a class='fid' href="/lxr/ident?i=pos">pos</a>));
<a name=290 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#290">290</a>             <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=AlignSiModule">AlignSiModule</a>&amp; simod=<a class='fid' href="/lxr/ident?i=p_modlist">p_modlist</a>-&gt;<a class='fid' href="/lxr/ident?i=vec">vec</a>[(itmod-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>)-<a class='fid' href="/lxr/ident?i=1">1</a>];
<a name=291 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#291">291</a>             simod.<a class='fid' href="/lxr/ident?i=inchits">inchits</a>();
<a name=292 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#292">292</a>             <span class="comment">// compute the stereo angle for SCT modules</span>
<a name=293 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#293">293</a> <span class="comment"></span>            <span class="comment">// sign convention is the same as for ipatrec native</span>
<a name=294 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#294">294</a> <span class="comment"></span>            <span class='reserved'>if</span> (!pix) {
<a name=295 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#295">295</a>               <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=InDetDD">InDetDD</a>::<a class='fid' href="/lxr/ident?i=SiDetectorElement">SiDetectorElement</a>* 
<a name=296 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#296">296</a>                 detelm=<a class='fid' href="/lxr/ident?i=m_detelep">m_detelep</a>[(itmod-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>)-<a class='fid' href="/lxr/ident?i=1">1</a>];
<a name=297 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#297">297</a>               <span class='reserved'>if</span> (detelm!=<a class='fid' href="/lxr/ident?i=0">0</a> &amp;&amp; detelm-&gt;<a class='fid' href="/lxr/ident?i=design">design</a>().<a class='fid' href="/lxr/ident?i=shape">shape</a>()==
<a name=298 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#298">298</a>                   <a class='fid' href="/lxr/ident?i=InDetDD">InDetDD</a>::<a class='fid' href="/lxr/ident?i=Trapezoid">Trapezoid</a>) {
<a name=299 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#299">299</a>                 <span class="comment">// forward SCT stereo angles</span>
<a name=300 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#300">300</a> <span class="comment"></span>                <a class='fid' href="/lxr/ident?i=Hep3Vector">Hep3Vector</a> globy=
<a name=301 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#301">301</a>                   ((<a class='fid' href="/lxr/ident?i=m_global2local">m_global2local</a>[itmod-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>-<a class='fid' href="/lxr/ident?i=1">1</a>]).<a class='fid' href="/lxr/ident?i=inverse">inverse</a>()*<a class='fid' href="/lxr/ident?i=HepYHat">HepYHat</a>);
<a name=302 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#302">302</a>                 <span class='reserved'>float</span> ster=atan2(simod.<a class='fid' href="/lxr/ident?i=pos">pos</a>(<a class='fid' href="/lxr/ident?i=1">1</a>),simod.<a class='fid' href="/lxr/ident?i=pos">pos</a>(<a class='fid' href="/lxr/ident?i=0">0</a>))-
<a name=303 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#303">303</a>                   atan2(globy.<a class='fid' href="/lxr/ident?i=y">y</a>(),globy.<a class='fid' href="/lxr/ident?i=x">x</a>());
<a name=304 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#304">304</a>                 <span class='reserved'>if</span> (ster&lt;-<a class='fid' href="/lxr/ident?i=M_PI">M_PI</a>) ster+=2*<a class='fid' href="/lxr/ident?i=M_PI">M_PI</a>;
<a name=305 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#305">305</a>                 <span class='reserved'>if</span> (ster&gt;<a class='fid' href="/lxr/ident?i=M_PI">M_PI</a>) ster-=2*<a class='fid' href="/lxr/ident?i=M_PI">M_PI</a>;
<a name=306 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#306">306</a>                 newhit.<a class='fid' href="/lxr/ident?i=set_stereo">set_stereo</a>(ster);
<a name=307 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#307">307</a>                 sctec=<span class='reserved'>true</span>;
<a name=308 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#308">308</a>               } <span class='reserved'>else</span> {
<a name=309 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#309">309</a>                 <span class="comment">// barrel SCT stereo angle</span>
<a name=310 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#310">310</a> <span class="comment"></span>                <a class='fid' href="/lxr/ident?i=Hep3Vector">Hep3Vector</a> globx=
<a name=311 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#311">311</a>                   ((<a class='fid' href="/lxr/ident?i=m_global2local">m_global2local</a>[itmod-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>-<a class='fid' href="/lxr/ident?i=1">1</a>]).<a class='fid' href="/lxr/ident?i=inverse">inverse</a>()*<a class='fid' href="/lxr/ident?i=HepXHat">HepXHat</a>);
<a name=312 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#312">312</a>                 newhit.<a class='fid' href="/lxr/ident?i=set_stereo">set_stereo</a>(<a class='fid' href="/lxr/ident?i=asin">asin</a>(globx.<a class='fid' href="/lxr/ident?i=z">z</a>()));
<a name=313 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#313">313</a>               }
<a name=314 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#314">314</a>             }
<a name=315 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#315">315</a>           } <span class='reserved'>else</span> {
<a name=316 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#316">316</a>             outofslice=<span class='reserved'>true</span>;
<a name=317 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#317">317</a>           }
<a name=318 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#318">318</a>         } <span class='reserved'>else</span> {
<a name=319 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#319">319</a>           <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"Module ident "</span> &lt;&lt; mident.<a class='fid' href="/lxr/ident?i=getString">getString</a>() &lt;&lt; 
<a name=320 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#320">320</a>             <span class='string'>"not found in moduleidmap"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=321 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#321">321</a>           newhit.<a class='fid' href="/lxr/ident?i=set_index">set_index</a>(-<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=322 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#322">322</a>         }
<a name=323 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#323">323</a> 
<a name=324 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#324">324</a>         <span class="comment">/*</span>
<a name=325 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#325">325</a> <span class="comment">        // find associated SiClusterOnTrack and hit position</span>
<a name=326 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#326">326</a> <span class="comment">        const InDet::SiClusterOnTrack* siclus=</span>
<a name=327 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#327">327</a> <span class="comment">        dynamic_cast&lt;const InDet::SiClusterOnTrack*&gt;(rotp);</span>
<a name=328 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#328">328</a> <span class="comment">        */</span>
<a name=329 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#329">329</a>         <span class='reserved'>if</span> (siclus!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=330 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#330">330</a>           <a class='fid' href="/lxr/ident?i=pos">pos</a>=siclus-&gt;<a class='fid' href="/lxr/ident?i=globalPosition">globalPosition</a>();
<a name=331 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#331">331</a>           newhit.<a class='fid' href="/lxr/ident?i=set_r">set_r</a>(<a class='fid' href="/lxr/ident?i=pos">pos</a>.<a class='fid' href="/lxr/ident?i=perp">perp</a>());
<a name=332 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#332">332</a>           newhit.<a class='fid' href="/lxr/ident?i=set_phi">set_phi</a>(<a class='fid' href="/lxr/ident?i=pos">pos</a>.<a class='fid' href="/lxr/ident?i=phi">phi</a>());
<a name=333 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#333">333</a>           newhit.<a class='fid' href="/lxr/ident?i=set_z">set_z</a>(<a class='fid' href="/lxr/ident?i=pos">pos</a>.<a class='fid' href="/lxr/ident?i=z">z</a>());
<a name=334 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#334">334</a>           <span class='reserved'>if</span> (seenhit) {
<a name=335 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#335">335</a>             newhit.<a class='fid' href="/lxr/ident?i=set_trklen">set_trklen</a>((<a class='fid' href="/lxr/ident?i=pos">pos</a>-<a class='fid' href="/lxr/ident?i=lastpos">lastpos</a>).<a class='fid' href="/lxr/ident?i=mag">mag</a>());
<a name=336 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#336">336</a>             newhit.<a class='fid' href="/lxr/ident?i=set_status">set_status</a>(2);
<a name=337 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#337">337</a>           } <span class='reserved'>else</span> {
<a name=338 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#338">338</a>             newhit.<a class='fid' href="/lxr/ident?i=set_trklen">set_trklen</a>(<a class='fid' href="/lxr/ident?i=0">0</a>); <span class="comment">// this is first hit</span>
<a name=339 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#339">339</a> <span class="comment"></span>            newhit.<a class='fid' href="/lxr/ident?i=set_status">set_status</a>(<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=340 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#340">340</a>             seenhit=<span class='reserved'>true</span>;
<a name=341 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#341">341</a>           }
<a name=342 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#342">342</a>         } <span class='reserved'>else</span> {
<a name=343 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#343">343</a>           <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"RIO cast to SiClusterOnTrack failed"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=344 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#344">344</a>         }
<a name=345 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#345">345</a> 
<a name=346 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#346">346</a>         <span class="comment">// set residual errors from RIO_OnTrack</span>
<a name=347 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#347">347</a> <span class="comment"></span>        <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=ErrorMatrix">ErrorMatrix</a>&amp; locale=rotp-&gt;<a class='fid' href="/lxr/ident?i=localErrorMatrix">localErrorMatrix</a>();
<a name=348 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#348">348</a>         <span class='reserved'>if</span> (pix) {
<a name=349 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#349">349</a>           newhit.<a class='fid' href="/lxr/ident?i=set_erphi_resid">set_erphi_resid</a>(locale.<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>));
<a name=350 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#350">350</a>           newhit.<a class='fid' href="/lxr/ident?i=set_ez_resid">set_ez_resid</a>(locale.<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>));
<a name=351 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#351">351</a>         } <span class='reserved'>else</span> {
<a name=352 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#352">352</a>           <span class="comment">// for SCT set rphi residual only, take into account endcap </span>
<a name=353 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#353">353</a> <span class="comment"></span>          <span class="comment">// two-dimensional error matrix</span>
<a name=354 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#354">354</a> <span class="comment"></span>          <span class='reserved'>if</span> (sctec) {
<a name=355 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#355">355</a>             newhit.<a class='fid' href="/lxr/ident?i=set_erphi_resid">set_erphi_resid</a>(locale.<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>)*<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>
<a name=356 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#356">356</a>                              (<a class='fid' href="/lxr/ident?i=1">1</a>.-locale.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>)*
<a name=357 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#357">357</a>                               locale.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>,<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>)/
<a name=358 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#358">358</a>                               (locale.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>)*locale.<a class='fid' href="/lxr/ident?i=covValue">covValue</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>))));
<a name=359 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#359">359</a>           } <span class='reserved'>else</span> {
<a name=360 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#360">360</a>             newhit.<a class='fid' href="/lxr/ident?i=set_erphi_resid">set_erphi_resid</a>(locale.<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>));
<a name=361 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#361">361</a>           }
<a name=362 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#362">362</a>           newhit.<a class='fid' href="/lxr/ident?i=set_ez_resid">set_ez_resid</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.);
<a name=363 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#363">363</a>         }
<a name=364 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#364">364</a>         
<a name=365 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#365">365</a>         <span class="comment">// if we have track parameters, extract the extrapolation errors</span>
<a name=366 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#366">366</a> <span class="comment"></span>        <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MeasuredTrackParameters">MeasuredTrackParameters</a>* mtparp = <span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MeasuredTrackParameters">MeasuredTrackParameters</a>*&gt;(tparp);
<a name=367 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#367">367</a>         <span class='reserved'>if</span> (mtparp) {
<a name=368 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#368">368</a>           <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=ErrorMatrix">ErrorMatrix</a>&amp; extrapolationError=mtparp-&gt;<a class='fid' href="/lxr/ident?i=errorMatrixInMeasurementFrame">errorMatrixInMeasurementFrame</a>();
<a name=369 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#369">369</a>           newhit.<a class='fid' href="/lxr/ident?i=set_trkExtrapLocalXError">set_trkExtrapLocalXError</a>(extrapolationError.<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=loc1">loc1</a>));
<a name=370 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#370">370</a>           <span class='reserved'>if</span>(pix)
<a name=371 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#371">371</a>             newhit.<a class='fid' href="/lxr/ident?i=set_trkExtrapLocalYError">set_trkExtrapLocalYError</a>(extrapolationError.<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=loc2">loc2</a>));
<a name=372 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#372">372</a>           
<a name=373 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#373">373</a>         }
<a name=374 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#374">374</a>       
<a name=375 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#375">375</a>         
<a name=376 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#376">376</a>         <span class="comment">// derive residuals from local track parameter</span>
<a name=377 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#377">377</a> <span class="comment"></span>        <span class="comment">// if local track parameter is zero, first try lookup in separate table</span>
<a name=378 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#378">378</a> <span class="comment"></span>        <span class='reserved'>bool</span> tplook=<span class='reserved'>false</span>;
<a name=379 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#379">379</a>         <span class='reserved'>if</span> (tparp==<a class='fid' href="/lxr/ident?i=0">0</a> || saosp==<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=380 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#380">380</a>           <span class='reserved'>float</span> d2min=<a class='fid' href="/lxr/ident?i=1">1</a>.E10;
<a name=381 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#381">381</a>           <span class='reserved'>int</span> jhit=-<a class='fid' href="/lxr/ident?i=1">1</a>;
<a name=382 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#382">382</a>           <span class='reserved'>for</span> (<span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=j">j</a>=<a class='fid' href="/lxr/ident?i=0">0</a>;<a class='fid' href="/lxr/ident?i=j">j</a>&lt;<a class='fid' href="/lxr/ident?i=nscat">nscat</a>;++<a class='fid' href="/lxr/ident?i=j">j</a>) {
<a name=383 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#383">383</a>             <span class='reserved'>float</span> <a class='fid' href="/lxr/ident?i=d2">d2</a>=<a class='fid' href="/lxr/ident?i=pow">pow</a>(<a class='fid' href="/lxr/ident?i=pos">pos</a>.<a class='fid' href="/lxr/ident?i=x">x</a>()-posscat[<a class='fid' href="/lxr/ident?i=j">j</a>].<a class='fid' href="/lxr/ident?i=x">x</a>(),2.)+
<a name=384 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#384">384</a>               <a class='fid' href="/lxr/ident?i=pow">pow</a>(<a class='fid' href="/lxr/ident?i=pos">pos</a>.<a class='fid' href="/lxr/ident?i=y">y</a>()-posscat[<a class='fid' href="/lxr/ident?i=j">j</a>].<a class='fid' href="/lxr/ident?i=y">y</a>(),2.)+
<a name=385 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#385">385</a>               <a class='fid' href="/lxr/ident?i=pow">pow</a>(<a class='fid' href="/lxr/ident?i=pos">pos</a>.<a class='fid' href="/lxr/ident?i=z">z</a>()-posscat[<a class='fid' href="/lxr/ident?i=j">j</a>].<a class='fid' href="/lxr/ident?i=z">z</a>(),2.);
<a name=386 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#386">386</a>             <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=d2">d2</a>&lt;d2min) {
<a name=387 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#387">387</a>               d2min=<a class='fid' href="/lxr/ident?i=d2">d2</a>;
<a name=388 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#388">388</a>               jhit=<a class='fid' href="/lxr/ident?i=j">j</a>;
<a name=389 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#389">389</a>             }
<a name=390 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#390">390</a>           }
<a name=391 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#391">391</a>           <span class='reserved'>if</span> (jhit&gt;=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=392 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#392">392</a>             <span class="comment">// found a scatterer - setup pointers</span>
<a name=393 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#393">393</a> <span class="comment"></span>                <a class='fid' href="/lxr/ident?i=ATH_MSG_VERBOSE">ATH_MSG_VERBOSE</a>( <span class='string'>"Associated scatterer "</span> &lt;&lt; jhit &lt;&lt; 
<a name=394 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#394">394</a>               <span class='string'>" at distance "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(d2min) &lt;&lt; <span class='string'>" hit at r/z "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=pos">pos</a>.<a class='fid' href="/lxr/ident?i=perp">perp</a>() &lt;&lt;
<a name=395 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#395">395</a>               <span class='string'>"/"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=pos">pos</a>.<a class='fid' href="/lxr/ident?i=z">z</a>() );
<a name=396 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#396">396</a>             <span class="comment">// only set tparp here if we didn't already have one at the point</span>
<a name=397 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#397">397</a> <span class="comment"></span>            <span class='reserved'>if</span> (tparp==<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=398 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#398">398</a>               tparp=tparpscat[jhit];
<a name=399 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#399">399</a>               tplook=<span class='reserved'>true</span>;
<a name=400 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#400">400</a>             }
<a name=401 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#401">401</a>             saosp=saospscat[jhit];
<a name=402 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#402">402</a>             <span class="comment">// increment scatterer usage count</span>
<a name=403 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#403">403</a> <span class="comment"></span>            <span class='reserved'>if</span> (nhitscat[jhit]&gt;<a class='fid' href="/lxr/ident?i=0">0</a>) sharedscat=<span class='reserved'>true</span>;
<a name=404 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#404">404</a>             ++nhitscat[jhit];
<a name=405 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#405">405</a>           }
<a name=406 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#406">406</a>         }
<a name=407 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#407">407</a>         <span class='reserved'>if</span> (tparp!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=408 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#408">408</a>           <span class="comment">// for xkalman, already have track parameters at local position</span>
<a name=409 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#409">409</a> <span class="comment"></span>          <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=HepVector">HepVector</a>&amp; tparv=tparp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>();
<a name=410 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#410">410</a>           <span class='reserved'>if</span> (!tplook) {
<a name=411 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#411">411</a>             <span class="comment">// for track parameters stored with measurement, local parameters</span>
<a name=412 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#412">412</a> <span class="comment"></span>            <span class="comment">// give residual information directly</span>
<a name=413 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#413">413</a> <span class="comment"></span>            <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=LocalParameters">LocalParameters</a> localp=rotp-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>();
<a name=414 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#414">414</a>             <span class="comment">// deal with pixel and SCT measurements seperately</span>
<a name=415 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#415">415</a> <span class="comment"></span>            <span class='reserved'>if</span> (pix) {
<a name=416 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#416">416</a>               newhit.<a class='fid' href="/lxr/ident?i=set_rphi_resid">set_rphi_resid</a>(localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]-tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]);
<a name=417 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#417">417</a>               newhit.<a class='fid' href="/lxr/ident?i=set_z_resid">set_z_resid</a>(localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]-tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]);
<a name=418 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#418">418</a>               <span class="comment">//newhit.set_erphi_resid(locale.error(Trk::locY));</span>
<a name=419 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#419">419</a> <span class="comment"></span>              <span class="comment">//newhit.set_ez_resid(locale.error(Trk::locY));</span>
<a name=420 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#420">420</a> <span class="comment"></span>            } <span class='reserved'>else</span> {
<a name=421 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#421">421</a>               <span class="comment">// correct for trapezoidal modules in SCT </span>
<a name=422 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#422">422</a> <span class="comment"></span>              <span class="comment">// note for barrel sinStereoLocal returns one</span>
<a name=423 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#423">423</a> <span class="comment"></span>              <span class="comment">// and matrix is diagonal</span>
<a name=424 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#424">424</a> <span class="comment"></span>              <span class='reserved'>float</span> trapcor=<a class='fid' href="/lxr/ident?i=0">0</a>.<a class='fid' href="/lxr/ident?i=0">0</a>;
<a name=425 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#425">425</a>               <span class='reserved'>if</span> ( sctec ) {
<a name=426 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#426">426</a>                 <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=InDetDD">InDetDD</a>::<a class='fid' href="/lxr/ident?i=SiDetectorElement">SiDetectorElement</a>* detelm=
<a name=427 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#427">427</a>                   <a class='fid' href="/lxr/ident?i=m_detelep">m_detelep</a>[newhit.<a class='fid' href="/lxr/ident?i=index">index</a>()-<a class='fid' href="/lxr/ident?i=1">1</a>];
<a name=428 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#428">428</a>                 <span class='reserved'>if</span> (localp.<a class='fid' href="/lxr/ident?i=contains">contains</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>) &amp;&amp; detelm!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=429 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#429">429</a>                   trapcor = detelm-&gt;<a class='fid' href="/lxr/ident?i=sinStereoLocal">sinStereoLocal</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=LocalPosition">LocalPosition</a>(localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>],localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]))
<a name=430 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#430">430</a>                                                        *(tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]-localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]);
<a name=431 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#431">431</a>                   newhit.<a class='fid' href="/lxr/ident?i=set_sinlocal">set_sinlocal</a>(detelm-&gt;<a class='fid' href="/lxr/ident?i=sinStereoLocal">sinStereoLocal</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=LocalPosition">LocalPosition</a>(localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>],localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>])));   <span class="comment">// redefinition of sinlocal (any better???)</span>
<a name=432 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#432">432</a> <span class="comment"></span>                } <span class='reserved'>else</span> {
<a name=433 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#433">433</a>                   trapcor = newhit.<a class='fid' href="/lxr/ident?i=sinlocal">sinlocal</a>()*tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>];
<a name=434 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#434">434</a>                 }
<a name=435 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#435">435</a>                 <span class='reserved'>if</span> (newhit.<a class='fid' href="/lxr/ident?i=sinlocal">sinlocal</a>()!=<a class='fid' href="/lxr/ident?i=0">0</a> &amp;&amp; !localp.<a class='fid' href="/lxr/ident?i=contains">contains</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>)) <a class='fid' href="/lxr/ident?i=msg">msg</a>(<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=WARNING">WARNING</a>) &lt;&lt; 
<a name=436 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#436">436</a>                                <span class='string'>"No hit locY information for an SCT EC module"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=437 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#437">437</a>                 <span class='reserved'>if</span> (detelm==<a class='fid' href="/lxr/ident?i=0">0</a>) <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; 
<a name=438 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#438">438</a>                                <span class='string'>"Zero detelm pointer - no trapezoid correction"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=439 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#439">439</a>               }  
<a name=440 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#440">440</a>               <span class="comment">//newhit.set_rphi_resid(localp[Trk::locX]-trapcor</span>
<a name=441 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#441">441</a> <span class="comment"></span>              <span class="comment">//                    -tparv[Trk::locX]);</span>
<a name=442 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#442">442</a> <span class="comment"></span>              newhit.<a class='fid' href="/lxr/ident?i=set_rphi_resid">set_rphi_resid</a>((localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]-trapcor
<a name=443 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#443">443</a>                                    -tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>])*<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(<a class='fid' href="/lxr/ident?i=1">1</a>-newhit.<a class='fid' href="/lxr/ident?i=sinlocal">sinlocal</a>()*newhit.<a class='fid' href="/lxr/ident?i=sinlocal">sinlocal</a>()));
<a name=444 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#444">444</a>               <span class="comment">//newhit.set_erphi_resid(locale.error(Trk::locX)*sqrt</span>
<a name=445 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#445">445</a> <span class="comment"></span>              <span class="comment">//     (1.-locale.covValue(Trk::locX,Trk::locY)*</span>
<a name=446 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#446">446</a> <span class="comment"></span>              <span class="comment">//                   locale.covValue(Trk::locX,Trk::locY)/</span>
<a name=447 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#447">447</a> <span class="comment"></span>              <span class="comment">//  (locale.covValue(Trk::locX)*locale.covValue(Trk::locY))));</span>
<a name=448 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#448">448</a> <span class="comment"></span>            }
<a name=449 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#449">449</a>             <span class='reserved'>if</span> (localp.<a class='fid' href="/lxr/ident?i=contains">contains</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>)) {
<a name=450 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#450">450</a>               newhit.<a class='fid' href="/lxr/ident?i=set_delzr">set_delzr</a>(tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]-localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]);
<a name=451 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#451">451</a>             } <span class='reserved'>else</span> {
<a name=452 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#452">452</a>               newhit.<a class='fid' href="/lxr/ident?i=set_delzr">set_delzr</a>(tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]);
<a name=453 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#453">453</a>             }
<a name=454 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#454">454</a>             <span class="comment">//if (fabs(newhit.delzr())&gt;1.E3) msg (MSG::ERROR) &lt;&lt; "Huge delzr " &lt;&lt;</span>
<a name=455 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#455">455</a> <span class="comment"></span>            <span class="comment">// tparv[Trk::locY] &lt;&lt; "," &lt;&lt; localp[Trk::locY] &lt;&lt; endreq;</span>
<a name=456 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#456">456</a> <span class="comment"></span>          } <span class='reserved'>else</span> {
<a name=457 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#457">457</a>             <span class="comment">// for trackparameters associated by lookup, have to extrapolate</span>
<a name=458 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#458">458</a> <span class="comment"></span>            <a class='fid' href="/lxr/ident?i=FillResid">FillResid</a>(rotp,tparp,newhit);
<a name=459 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#459">459</a>           }
<a name=460 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#460">460</a>           <span class="comment">// calculate derivatives analytically if any are needed</span>
<a name=461 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#461">461</a> <span class="comment"></span>          <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=par_numdiv">par_numdiv</a>&lt;31)
<a name=462 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#462">462</a>             <a class='fid' href="/lxr/ident?i=FillDeriv">FillDeriv</a>(newhit,aligntrk.<a class='fid' href="/lxr/ident?i=trkpar">trkpar</a>(<a class='fid' href="/lxr/ident?i=1">1</a>),aligntrk.<a class='fid' href="/lxr/ident?i=trkpar">trkpar</a>(3),
<a name=463 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#463">463</a>                       aligntrk.<a class='fid' href="/lxr/ident?i=trkpar">trkpar</a>(5),<a class='fid' href="/lxr/ident?i=pos">pos</a>,<a class='fid' href="/lxr/ident?i=1">1</a>/<a class='fid' href="/lxr/ident?i=tan">tan</a>(tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>]),tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>]);
<a name=464 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#464">464</a>         
<a name=465 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#465">465</a>           <span class="comment">// calculate numerical derivatives if any are needed</span>
<a name=466 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#466">466</a> <span class="comment"></span>          <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=par_numdiv">par_numdiv</a>&gt;<a class='fid' href="/lxr/ident?i=0">0</a>) <a class='fid' href="/lxr/ident?i=FillNumDeriv">FillNumDeriv</a>(aligntrk,tparp,newhit);
<a name=467 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#467">467</a>         }
<a name=468 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#468">468</a>         <span class="comment">// channel information</span>
<a name=469 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#469">469</a> <span class="comment"></span>        <span class='reserved'>if</span> (pix) {
<a name=470 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#470">470</a>           newhit.<a class='fid' href="/lxr/ident?i=set_chan1">set_chan1</a>(<a class='fid' href="/lxr/ident?i=m_pixid">m_pixid</a>-&gt;<a class='fid' href="/lxr/ident?i=phi_index">phi_index</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>));
<a name=471 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#471">471</a>           newhit.<a class='fid' href="/lxr/ident?i=set_chan2">set_chan2</a>(<a class='fid' href="/lxr/ident?i=m_pixid">m_pixid</a>-&gt;<a class='fid' href="/lxr/ident?i=eta_index">eta_index</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>));
<a name=472 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#472">472</a>         } <span class='reserved'>else</span> {
<a name=473 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#473">473</a>           newhit.<a class='fid' href="/lxr/ident?i=set_z_resid">set_z_resid</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.);
<a name=474 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#474">474</a>           newhit.<a class='fid' href="/lxr/ident?i=set_ez_resid">set_ez_resid</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.);
<a name=475 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#475">475</a>           newhit.<a class='fid' href="/lxr/ident?i=set_chan1">set_chan1</a>(<a class='fid' href="/lxr/ident?i=m_sctid">m_sctid</a>-&gt;<a class='fid' href="/lxr/ident?i=strip">strip</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>));
<a name=476 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#476">476</a>           newhit.<a class='fid' href="/lxr/ident?i=set_chan2">set_chan2</a>(<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=477 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#477">477</a>         }
<a name=478 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#478">478</a> 
<a name=479 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#479">479</a>         <span class="comment">// scatterer information</span>
<a name=480 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#480">480</a> <span class="comment"></span>        <span class="comment">// assume scatterers come along with hits, may not be true for iPatRec</span>
<a name=481 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#481">481</a> <span class="comment"></span>        <span class="comment">// will then have to set saosp from prior association loop</span>
<a name=482 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#482">482</a> <span class="comment"></span>        <span class="comment">// initially set to zero in case no or shared scatterer</span>
<a name=483 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#483">483</a> <span class="comment"></span>        newhit.<a class='fid' href="/lxr/ident?i=set_locdel">set_locdel</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=484 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#484">484</a>         newhit.<a class='fid' href="/lxr/ident?i=set_locdel">set_locdel</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=485 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#485">485</a>         newhit.<a class='fid' href="/lxr/ident?i=set_locedel">set_locedel</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=486 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#486">486</a>         newhit.<a class='fid' href="/lxr/ident?i=set_locedel">set_locedel</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=487 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#487">487</a>         newhit.<a class='fid' href="/lxr/ident?i=set_globdel">set_globdel</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=488 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#488">488</a>         newhit.<a class='fid' href="/lxr/ident?i=set_globdel">set_globdel</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=489 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#489">489</a>         newhit.<a class='fid' href="/lxr/ident?i=set_globedel">set_globedel</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=490 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#490">490</a>         newhit.<a class='fid' href="/lxr/ident?i=set_globedel">set_globedel</a>(<a class='fid' href="/lxr/ident?i=0">0</a>.,<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=491 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#491">491</a>         <span class="comment">// kill the scatterer if it has already been used</span>
<a name=492 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#492">492</a> <span class="comment"></span>        <span class='reserved'>if</span> (sharedscat) saosp=<a class='fid' href="/lxr/ident?i=0">0</a>;
<a name=493 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#493">493</a>         <span class='reserved'>if</span> (tparp!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=494 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#494">494</a>           <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=HepVector">HepVector</a>&amp; tparv=tparp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>();
<a name=495 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#495">495</a>           <a class='fid' href="/lxr/ident?i=FillAngles">FillAngles</a>(newhit,tparv,saosp);
<a name=496 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#496">496</a>           <span class="comment">// save the hit location to calculate the track length to next</span>
<a name=497 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#497">497</a> <span class="comment"></span>          <a class='fid' href="/lxr/ident?i=lastpos">lastpos</a>=<a class='fid' href="/lxr/ident?i=pos">pos</a>;
<a name=498 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#498">498</a>         }
<a name=499 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#499">499</a>         <span class="comment">// add new hit to list</span>
<a name=500 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#500">500</a> <span class="comment"></span>        aligntrk.<a class='fid' href="/lxr/ident?i=add_hit">add_hit</a>(newhit);
<a name=501 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#501">501</a>       } <span class="comment">// silicon hit</span>
<a name=502 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#502">502</a> <span class="comment"></span>    } <span class="comment">// rotp OK</span>
<a name=503 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#503">503</a> <span class="comment"></span>  } <span class="comment">// loop over TSOS</span>
<a name=504 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#504">504</a> <span class="comment"></span>  aligntrk.<a class='fid' href="/lxr/ident?i=set_nscat">set_nscat</a>(<a class='fid' href="/lxr/ident?i=nscat">nscat</a>);
<a name=505 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#505">505</a>   <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Track has "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=nhits">nhits</a> &lt;&lt; <span class='string'>" Si hits and "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=nscat">nscat</a> &lt;&lt; 
<a name=506 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#506">506</a>     <span class='string'>" scatterers"</span> );
<a name=507 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#507">507</a> 
<a name=508 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#508">508</a>   <span class="comment">// now look at TRT if requested - loop over all hits again</span>
<a name=509 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#509">509</a> <span class="comment"></span>  <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=par_trt">par_trt</a>!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=510 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#510">510</a>     <span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=ntrthits">ntrthits</a>=<a class='fid' href="/lxr/ident?i=0">0</a>;
<a name=511 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#511">511</a>     <span class="comment">// loop over the TrackStateonSurfaces which contain the RIOs and </span>
<a name=512 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#512">512</a> <span class="comment"></span>    <span class="comment">// also residuals, hit quality information etc</span>
<a name=513 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#513">513</a> <span class="comment"></span>    <span class='reserved'>for</span> (<a class='fid' href="/lxr/ident?i=std">std</a>::<a class='fid' href="/lxr/ident?i=vector">vector</a>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>*&gt;::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> <a class='fid' href="/lxr/ident?i=tsos">tsos</a>=
<a name=514 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#514">514</a>            <a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=begin">begin</a>();
<a name=515 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#515">515</a>          <a class='fid' href="/lxr/ident?i=tsos">tsos</a>!=<a class='fid' href="/lxr/ident?i=pnt">pnt</a>-&gt;<a class='fid' href="/lxr/ident?i=trackStateOnSurfaces">trackStateOnSurfaces</a>()-&gt;<a class='fid' href="/lxr/ident?i=end">end</a>();++<a class='fid' href="/lxr/ident?i=tsos">tsos</a>) {
<a name=516 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#516">516</a>       <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=MeasurementBase">MeasurementBase</a>* mesb=(*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=measurementOnTrack">measurementOnTrack</a>();
<a name=517 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#517">517</a>       <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=RIO_OnTrack">RIO_OnTrack</a>* rotp=<span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=RIO_OnTrack">RIO_OnTrack</a>*&gt;(mesb);
<a name=518 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#518">518</a>       <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* tparp=((*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=trackParameters">trackParameters</a>());
<a name=519 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#519">519</a>       <a class='fid' href="/lxr/ident?i=ATH_MSG_VERBOSE">ATH_MSG_VERBOSE</a>( <span class='string'>"TRT "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=ntrthits">ntrthits</a> &lt;&lt;
<a name=520 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#520">520</a>         <span class='string'>" pointers ROT/TP "</span> &lt;&lt; rotp &lt;&lt; <span class='string'>","</span> &lt;&lt; tparp );
<a name=521 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#521">521</a>       <span class='reserved'>if</span> (rotp!=<a class='fid' href="/lxr/ident?i=0">0</a> &amp;&amp; (*<a class='fid' href="/lxr/ident?i=tsos">tsos</a>)-&gt;<a class='fid' href="/lxr/ident?i=type">type</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackStateOnSurface">TrackStateOnSurface</a>::<a class='fid' href="/lxr/ident?i=Measurement">Measurement</a>)) {
<a name=522 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#522">522</a>         <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=PrepRawData">PrepRawData</a>* <a class='fid' href="/lxr/ident?i=rio">rio</a>=rotp-&gt;<a class='fid' href="/lxr/ident?i=prepRawData">prepRawData</a>();
<a name=523 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#523">523</a>         <a class='fid' href="/lxr/ident?i=Identifier">Identifier</a> <a class='fid' href="/lxr/ident?i=ident">ident</a>=rotp-&gt;<a class='fid' href="/lxr/ident?i=identify">identify</a>();
<a name=524 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#524">524</a>         <span class="comment">//        if (rio!=0) ident=rio-&gt;identify();</span>
<a name=525 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#525">525</a> <span class="comment"></span>        <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=m_trtid">m_trtid</a>-&gt;<a class='fid' href="/lxr/ident?i=is_trt">is_trt</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>)) {
<a name=526 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#526">526</a>           <a class='fid' href="/lxr/ident?i=AlignTRTHit">AlignTRTHit</a> newhit;
<a name=527 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#527">527</a>           newhit.<a class='fid' href="/lxr/ident?i=set_index">set_index</a>(<a class='fid' href="/lxr/ident?i=m_trtid">m_trtid</a>-&gt;<a class='fid' href="/lxr/ident?i=barrel_ec">barrel_ec</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>),
<a name=528 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#528">528</a>                            <a class='fid' href="/lxr/ident?i=m_trtid">m_trtid</a>-&gt;<a class='fid' href="/lxr/ident?i=layer_or_wheel">layer_or_wheel</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>),<a class='fid' href="/lxr/ident?i=m_trtid">m_trtid</a>-&gt;<a class='fid' href="/lxr/ident?i=phi_module">phi_module</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>),
<a name=529 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#529">529</a>                            <a class='fid' href="/lxr/ident?i=m_trtid">m_trtid</a>-&gt;<a class='fid' href="/lxr/ident?i=straw_layer">straw_layer</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>),<a class='fid' href="/lxr/ident?i=m_trtid">m_trtid</a>-&gt;<a class='fid' href="/lxr/ident?i=straw">straw</a>(<a class='fid' href="/lxr/ident?i=ident">ident</a>));
<a name=530 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#530">530</a> 
<a name=531 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#531">531</a>           <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=InDet">InDet</a>::<a class='fid' href="/lxr/ident?i=TRT_DriftCircleOnTrack">TRT_DriftCircleOnTrack</a>* trtcirc=
<a name=532 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#532">532</a>             <span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=InDet">InDet</a>::<a class='fid' href="/lxr/ident?i=TRT_DriftCircleOnTrack">TRT_DriftCircleOnTrack</a>*&gt;(rotp);
<a name=533 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#533">533</a>           <span class='reserved'>if</span> (trtcirc!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=534 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#534">534</a>             <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=GlobalPosition">GlobalPosition</a> tpos=trtcirc-&gt;<a class='fid' href="/lxr/ident?i=globalPosition">globalPosition</a>();
<a name=535 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#535">535</a>             newhit.<a class='fid' href="/lxr/ident?i=set_r">set_r</a>(tpos.<a class='fid' href="/lxr/ident?i=perp">perp</a>());
<a name=536 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#536">536</a>             newhit.<a class='fid' href="/lxr/ident?i=set_phi">set_phi</a>(tpos.<a class='fid' href="/lxr/ident?i=phi">phi</a>());
<a name=537 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#537">537</a>             newhit.<a class='fid' href="/lxr/ident?i=set_z">set_z</a>(tpos.<a class='fid' href="/lxr/ident?i=z">z</a>());
<a name=538 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#538">538</a>             newhit.<a class='fid' href="/lxr/ident?i=set_highth">set_highth</a>(trtcirc-&gt;<a class='fid' href="/lxr/ident?i=highLevel">highLevel</a>());
<a name=539 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#539">539</a>             <span class="comment">// this is giving problems for xKalman tracks on 4/8/05</span>
<a name=540 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#540">540</a> <span class="comment"></span>            <span class="comment">//  float xdrift=rotp-&gt;localPosition().x();</span>
<a name=541 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#541">541</a> <span class="comment"></span>            <span class='reserved'>float</span> <a class='fid' href="/lxr/ident?i=xdrift">xdrift</a>=rotp-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>()[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>];
<a name=542 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#542">542</a>             newhit.<a class='fid' href="/lxr/ident?i=set_xdrift">set_xdrift</a>(<a class='fid' href="/lxr/ident?i=xdrift">xdrift</a>);
<a name=543 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#543">543</a>             <span class='reserved'>bool</span> <a class='fid' href="/lxr/ident?i=isvalid">isvalid</a>=<span class='reserved'>false</span>;
<a name=544 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#544">544</a>             <span class="comment">//cast will fail if preprawdata is not present</span>
<a name=545 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#545">545</a> <span class="comment"></span>            <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=InDet">InDet</a>::<a class='fid' href="/lxr/ident?i=TRT_DriftCircle">TRT_DriftCircle</a>* rdc=<span class='reserved'>dynamic_cast</span>&lt;<span class='reserved'>const</span>
<a name=546 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#546">546</a>               <a class='fid' href="/lxr/ident?i=InDet">InDet</a>::<a class='fid' href="/lxr/ident?i=TRT_DriftCircle">TRT_DriftCircle</a>*&gt;(<a class='fid' href="/lxr/ident?i=rio">rio</a>);
<a name=547 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#547">547</a>             <span class='reserved'>if</span> (rdc) {
<a name=548 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#548">548</a>               <span class='reserved'>float</span> <a class='fid' href="/lxr/ident?i=tdrift">tdrift</a>=rdc-&gt;<a class='fid' href="/lxr/ident?i=driftTime">driftTime</a>(<a class='fid' href="/lxr/ident?i=isvalid">isvalid</a>);
<a name=549 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#549">549</a>               <span class='reserved'>if</span> (!<a class='fid' href="/lxr/ident?i=isvalid">isvalid</a>) <a class='fid' href="/lxr/ident?i=tdrift">tdrift</a>=-<a class='fid' href="/lxr/ident?i=1">1</a>.;
<a name=550 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#550">550</a>               newhit.<a class='fid' href="/lxr/ident?i=set_tdrift">set_tdrift</a>(<a class='fid' href="/lxr/ident?i=tdrift">tdrift</a>);
<a name=551 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#551">551</a>             }
<a name=552 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#552">552</a>             <span class="comment">// if have track parameters, set residual directly</span>
<a name=553 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#553">553</a> <span class="comment"></span>            <span class='reserved'>if</span> (tparp!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=554 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#554">554</a>               <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=HepVector">HepVector</a>&amp; tparv=tparp-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>();
<a name=555 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#555">555</a>               newhit.<a class='fid' href="/lxr/ident?i=set_res">set_res</a>(<a class='fid' href="/lxr/ident?i=xdrift">xdrift</a>-tparv[<a class='fid' href="/lxr/ident?i=0">0</a>]);
<a name=556 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#556">556</a>             } <span class='reserved'>else</span> {
<a name=557 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#557">557</a>               <span class="comment">// have to calculate residual by extrap from nearest scatterer</span>
<a name=558 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#558">558</a> <span class="comment"></span>              <span class='reserved'>float</span> d2min=<a class='fid' href="/lxr/ident?i=1">1</a>.E10;
<a name=559 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#559">559</a>               <span class='reserved'>int</span> jhit=-<a class='fid' href="/lxr/ident?i=1">1</a>;
<a name=560 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#560">560</a>               <span class='reserved'>for</span> (<span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=j">j</a>=<a class='fid' href="/lxr/ident?i=0">0</a>;<a class='fid' href="/lxr/ident?i=j">j</a>&lt;<a class='fid' href="/lxr/ident?i=nscat">nscat</a>;++<a class='fid' href="/lxr/ident?i=j">j</a>) {
<a name=561 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#561">561</a>                 <span class='reserved'>float</span> <a class='fid' href="/lxr/ident?i=d2">d2</a>=<a class='fid' href="/lxr/ident?i=pow">pow</a>(tpos.<a class='fid' href="/lxr/ident?i=x">x</a>()-posscat[<a class='fid' href="/lxr/ident?i=j">j</a>].<a class='fid' href="/lxr/ident?i=x">x</a>(),2.)+
<a name=562 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#562">562</a>                   <a class='fid' href="/lxr/ident?i=pow">pow</a>(tpos.<a class='fid' href="/lxr/ident?i=y">y</a>()-posscat[<a class='fid' href="/lxr/ident?i=j">j</a>].<a class='fid' href="/lxr/ident?i=y">y</a>(),2.)+
<a name=563 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#563">563</a>                   <a class='fid' href="/lxr/ident?i=pow">pow</a>(tpos.<a class='fid' href="/lxr/ident?i=z">z</a>()-posscat[<a class='fid' href="/lxr/ident?i=j">j</a>].<a class='fid' href="/lxr/ident?i=z">z</a>(),2.);
<a name=564 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#564">564</a>                 <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=d2">d2</a>&lt;d2min) {
<a name=565 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#565">565</a>                   d2min=<a class='fid' href="/lxr/ident?i=d2">d2</a>;
<a name=566 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#566">566</a>                   jhit=<a class='fid' href="/lxr/ident?i=j">j</a>;
<a name=567 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#567">567</a>                 }
<a name=568 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#568">568</a>               }
<a name=569 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#569">569</a>               <span class='reserved'>if</span> (jhit&gt;=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=570 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#570">570</a>                 <span class="comment">// could now extrapolate to TRThit </span>
<a name=571 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#571">571</a> <span class="comment"></span>                <span class="comment">// not yet implemneted - how to get the surface for a TRThit?</span>
<a name=572 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#572">572</a> <span class="comment"></span>              }
<a name=573 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#573">573</a>             }  
<a name=574 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#574">574</a>             <a class='fid' href="/lxr/ident?i=ntrthits">ntrthits</a>++;
<a name=575 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#575">575</a>             aligntrk.<a class='fid' href="/lxr/ident?i=add_trthit">add_trthit</a>(newhit);
<a name=576 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#576">576</a>           } <span class='reserved'>else</span> {
<a name=577 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#577">577</a>             <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"TRT drift RIO cast failed - no hit stored"</span> 
<a name=578 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#578">578</a>                 &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=579 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#579">579</a>           }
<a name=580 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#580">580</a>         } <span class="comment">// identified TRT hit</span>
<a name=581 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#581">581</a> <span class="comment"></span>      } <span class="comment">// non-zero ROTpointer</span>
<a name=582 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#582">582</a> <span class="comment"></span>    } <span class="comment">// end of test for RIO</span>
<a name=583 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#583">583</a> <span class="comment"></span>    <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Track has "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=ntrthits">ntrthits</a> &lt;&lt; <span class='string'>" TRT hits "</span> );
<a name=584 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#584">584</a>   } <span class="comment">// end of TRT-specific code</span>
<a name=585 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#585">585</a> <span class="comment"></span>  <a class='fid' href="/lxr/ident?i=status">status</a>=<span class='reserved'>true</span>;
<a name=586 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#586">586</a>   <span class='reserved'>return</span> aligntrk;
<a name=587 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#587">587</a> }
<a name=588 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#588">588</a> 
<a name=589 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#589">589</a> <span class='reserved'>void</span> <a class='fid' href="/lxr/ident?i=InDetAlignNt">InDetAlignNt</a>::<a class='fid' href="/lxr/ident?i=FillAngles">FillAngles</a>(<a class='fid' href="/lxr/ident?i=AlignSiHit">AlignSiHit</a>&amp; ahit,<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=HepVector">HepVector</a>&amp; tparv,
<a name=590 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#590">590</a>                               <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=ScatteringAngles">ScatteringAngles</a>* saosp) {
<a name=591 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#591">591</a> 
<a name=592 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#592">592</a>   <span class="comment">// extract local track direction</span>
<a name=593 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#593">593</a> <span class="comment"></span>  <a class='fid' href="/lxr/ident?i=HepRotation">HepRotation</a>&amp; global2local=<a class='fid' href="/lxr/ident?i=m_global2local">m_global2local</a>[ahit.<a class='fid' href="/lxr/ident?i=index">index</a>()-<a class='fid' href="/lxr/ident?i=1">1</a>];
<a name=594 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#594">594</a>   <span class="comment">// fill track direction even if no associated scatterer</span>
<a name=595 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#595">595</a> <span class="comment"></span>  <span class='reserved'>float</span> gtheta=tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>];
<a name=596 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#596">596</a>   <span class='reserved'>float</span> <a class='fid' href="/lxr/ident?i=gphi">gphi</a>=tparv[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>];
<a name=597 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#597">597</a> 
<a name=598 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#598">598</a>   <a class='fid' href="/lxr/ident?i=HepPoint3D">HepPoint3D</a> local_dir=global2local*
<a name=599 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#599">599</a>     <a class='fid' href="/lxr/ident?i=HepPoint3D">HepPoint3D</a>(<a class='fid' href="/lxr/ident?i=sin">sin</a>(gtheta)*<a class='fid' href="/lxr/ident?i=cos">cos</a>(<a class='fid' href="/lxr/ident?i=gphi">gphi</a>),<a class='fid' href="/lxr/ident?i=sin">sin</a>(gtheta)*<a class='fid' href="/lxr/ident?i=sin">sin</a>(<a class='fid' href="/lxr/ident?i=gphi">gphi</a>),<a class='fid' href="/lxr/ident?i=cos">cos</a>(gtheta));
<a name=600 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#600">600</a> 
<a name=601 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#601">601</a>   ahit.<a class='fid' href="/lxr/ident?i=set_locang">set_locang</a>(local_dir.<a class='fid' href="/lxr/ident?i=theta">theta</a>(),<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=602 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#602">602</a>   ahit.<a class='fid' href="/lxr/ident?i=set_locang">set_locang</a>(local_dir.<a class='fid' href="/lxr/ident?i=phi">phi</a>(),<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=603 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#603">603</a>   ahit.<a class='fid' href="/lxr/ident?i=set_globang">set_globang</a>(<a class='fid' href="/lxr/ident?i=1">1</a>/<a class='fid' href="/lxr/ident?i=tan">tan</a>(gtheta),<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=604 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#604">604</a>   ahit.<a class='fid' href="/lxr/ident?i=set_globang">set_globang</a>(<a class='fid' href="/lxr/ident?i=gphi">gphi</a>,<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=605 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#605">605</a> 
<a name=606 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#606">606</a>   <span class="comment">// fill delta and sigma of track direction only if scatterer present</span>
<a name=607 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#607">607</a> <span class="comment"></span>  <span class='reserved'>if</span> (saosp!=<a class='fid' href="/lxr/ident?i=NULL">NULL</a>) {
<a name=608 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#608">608</a> 
<a name=609 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#609">609</a>     <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a> ( <span class='string'>"-&gt; gtheta "</span> &lt;&lt; gtheta &lt;&lt; <span class='string'>", gphi "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=gphi">gphi</a> );
<a name=610 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#610">610</a>     <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a> ( <span class='string'>"Filled Scattering angles del "</span> &lt;&lt; saosp-&gt;<a class='fid' href="/lxr/ident?i=deltaTheta">deltaTheta</a>() 
<a name=611 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#611">611</a>         &lt;&lt; <span class='string'>","</span> &lt;&lt; saosp-&gt;<a class='fid' href="/lxr/ident?i=deltaPhi">deltaPhi</a>() &lt;&lt; <span class='string'>","</span> &lt;&lt; saosp-&gt;<a class='fid' href="/lxr/ident?i=sigmaDeltaTheta">sigmaDeltaTheta</a>() &lt;&lt; <span class='string'>","</span> &lt;&lt; 
<a name=612 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#612">612</a>       saosp-&gt;<a class='fid' href="/lxr/ident?i=sigmaDeltaPhi">sigmaDeltaPhi</a>() );
<a name=613 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#613">613</a> 
<a name=614 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#614">614</a>     <span class='reserved'>float</span> ngtheta=gtheta+saosp-&gt;<a class='fid' href="/lxr/ident?i=deltaTheta">deltaTheta</a>();
<a name=615 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#615">615</a>     <span class='reserved'>float</span> ngphi=<a class='fid' href="/lxr/ident?i=gphi">gphi</a>+saosp-&gt;<a class='fid' href="/lxr/ident?i=deltaPhi">deltaPhi</a>();
<a name=616 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#616">616</a>     <span class='reserved'>float</span> rgtheta=gtheta+saosp-&gt;<a class='fid' href="/lxr/ident?i=sigmaDeltaTheta">sigmaDeltaTheta</a>();
<a name=617 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#617">617</a>     <span class='reserved'>float</span> rgphi=<a class='fid' href="/lxr/ident?i=gphi">gphi</a>+saosp-&gt;<a class='fid' href="/lxr/ident?i=sigmaDeltaPhi">sigmaDeltaPhi</a>();
<a name=618 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#618">618</a> 
<a name=619 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#619">619</a>     <a class='fid' href="/lxr/ident?i=HepPoint3D">HepPoint3D</a> new_local_dir=global2local*
<a name=620 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#620">620</a>       <a class='fid' href="/lxr/ident?i=HepPoint3D">HepPoint3D</a>(<a class='fid' href="/lxr/ident?i=sin">sin</a>(ngtheta)*<a class='fid' href="/lxr/ident?i=cos">cos</a>(ngphi),<a class='fid' href="/lxr/ident?i=sin">sin</a>(ngtheta)*<a class='fid' href="/lxr/ident?i=sin">sin</a>(ngphi),<a class='fid' href="/lxr/ident?i=cos">cos</a>(ngtheta));
<a name=621 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#621">621</a>     <a class='fid' href="/lxr/ident?i=HepPoint3D">HepPoint3D</a> rms_local_dir=global2local*
<a name=622 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#622">622</a>       <a class='fid' href="/lxr/ident?i=HepPoint3D">HepPoint3D</a>(<a class='fid' href="/lxr/ident?i=sin">sin</a>(rgtheta)*<a class='fid' href="/lxr/ident?i=cos">cos</a>(rgphi),<a class='fid' href="/lxr/ident?i=sin">sin</a>(rgtheta)*<a class='fid' href="/lxr/ident?i=sin">sin</a>(rgphi),<a class='fid' href="/lxr/ident?i=cos">cos</a>(rgtheta));
<a name=623 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#623">623</a> 
<a name=624 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#624">624</a>     ahit.<a class='fid' href="/lxr/ident?i=set_locdel">set_locdel</a>(new_local_dir.<a class='fid' href="/lxr/ident?i=theta">theta</a>()-local_dir.<a class='fid' href="/lxr/ident?i=theta">theta</a>(),<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=625 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#625">625</a>     ahit.<a class='fid' href="/lxr/ident?i=set_locdel">set_locdel</a>(new_local_dir.<a class='fid' href="/lxr/ident?i=phi">phi</a>()-local_dir.<a class='fid' href="/lxr/ident?i=phi">phi</a>(),<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=626 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#626">626</a>     ahit.<a class='fid' href="/lxr/ident?i=set_locedel">set_locedel</a>(<a class='fid' href="/lxr/ident?i=fabs">fabs</a>(rms_local_dir.<a class='fid' href="/lxr/ident?i=theta">theta</a>()-local_dir.<a class='fid' href="/lxr/ident?i=theta">theta</a>()),<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=627 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#627">627</a>     ahit.<a class='fid' href="/lxr/ident?i=set_locedel">set_locedel</a>(<a class='fid' href="/lxr/ident?i=fabs">fabs</a>(rms_local_dir.<a class='fid' href="/lxr/ident?i=phi">phi</a>()-local_dir.<a class='fid' href="/lxr/ident?i=phi">phi</a>()),<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=628 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#628">628</a>     <span class="comment">// for iPat legacy tracks, need to convert from variance to RMS</span>
<a name=629 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#629">629</a> <span class="comment"></span>    <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=m_ipattrk">m_ipattrk</a>) {
<a name=630 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#630">630</a>       ahit.<a class='fid' href="/lxr/ident?i=set_locedel">set_locedel</a>(<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(ahit.<a class='fid' href="/lxr/ident?i=locedel">locedel</a>(<a class='fid' href="/lxr/ident?i=0">0</a>)),<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=631 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#631">631</a>       ahit.<a class='fid' href="/lxr/ident?i=set_locedel">set_locedel</a>(<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(ahit.<a class='fid' href="/lxr/ident?i=locedel">locedel</a>(<a class='fid' href="/lxr/ident?i=1">1</a>)),<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=632 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#632">632</a>     }
<a name=633 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#633">633</a>     ahit.<a class='fid' href="/lxr/ident?i=set_globdel">set_globdel</a>(saosp-&gt;<a class='fid' href="/lxr/ident?i=deltaTheta">deltaTheta</a>(),<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=634 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#634">634</a>     ahit.<a class='fid' href="/lxr/ident?i=set_globdel">set_globdel</a>(saosp-&gt;<a class='fid' href="/lxr/ident?i=deltaPhi">deltaPhi</a>(),<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=635 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#635">635</a>     ahit.<a class='fid' href="/lxr/ident?i=set_globedel">set_globedel</a>(saosp-&gt;<a class='fid' href="/lxr/ident?i=sigmaDeltaTheta">sigmaDeltaTheta</a>(),<a class='fid' href="/lxr/ident?i=0">0</a>);
<a name=636 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#636">636</a>     ahit.<a class='fid' href="/lxr/ident?i=set_globedel">set_globedel</a>(saosp-&gt;<a class='fid' href="/lxr/ident?i=sigmaDeltaPhi">sigmaDeltaPhi</a>(),<a class='fid' href="/lxr/ident?i=1">1</a>);
<a name=637 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#637">637</a>   }
<a name=638 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#638">638</a> }
<a name=639 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#639">639</a> 
<a name=640 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#640">640</a> <span class='reserved'>void</span> <a class='fid' href="/lxr/ident?i=InDetAlignNt">InDetAlignNt</a>::<a class='fid' href="/lxr/ident?i=FillResid">FillResid</a>(<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=RIO_OnTrack">RIO_OnTrack</a>* rotp,
<a name=641 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#641">641</a>                              <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* tparp, <a class='fid' href="/lxr/ident?i=AlignSiHit">AlignSiHit</a>&amp; newhit) {
<a name=642 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#642">642</a>   <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=LocalParameters">LocalParameters</a> localp=rotp-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>();
<a name=643 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#643">643</a> 
<a name=644 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#644">644</a>   <span class="comment">//msg (MSG::INFO) &lt;&lt; "Hit local x/y " &lt;&lt; localp[Trk::locX] &lt;&lt; "," &lt;&lt; </span>
<a name=645 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#645">645</a> <span class="comment"></span>  <span class="comment">//   localp[Trk::locY] &lt;&lt; </span>
<a name=646 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#646">646</a> <span class="comment"></span>  <span class="comment">// " global r,phi,z " &lt;&lt; newhit.r() &lt;&lt; "," &lt;&lt; newhit.phi() &lt;&lt; "," &lt;&lt; </span>
<a name=647 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#647">647</a> <span class="comment"></span>  <span class="comment">// newhit.z() &lt;&lt; endreq;</span>
<a name=648 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#648">648</a> <span class="comment"></span>
<a name=649 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#649">649</a>   <span class="comment">// first set to -1 in case extrapolation fails</span>
<a name=650 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#650">650</a> <span class="comment"></span>  newhit.<a class='fid' href="/lxr/ident?i=set_rphi_resid">set_rphi_resid</a>(-<a class='fid' href="/lxr/ident?i=1">1</a>.);
<a name=651 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#651">651</a>   newhit.<a class='fid' href="/lxr/ident?i=set_z_resid">set_z_resid</a>(-<a class='fid' href="/lxr/ident?i=1">1</a>.);
<a name=652 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#652">652</a> 
<a name=653 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#653">653</a>   <span class='reserved'>if</span> (newhit.<a class='fid' href="/lxr/ident?i=index">index</a>()&gt;<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=654 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#654">654</a>     <span class="comment">//msg (MSG::INFO) &lt;&lt; "Call extrap for module " &lt;&lt; newhit.index()-1 &lt;&lt;</span>
<a name=655 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#655">655</a> <span class="comment"></span>    <span class="comment">//  " surf ptr " &lt;&lt; (m_detelep[newhit.index()-1])-&gt;surface() &lt;&lt; endreq;</span>
<a name=656 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#656">656</a> <span class="comment"></span>    <span class="comment">//msg (MSG::INFO) &lt;&lt; "track associated surface ptr " &lt;&lt; </span>
<a name=657 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#657">657</a> <span class="comment"></span>    <span class="comment">//  tparp-&gt;associatedSurface() &lt;&lt; " resolving to " &lt;&lt; </span>
<a name=658 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#658">658</a> <span class="comment"></span>    <span class="comment">//    *(tparp-&gt;associatedSurface()) &lt;&lt; endreq;</span>
<a name=659 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#659">659</a> <span class="comment"></span>    <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=InDetDD">InDetDD</a>::<a class='fid' href="/lxr/ident?i=SiDetectorElement">SiDetectorElement</a>* detelm=<a class='fid' href="/lxr/ident?i=m_detelep">m_detelep</a>[newhit.<a class='fid' href="/lxr/ident?i=index">index</a>()-<a class='fid' href="/lxr/ident?i=1">1</a>];
<a name=660 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#660">660</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* paratsurf=
<a name=661 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#661">661</a>       <a class='fid' href="/lxr/ident?i=m_extraptool">m_extraptool</a>-&gt;<a class='fid' href="/lxr/ident?i=extrapolate">extrapolate</a>(*tparp,
<a name=662 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#662">662</a>                                 detelm-&gt;<a class='fid' href="/lxr/ident?i=surface">surface</a>(),<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=anyDirection">anyDirection</a>,<span class='reserved'>false</span>);
<a name=663 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#663">663</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=HepVector">HepVector</a>&amp; tpars=paratsurf-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>();
<a name=664 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#664">664</a>     <span class='reserved'>float</span> xresid;
<a name=665 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#665">665</a>     <span class='reserved'>if</span> (detelm-&gt;<a class='fid' href="/lxr/ident?i=isSCT">isSCT</a>() &amp;&amp; detelm-&gt;<a class='fid' href="/lxr/ident?i=design">design</a>().<a class='fid' href="/lxr/ident?i=shape">shape</a>()==<a class='fid' href="/lxr/ident?i=InDetDD">InDetDD</a>::<a class='fid' href="/lxr/ident?i=Trapezoid">Trapezoid</a>) {
<a name=666 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#666">666</a>       <span class="comment">// special correction for SCT endcap to account for strip fanout</span>
<a name=667 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#667">667</a> <span class="comment"></span>      <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=HepPoint3D">HepPoint3D</a>&amp; rtrk=paratsurf-&gt;<a class='fid' href="/lxr/ident?i=position">position</a>();
<a name=668 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#668">668</a>       <span class='reserved'>float</span> rcor=newhit.<a class='fid' href="/lxr/ident?i=r">r</a>()/<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(rtrk.<a class='fid' href="/lxr/ident?i=x">x</a>()*rtrk.<a class='fid' href="/lxr/ident?i=x">x</a>()+rtrk.<a class='fid' href="/lxr/ident?i=y">y</a>()*rtrk.<a class='fid' href="/lxr/ident?i=y">y</a>());
<a name=669 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#669">669</a>       xresid=localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]-rcor*tpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>];
<a name=670 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#670">670</a>       xresid*=<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(<a class='fid' href="/lxr/ident?i=1">1</a>-newhit.<a class='fid' href="/lxr/ident?i=sinlocal">sinlocal</a>()*newhit.<a class='fid' href="/lxr/ident?i=sinlocal">sinlocal</a>());
<a name=671 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#671">671</a>     } <span class='reserved'>else</span> {
<a name=672 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#672">672</a>       <span class="comment">// conventional planar residual</span>
<a name=673 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#673">673</a> <span class="comment"></span>      xresid=localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]-tpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>];
<a name=674 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#674">674</a>     }
<a name=675 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#675">675</a>     <span class="comment">// msg (MSG::INFO) &lt;&lt; " extrap local x,y " &lt;&lt; tpars[Trk::locX] &lt;&lt; ","</span>
<a name=676 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#676">676</a> <span class="comment"></span>    <span class="comment">//   &lt;&lt; tpars[Trk::locY] &lt;&lt; " cf hit " &lt;&lt; localp[Trk::locX] &lt;&lt; "," &lt;&lt; </span>
<a name=677 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#677">677</a> <span class="comment"></span>    <span class="comment">// localp[Trk::locY] </span>
<a name=678 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#678">678</a> <span class="comment"></span>    <span class="comment">//   &lt;&lt; " calc xresid " &lt;&lt; xresid &lt;&lt; endreq;</span>
<a name=679 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#679">679</a> <span class="comment"></span>    newhit.<a class='fid' href="/lxr/ident?i=set_rphi_resid">set_rphi_resid</a>(xresid);
<a name=680 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#680">680</a>     <span class='reserved'>if</span> (detelm-&gt;<a class='fid' href="/lxr/ident?i=isPixel">isPixel</a>()) {
<a name=681 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#681">681</a>       <span class="comment">// note endcap pixels are planer - no fanout correction</span>
<a name=682 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#682">682</a> <span class="comment"></span>      newhit.<a class='fid' href="/lxr/ident?i=set_z_resid">set_z_resid</a>(localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]-tpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]);
<a name=683 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#683">683</a>     }
<a name=684 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#684">684</a>     newhit.<a class='fid' href="/lxr/ident?i=set_delzr">set_delzr</a>(tpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]-localp[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]);
<a name=685 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#685">685</a>   } <span class='reserved'>else</span> {
<a name=686 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#686">686</a>     <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"Cannot extrapolate as hit index zero "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=687 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#687">687</a>   }
<a name=688 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#688">688</a> }
<a name=689 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#689">689</a> 
<a name=690 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#690">690</a> <span class='reserved'>void</span> <a class='fid' href="/lxr/ident?i=InDetAlignNt">InDetAlignNt</a>::<a class='fid' href="/lxr/ident?i=TrkSetTruth">TrkSetTruth</a>(<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=DataVector">DataVector</a>&lt;<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Track">Track</a>&gt;* <a class='fid' href="/lxr/ident?i=trks">trks</a>,
<a name=691 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#691">691</a>                                <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Track">Track</a>* ptrk,<a class='fid' href="/lxr/ident?i=AlignTrk">AlignTrk</a>&amp; aligntrk) {
<a name=692 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#692">692</a>   <span class="comment">// set up truth information in AlignTrk from TrackTrk</span>
<a name=693 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#693">693</a> <span class="comment"></span>  <span class="comment">// used by both standard AlignTrk production from TrkTrack and refit,</span>
<a name=694 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#694">694</a> <span class="comment"></span>  <span class="comment">// where truth information must be set from parent track</span>
<a name=695 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#695">695</a> <span class="comment"></span> 
<a name=696 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#696">696</a>   <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=TrackTruthCollection">TrackTruthCollection</a>* trucp;
<a name=697 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#697">697</a>   <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=StatusCode">StatusCode</a>::<a class='fid' href="/lxr/ident?i=SUCCESS">SUCCESS</a>==<a class='fid' href="/lxr/ident?i=evtStore">evtStore</a>()-&gt;<a class='fid' href="/lxr/ident?i=retrieve">retrieve</a>(trucp,<a class='fid' href="/lxr/ident?i=par_trktruthcol">par_trktruthcol</a>)) {
<a name=698 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#698">698</a>     <a class='fid' href="/lxr/ident?i=ElementLink">ElementLink</a>&lt;<a class='fid' href="/lxr/ident?i=TrackCollection">TrackCollection</a>&gt; tlink;
<a name=699 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#699">699</a>     tlink.<a class='fid' href="/lxr/ident?i=setElement">setElement</a>(<span class='reserved'>const_cast</span>&lt;<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Track">Track</a>*&gt;(ptrk));
<a name=700 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#700">700</a>     tlink.<a class='fid' href="/lxr/ident?i=setStorableObject">setStorableObject</a>(*<a class='fid' href="/lxr/ident?i=trks">trks</a>);
<a name=701 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#701">701</a>     <a class='fid' href="/lxr/ident?i=TrackTruthCollection">TrackTruthCollection</a>::<a class='fid' href="/lxr/ident?i=const_iterator">const_iterator</a> itmp=
<a name=702 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#702">702</a>       trucp-&gt;<a class='fid' href="/lxr/ident?i=find">find</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackTruthKey">TrackTruthKey</a>(tlink));
<a name=703 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#703">703</a>     <span class='reserved'>if</span> (itmp!=trucp-&gt;<a class='fid' href="/lxr/ident?i=end">end</a>()) {
<a name=704 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#704">704</a>       <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Track has truth barcode "</span> &lt;&lt; 
<a name=705 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#705">705</a>         itmp-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>.<a class='fid' href="/lxr/ident?i=barcode">barcode</a>());
<a name=706 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#706">706</a>       <span class='reserved'>if</span> ((itmp-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>.<a class='fid' href="/lxr/ident?i=barcode">barcode</a>()!=<a class='fid' href="/lxr/ident?i=0">0</a>) &amp;&amp; <a class='fid' href="/lxr/ident?i=m_mccolln">m_mccolln</a>!=<a class='fid' href="/lxr/ident?i=0">0</a>)
<a name=707 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#707">707</a>         <a class='fid' href="/lxr/ident?i=FillTruth">FillTruth</a>(aligntrk,(*<a class='fid' href="/lxr/ident?i=m_mccolln">m_mccolln</a>-&gt;<a class='fid' href="/lxr/ident?i=begin">begin</a>())
<a name=708 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#708">708</a>                   -&gt;<a class='fid' href="/lxr/ident?i=barcode_to_particle">barcode_to_particle</a>(itmp-&gt;<a class='fid' href="/lxr/ident?i=second">second</a>.<a class='fid' href="/lxr/ident?i=barcode">barcode</a>()));
<a name=709 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#709">709</a>     } <span class='reserved'>else</span> {
<a name=710 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#710">710</a>       <a class='fid' href="/lxr/ident?i=ATH_MSG_DEBUG">ATH_MSG_DEBUG</a>( <span class='string'>"Cannot find truth in map!"</span> );
<a name=711 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#711">711</a>     }
<a name=712 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#712">712</a>   } <span class='reserved'>else</span> {
<a name=713 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#713">713</a>     <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"Cannot find "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=par_trktruthcol">par_trktruthcol</a> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=714 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#714">714</a>   }
<a name=715 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#715">715</a> }
<a name=716 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#716">716</a> 
<a name=717 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#717">717</a> <span class='reserved'>void</span> <a class='fid' href="/lxr/ident?i=InDetAlignNt">InDetAlignNt</a>::<a class='fid' href="/lxr/ident?i=FillNumDeriv">FillNumDeriv</a>(<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=AlignTrk">AlignTrk</a>&amp; altrk,
<a name=718 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#718">718</a>                                 <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* tparp,
<a name=719 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#719">719</a>                                 <a class='fid' href="/lxr/ident?i=AlignSiHit">AlignSiHit</a>&amp; newhit) {
<a name=720 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#720">720</a> 
<a name=721 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#721">721</a>   <span class="comment">// extrapolate track back to origin perigee parameters, then calculate</span>
<a name=722 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#722">722</a> <span class="comment"></span>  <span class="comment">// derivatives of alignment wrt to each</span>
<a name=723 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#723">723</a> <span class="comment"></span>  <span class="comment">// skip derivatives which are not requested to be calculated analytically</span>
<a name=724 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#724">724</a> <span class="comment"></span> 
<a name=725 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#725">725</a>   <span class="comment">// first determine perigee parameters in this track model by extrapolation</span>
<a name=726 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#726">726</a> <span class="comment"></span>  <span class="comment">// back to origin</span>
<a name=727 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#727">727</a> <span class="comment"></span>  <span class='reserved'>double</span> peritrk[5];
<a name=728 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#728">728</a>   <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=PerigeeSurface">PerigeeSurface</a> perisurf;
<a name=729 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#729">729</a>   <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* pperitrk=
<a name=730 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#730">730</a>     <a class='fid' href="/lxr/ident?i=m_extraptool">m_extraptool</a>-&gt;<a class='fid' href="/lxr/ident?i=extrapolate">extrapolate</a>(*tparp,perisurf,
<a name=731 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#731">731</a>                               <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=anyDirection">anyDirection</a>,<span class='reserved'>false</span>);
<a name=732 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#732">732</a>   <span class='reserved'>if</span> (pperitrk!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=733 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#733">733</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=HepVector">HepVector</a>&amp; peripars=pperitrk-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>();
<a name=734 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#734">734</a>     peritrk[<a class='fid' href="/lxr/ident?i=0">0</a>]=peripars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=d0">d0</a>];
<a name=735 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#735">735</a>     peritrk[<a class='fid' href="/lxr/ident?i=1">1</a>]=peripars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=z0">z0</a>];
<a name=736 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#736">736</a>     peritrk[2]=peripars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi0">phi0</a>];
<a name=737 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#737">737</a>     peritrk[3]=peripars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>];
<a name=738 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#738">738</a>     peritrk[4]=peripars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>];
<a name=739 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#739">739</a>     <span class='reserved'>double</span> <a class='fid' href="/lxr/ident?i=sinth">sinth</a>=<a class='fid' href="/lxr/ident?i=sin">sin</a>(peritrk[3]);
<a name=740 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#740">740</a>     <span class='reserved'>double</span> jac[5];
<a name=741 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#741">741</a>     jac[<a class='fid' href="/lxr/ident?i=0">0</a>]=<a class='fid' href="/lxr/ident?i=1">1</a>.;
<a name=742 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#742">742</a>     jac[<a class='fid' href="/lxr/ident?i=1">1</a>]=<a class='fid' href="/lxr/ident?i=1">1</a>.;
<a name=743 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#743">743</a>     jac[2]=<a class='fid' href="/lxr/ident?i=1">1</a>.;
<a name=744 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#744">744</a>     jac[3]=-<a class='fid' href="/lxr/ident?i=sinth">sinth</a>*<a class='fid' href="/lxr/ident?i=sinth">sinth</a>;
<a name=745 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#745">745</a>     jac[4]=<a class='fid' href="/lxr/ident?i=sinth">sinth</a>;
<a name=746 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#746">746</a> 
<a name=747 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#747">747</a>     <span class="comment">// now extrapolate to measurement surface</span>
<a name=748 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#748">748</a> <span class="comment"></span>    <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Surface">Surface</a>&amp; detsurf=(<a class='fid' href="/lxr/ident?i=m_detelep">m_detelep</a>[newhit.<a class='fid' href="/lxr/ident?i=index">index</a>()-<a class='fid' href="/lxr/ident?i=1">1</a>])-&gt;<a class='fid' href="/lxr/ident?i=surface">surface</a>();
<a name=749 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#749">749</a>     <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* pbasetrk=
<a name=750 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#750">750</a>       <a class='fid' href="/lxr/ident?i=m_extraptool">m_extraptool</a>-&gt;<a class='fid' href="/lxr/ident?i=extrapolate">extrapolate</a>(*pperitrk,detsurf,
<a name=751 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#751">751</a>                                 <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=alongMomentum">alongMomentum</a>,<span class='reserved'>false</span>);
<a name=752 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#752">752</a>     <span class='reserved'>if</span> (pbasetrk!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=753 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#753">753</a>       <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=HepVector">HepVector</a>&amp; basepars=pbasetrk-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>();
<a name=754 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#754">754</a>       <span class="comment">// now loop over all parameters, vary one at a time</span>
<a name=755 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#755">755</a> <span class="comment"></span>      <span class="comment">// variations based on 0.2 sigma of track parameter error</span>
<a name=756 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#756">756</a> <span class="comment"></span>      <span class="comment">// note aligntrk errors are in cottheta,q/pt</span>
<a name=757 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#757">757</a> <span class="comment"></span>      <span class='reserved'>double</span> varsig=<a class='fid' href="/lxr/ident?i=0">0</a>.2;
<a name=758 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#758">758</a>       <span class='reserved'>double</span> varpar[5],deltrkp[5];
<a name=759 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#759">759</a>       varpar[<a class='fid' href="/lxr/ident?i=0">0</a>]=varsig*<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(altrk.<a class='fid' href="/lxr/ident?i=trkcov">trkcov</a>(<a class='fid' href="/lxr/ident?i=1">1</a>));
<a name=760 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#760">760</a>       varpar[<a class='fid' href="/lxr/ident?i=1">1</a>]=varsig*<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(altrk.<a class='fid' href="/lxr/ident?i=trkcov">trkcov</a>(3));
<a name=761 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#761">761</a>       varpar[2]=varsig*<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(altrk.<a class='fid' href="/lxr/ident?i=trkcov">trkcov</a>(6));
<a name=762 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#762">762</a>       varpar[3]=varsig*<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(altrk.<a class='fid' href="/lxr/ident?i=trkcov">trkcov</a>(10))*jac[3];
<a name=763 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#763">763</a>       varpar[4]=varsig*<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(altrk.<a class='fid' href="/lxr/ident?i=trkcov">trkcov</a>(15))*jac[4];
<a name=764 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#764">764</a> 
<a name=765 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#765">765</a>       <span class='reserved'>for</span> (<span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=ipar">ipar</a>=<a class='fid' href="/lxr/ident?i=0">0</a>;<a class='fid' href="/lxr/ident?i=ipar">ipar</a>&lt;5;++<a class='fid' href="/lxr/ident?i=ipar">ipar</a>) {
<a name=766 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#766">766</a>         <span class="comment">// only extrapolate for derivatives which are requested numerically</span>
<a name=767 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#767">767</a> <span class="comment"></span>        <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=par_numdiv">par_numdiv</a> &amp; (<a class='fid' href="/lxr/ident?i=1">1</a> &lt;&lt; <a class='fid' href="/lxr/ident?i=ipar">ipar</a>)) {
<a name=768 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#768">768</a>           <span class="comment">// create new perturbed track</span>
<a name=769 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#769">769</a> <span class="comment"></span>          <span class='reserved'>for</span> (<span class='reserved'>int</span> <a class='fid' href="/lxr/ident?i=j">j</a>=<a class='fid' href="/lxr/ident?i=0">0</a>;<a class='fid' href="/lxr/ident?i=j">j</a>&lt;5;++<a class='fid' href="/lxr/ident?i=j">j</a>) deltrkp[<a class='fid' href="/lxr/ident?i=j">j</a>]=peritrk[<a class='fid' href="/lxr/ident?i=j">j</a>];
<a name=770 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#770">770</a>           deltrkp[<a class='fid' href="/lxr/ident?i=ipar">ipar</a>]=deltrkp[<a class='fid' href="/lxr/ident?i=ipar">ipar</a>]+varpar[<a class='fid' href="/lxr/ident?i=ipar">ipar</a>];
<a name=771 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#771">771</a>           <span class="comment">// fix for Q/pT vs Q/p:</span>
<a name=772 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#772">772</a> <span class="comment"></span>          <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=ipar">ipar</a>==3) {
<a name=773 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#773">773</a>             deltrkp[4]=deltrkp[4]-peritrk[4]*varpar[3]/<a class='fid' href="/lxr/ident?i=tan">tan</a>(peritrk[3]);
<a name=774 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#774">774</a>           }
<a name=775 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#775">775</a>           <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* pperivar=<span class='reserved'>new</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Perigee">Perigee</a>(deltrkp[<a class='fid' href="/lxr/ident?i=0">0</a>],
<a name=776 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#776">776</a>                                                                 deltrkp[<a class='fid' href="/lxr/ident?i=1">1</a>],
<a name=777 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#777">777</a>                                                                 deltrkp[2],
<a name=778 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#778">778</a>                                                                 deltrkp[3],
<a name=779 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#779">779</a>                                                                 deltrkp[4],
<a name=780 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#780">780</a>                                                                 perisurf);
<a name=781 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#781">781</a> 
<a name=782 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#782">782</a>           <span class="comment">// extrapolate new track to measurement surface</span>
<a name=783 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#783">783</a> <span class="comment"></span>          <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* pdeltrk= <a class='fid' href="/lxr/ident?i=m_extraptool">m_extraptool</a>-&gt;<a class='fid' href="/lxr/ident?i=extrapolate">extrapolate</a>(*pperivar,detsurf,
<a name=784 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#784">784</a>                                                                          <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=alongMomentum">alongMomentum</a>,<span class='reserved'>false</span>);
<a name=785 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#785">785</a>           <span class='reserved'>if</span> (pdeltrk!=<a class='fid' href="/lxr/ident?i=0">0</a>) {
<a name=786 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#786">786</a>             <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=HepVector">HepVector</a>&amp; delpars=pdeltrk-&gt;<a class='fid' href="/lxr/ident?i=parameters">parameters</a>();
<a name=787 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#787">787</a>    
<a name=788 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#788">788</a>             <span class='reserved'>if</span>(<a class='fid' href="/lxr/ident?i=std">std</a>::<a class='fid' href="/lxr/ident?i=isnan">isnan</a>(delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>])) <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=WARNING">WARNING</a>) &lt;&lt; <span class='string'>" delpars[Trk::locX] is nan"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=789 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#789">789</a>             <span class='reserved'>if</span>(<a class='fid' href="/lxr/ident?i=std">std</a>::<a class='fid' href="/lxr/ident?i=isnan">isnan</a>(delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>])) <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=WARNING">WARNING</a>) &lt;&lt; <span class='string'>" delpars[Trk::locY] is nan"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=790 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#790">790</a>             
<a name=791 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#791">791</a>             <span class="comment">// protection for nan values (should be outliers)</span>
<a name=792 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#792">792</a> <span class="comment"></span>            <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=std">std</a>::<a class='fid' href="/lxr/ident?i=isnan">isnan</a>(delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]) || <a class='fid' href="/lxr/ident?i=std">std</a>::<a class='fid' href="/lxr/ident?i=isnan">isnan</a>(delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>])) {
<a name=793 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#793">793</a>               <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=WARNING">WARNING</a> )&lt;&lt; <span class='string'>" -&gt; skip extrapolation"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=794 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#794">794</a>               <span class='reserved'>continue</span>;
<a name=795 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#795">795</a>             }
<a name=796 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#796">796</a> 
<a name=797 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#797">797</a>             <span class='reserved'>if</span>(<a class='fid' href="/lxr/ident?i=std">std</a>::<a class='fid' href="/lxr/ident?i=isnan">isnan</a>(delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>])) <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>" delpars[Trk::locX] is nan"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=798 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#798">798</a>             <span class='reserved'>if</span>(<a class='fid' href="/lxr/ident?i=std">std</a>::<a class='fid' href="/lxr/ident?i=isnan">isnan</a>(delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>])) <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>" delpars[Trk::locY] is nan"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=799 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#799">799</a> 
<a name=800 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#800">800</a>             <a class='fid' href="/lxr/ident?i=ATH_MSG_VERBOSE">ATH_MSG_VERBOSE</a>( <span class='string'>"Extrapolation "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=ipar">ipar</a> &lt;&lt; <span class='string'>" new local "</span> &lt;&lt;
<a name=801 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#801">801</a>               delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>] &lt;&lt; <span class='string'>","</span> &lt;&lt; delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>] );
<a name=802 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#802">802</a> 
<a name=803 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#803">803</a>             <a class='fid' href="/lxr/ident?i=ATH_MSG_VERBOSE">ATH_MSG_VERBOSE</a>( <span class='string'>"Shifts are "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=ipar">ipar</a> &lt;&lt; <span class='string'>" by "</span> &lt;&lt; 
<a name=804 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#804">804</a>               varpar[<a class='fid' href="/lxr/ident?i=ipar">ipar</a>] &lt;&lt; <span class='string'>" : "</span> &lt;&lt; delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]-basepars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>] &lt;&lt; 
<a name=805 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#805">805</a>               <span class='string'>","</span> &lt;&lt; delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]-basepars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]);
<a name=806 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#806">806</a> 
<a name=807 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#807">807</a>             <span class="comment">// take care of SCT fanout:</span>
<a name=808 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#808">808</a> <span class="comment"></span>            <span class='reserved'>double</span> <a class='fid' href="/lxr/ident?i=sl">sl</a>(newhit.<a class='fid' href="/lxr/ident?i=sinlocal">sinlocal</a>());
<a name=809 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#809">809</a>             <span class='reserved'>double</span> <a class='fid' href="/lxr/ident?i=cl">cl</a>(<a class='fid' href="/lxr/ident?i=sqrt">sqrt</a>(<a class='fid' href="/lxr/ident?i=1">1</a>.<a class='fid' href="/lxr/ident?i=0">0</a>-newhit.<a class='fid' href="/lxr/ident?i=sinlocal">sinlocal</a>()*newhit.<a class='fid' href="/lxr/ident?i=sinlocal">sinlocal</a>()));
<a name=810 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#810">810</a>             <span class='reserved'>double</span> dlocx(<a class='fid' href="/lxr/ident?i=cl">cl</a>*(basepars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]-delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>])
<a name=811 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#811">811</a>                          + <a class='fid' href="/lxr/ident?i=sl">sl</a>*(basepars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]-delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]));
<a name=812 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#812">812</a>             <span class='reserved'>double</span> dlocy(<a class='fid' href="/lxr/ident?i=cl">cl</a>*(basepars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>]-delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locY">locY</a>])
<a name=813 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#813">813</a>                          - <a class='fid' href="/lxr/ident?i=sl">sl</a>*(basepars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]-delpars[<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locX">locX</a>]));
<a name=814 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#814">814</a> 
<a name=815 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#815">815</a>             <span class="comment">// fill in derivatives - note convert back to cottheta,q/pt</span>
<a name=816 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#816">816</a> <span class="comment"></span>            newhit.<a class='fid' href="/lxr/ident?i=set_dtpar1">set_dtpar1</a>(jac[<a class='fid' href="/lxr/ident?i=ipar">ipar</a>]*dlocx/varpar[<a class='fid' href="/lxr/ident?i=ipar">ipar</a>],<a class='fid' href="/lxr/ident?i=ipar">ipar</a>);
<a name=817 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#817">817</a>             newhit.<a class='fid' href="/lxr/ident?i=set_dtpar2">set_dtpar2</a>(jac[<a class='fid' href="/lxr/ident?i=ipar">ipar</a>]*dlocy/varpar[<a class='fid' href="/lxr/ident?i=ipar">ipar</a>],<a class='fid' href="/lxr/ident?i=ipar">ipar</a>);
<a name=818 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#818">818</a>             <span class='reserved'>delete</span> pdeltrk;
<a name=819 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#819">819</a>           } 
<a name=820 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#820">820</a>           <span class='reserved'>else</span> {
<a name=821 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#821">821</a>             <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"FillNumDeriv Detla extraplation "</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=ipar">ipar</a> &lt;&lt; <span class='string'>"failed"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=822 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#822">822</a>           }
<a name=823 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#823">823</a>           <span class='reserved'>delete</span> pperivar;
<a name=824 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#824">824</a>         }
<a name=825 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#825">825</a>       }
<a name=826 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#826">826</a>       <span class='reserved'>delete</span> pbasetrk;
<a name=827 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#827">827</a>     } <span class='reserved'>else</span> {
<a name=828 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#828">828</a>       <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"FillNumDeriv base extrapolation failed"</span> &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=829 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#829">829</a>     }
<a name=830 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#830">830</a>     <span class='reserved'>delete</span> pperitrk;
<a name=831 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#831">831</a>   } <span class='reserved'>else</span> {
<a name=832 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#832">832</a>     <a class='fid' href="/lxr/ident?i=msg">msg</a> (<a class='fid' href="/lxr/ident?i=MSG">MSG</a>::<a class='fid' href="/lxr/ident?i=ERROR">ERROR</a>) &lt;&lt; <span class='string'>"FillNumDeriv backextrapolation failed from track: "</span>
<a name=833 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#833">833</a>         &lt;&lt; *tparp &lt;&lt; <a class='fid' href="/lxr/ident?i=endreq">endreq</a>;
<a name=834 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#834">834</a>   }
<a name=835 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#835">835</a> }
<a name=836 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#836">836</a> 
<a name=837 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#837">837</a> <span class='reserved'>void</span> <a class='fid' href="/lxr/ident?i=InDetAlignNt">InDetAlignNt</a>::<a class='fid' href="/lxr/ident?i=FillNumDeriviPat">FillNumDeriviPat</a>(<span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=AlignTrk">AlignTrk</a>&amp; aligntrk,
<a name=838 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#838">838</a>                                     <a class='fid' href="/lxr/ident?i=AlignSiHit">AlignSiHit</a>&amp; newhit) {
<a name=839 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#839">839</a>   <span class="comment">// interface to FillNumDeriv for iPat native tracks</span>
<a name=840 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#840">840</a> <span class="comment"></span>  <span class="comment">// create a temporary track based on the iPatTrack parameters to start</span>
<a name=841 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#841">841</a> <span class="comment"></span>  <span class="comment">// extrapolation - simplify by using perigee rather than local tpars</span>
<a name=842 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#842">842</a> <span class="comment"></span>  <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=PerigeeSurface">PerigeeSurface</a> perisurf;
<a name=843 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#843">843</a>   <span class='reserved'>float</span> <a class='fid' href="/lxr/ident?i=theta">theta</a>=<a class='fid' href="/lxr/ident?i=atan">atan</a>(<a class='fid' href="/lxr/ident?i=1">1</a>./aligntrk.<a class='fid' href="/lxr/ident?i=trkpar">trkpar</a>(4));
<a name=844 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#844">844</a>   <span class='reserved'>if</span> (<a class='fid' href="/lxr/ident?i=theta">theta</a>&lt;<a class='fid' href="/lxr/ident?i=0">0</a>) <a class='fid' href="/lxr/ident?i=theta">theta</a>+=3.1415926;
<a name=845 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#845">845</a>   <span class='reserved'>const</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=TrackParameters">TrackParameters</a>* tparp=<span class='reserved'>new</span> <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=Perigee">Perigee</a>(aligntrk.<a class='fid' href="/lxr/ident?i=trkpar">trkpar</a>(<a class='fid' href="/lxr/ident?i=1">1</a>),
<a name=846 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#846">846</a>                                                      aligntrk.<a class='fid' href="/lxr/ident?i=trkpar">trkpar</a>(2),
<a name=847 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#847">847</a>                                                      aligntrk.<a class='fid' href="/lxr/ident?i=trkpar">trkpar</a>(3),
<a name=848 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#848">848</a>                                                      <a class='fid' href="/lxr/ident?i=theta">theta</a>,
<a name=849 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#849">849</a>                                                      <a class='fid' href="/lxr/ident?i=sin">sin</a>(<a class='fid' href="/lxr/ident?i=theta">theta</a>)*aligntrk.<a class='fid' href="/lxr/ident?i=trkpar">trkpar</a>(5),
<a name=850 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#850">850</a>                                                      perisurf);
<a name=851 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#851">851</a>   <a class='fid' href="/lxr/ident?i=FillNumDeriv">FillNumDeriv</a>(aligntrk,tparp,newhit);
<a name=852 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#852">852</a>   <span class='reserved'>delete</span> tparp;
<a name=853 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#853">853</a> }
<a name=854 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#854">854</a> 
<a name=855 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#855">855</a> 
<a name=856 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#856">856</a> <span class='reserved'>double</span> <a class='fid' href="/lxr/ident?i=InDetAlignNt">InDetAlignNt</a>::<a class='fid' href="/lxr/ident?i=getErrorQonP">getErrorQonP</a>( <span class='reserved'>const</span>  <a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=PseudoMeasurementOnTrack">PseudoMeasurementOnTrack</a>* pmot ) <span class='reserved'>const</span>{
<a name=857 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#857">857</a>         <span class="comment">// The Size of the error matrix of the PseudoMeasurment is dependant on the measurements </span>
<a name=858 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#858">858</a> <span class="comment"></span>        <span class="comment">// within the PM (ie 1 PM 1x1 matrix etc)</span>
<a name=859 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#859">859</a> <span class="comment"></span>        
<a name=860 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#860">860</a>         <span class='reserved'>int</span> nmeas(<a class='fid' href="/lxr/ident?i=0">0</a>); 
<a name=861 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#861">861</a>         <span class='reserved'>if</span> (pmot-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>().<a class='fid' href="/lxr/ident?i=contains">contains</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locRPhi">locRPhi</a>)){
<a name=862 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#862">862</a>                 nmeas++;
<a name=863 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#863">863</a>         }
<a name=864 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#864">864</a>         <span class='reserved'>if</span> (pmot-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>().<a class='fid' href="/lxr/ident?i=contains">contains</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locZ">locZ</a>)){
<a name=865 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#865">865</a>                 nmeas++;
<a name=866 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#866">866</a>         }
<a name=867 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#867">867</a>         <span class='reserved'>if</span> (pmot-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>().<a class='fid' href="/lxr/ident?i=contains">contains</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>)){
<a name=868 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#868">868</a>                 nmeas++;
<a name=869 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#869">869</a>         }
<a name=870 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#870">870</a>         <span class='reserved'>if</span> (pmot-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>().<a class='fid' href="/lxr/ident?i=contains">contains</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>)){
<a name=871 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#871">871</a>                 nmeas++;        
<a name=872 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#872">872</a>         }
<a name=873 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#873">873</a>         <span class='reserved'>if</span> (pmot-&gt;<a class='fid' href="/lxr/ident?i=localParameters">localParameters</a>().<a class='fid' href="/lxr/ident?i=contains">contains</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>)){
<a name=874 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#874">874</a>                 nmeas++;
<a name=875 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#875">875</a>         }
<a name=876 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#876">876</a>         <span class='reserved'>if</span> (nmeas == <a class='fid' href="/lxr/ident?i=1">1</a>){
<a name=877 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#877">877</a>                 <span class='reserved'>return</span>  pmot-&gt;<a class='fid' href="/lxr/ident?i=localErrorMatrix">localErrorMatrix</a>().<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locRPhi">locRPhi</a>);   
<a name=878 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#878">878</a>         } <span class='reserved'>else</span> <span class='reserved'>if</span> (nmeas == 2){
<a name=879 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#879">879</a>                 <span class='reserved'>return</span>  pmot-&gt;<a class='fid' href="/lxr/ident?i=localErrorMatrix">localErrorMatrix</a>().<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=locZ">locZ</a>);
<a name=880 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#880">880</a>         } <span class='reserved'>else</span> <span class='reserved'>if</span> (nmeas == 3){
<a name=881 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#881">881</a>                 <span class='reserved'>return</span>  pmot-&gt;<a class='fid' href="/lxr/ident?i=localErrorMatrix">localErrorMatrix</a>().<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=phi">phi</a>);
<a name=882 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#882">882</a>         } <span class='reserved'>else</span> <span class='reserved'>if</span> (nmeas == 4){
<a name=883 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#883">883</a>                 <span class='reserved'>return</span>  pmot-&gt;<a class='fid' href="/lxr/ident?i=localErrorMatrix">localErrorMatrix</a>().<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=theta">theta</a>);
<a name=884 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#884">884</a>         } <span class='reserved'>else</span> <span class='reserved'>if</span> (nmeas == 5){
<a name=885 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#885">885</a>                 <span class='reserved'>return</span>  pmot-&gt;<a class='fid' href="/lxr/ident?i=localErrorMatrix">localErrorMatrix</a>().<a class='fid' href="/lxr/ident?i=error">error</a>(<a class='fid' href="/lxr/ident?i=Trk">Trk</a>::<a class='fid' href="/lxr/ident?i=qOverP">qOverP</a>);
<a name=886 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#886">886</a>         }
<a name=887 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#887">887</a>         
<a name=888 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#888">888</a>         <span class='reserved'>return</span> <a class='fid' href="/lxr/ident?i=0">0</a>.; 
<a name=889 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#889">889</a> 
<a name=890 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#890">890</a> }
<a name=891 class='fline' href="/lxr/source/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx#891">891</a> </pre>
<hr>
<table width="100%" cellpadding="0" border="0">
  <tr valign="middle">
    
    <td align="center" nowrap="nowrap">
      [&nbsp;<span class='modes-sel'>source navigation</span>&nbsp;]</td>
    <td align="center" nowrap="nowrap">
      [&nbsp;<a class='modes' href="/lxr/diff/atlas/InnerDetector/InDetAlignAlgs/InDetAlignGenAlgs/src/iTrkAlign.cxx">diff markup</a>&nbsp;]</td>
    <td align="center" nowrap="nowrap">
      [&nbsp;<a class='modes' href="/lxr/ident">identifier search</a>&nbsp;]</td>
    <td align="center" nowrap="nowrap">
      [&nbsp;<a class="modes" href="/lxr/search">general search</a>&nbsp;]</td>
  </tr>
</table>
<hr>
<table width="100%" cellpadding="0" border="0">
  <tr colspan=2>
  <td><B>Due to the LXR bug, the updates fail sometimes to remove references to deleted files. The Saturday's full rebuilds fix these problems</B> </td>
  <tr>
    <td align="left">
      This page was automatically generated by the 
      <a href="http://lxr.sf.net/">LXR engine</a>.
    </td>
    <td align="right">
      <a href="http://validator.w3.org/check/referer"><img border="0"
        src="http://www.w3.org/Icons/valid-html401"
        alt="Valid HTML 4.01!" height="31" width="88"></a>
    </td>
  </tr>
</table>

</body>
</html>
</html>
