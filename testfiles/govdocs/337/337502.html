<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>loon: Truthifier.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>Truthifier.cxx</h1><a href="Truthifier_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include "<a class="code" href="Truthifier_8h.html">Truthifier.h</a>"</span>
00002 <span class="preprocessor">#include "<a class="code" href="MsgService_8h.html">MessageService/MsgService.h</a>"</span>
00003 <span class="preprocessor">#include "<a class="code" href="CandStripHandle_8h.html">RecoBase/CandStripHandle.h</a>"</span>
00004 <span class="preprocessor">#include &lt;TClonesArray.h&gt;</span>
00005 
00006 <a class="code" href="MsgService_8h.html#a3">CVSID</a>( <span class="stringliteral">" $Id: Truthifier.cxx,v 1.14 2006/05/19 14:55:42 rhatcher Exp $"</span>);
00007 ClassImp(<a class="code" href="classTruthifier.html">Truthifier</a>)
00008 
00009 
00010 
00026 
00027 
00028 <span class="comment">// ----------------------------------------------------------------------- //</span>
<a name="l00029"></a><a class="code" href="classTruthifier.html#e0">00029</a> <span class="keyword">const</span> <a class="code" href="classTruthifier.html">Truthifier</a>&amp; <a class="code" href="classTruthifier.html#e0">Truthifier::Instance</a>( <span class="keyword">const</span> <a class="code" href="classMomNavigator.html">MomNavigator</a>* mom, Bool_t supressErrors )
00030 {
00035 
00036   <span class="comment">// Deal with the case of a null mom.</span>
00037   <span class="keyword">static</span> <a class="code" href="classTruthifier.html">Truthifier</a> nullTruth(0);
00038   <span class="keywordflow">if</span>(mom==0) <span class="keywordflow">return</span> nullTruth;
00039 
00040   <span class="comment">// Look for the simSnarl in Mom.</span>
00041   <a class="code" href="classSimSnarlRecord.html">SimSnarlRecord</a>* simsnarl = 0;
00042   TObject* tobj;
00043   TIter    fragiter = mom-&gt;<a class="code" href="classMomNavigator.html#a8">FragmentIter</a>();
00044   <span class="keywordflow">while</span>( ( tobj = fragiter.Next() ) ) {
00045     simsnarl = dynamic_cast&lt;SimSnarlRecord*&gt;(tobj);
00046     <span class="keywordflow">if</span>(simsnarl) <span class="keywordflow">break</span>;
00047   }
00048   
00049   <span class="keywordflow">if</span>(simsnarl==0) <span class="keywordflow">return</span> nullTruth; <span class="comment">// No good.</span>
00050 
00051   <span class="comment">// look for the Truthifier in the simSnarl.</span>
00052   <span class="keyword">const</span> TObject* o;
00053   o = simsnarl-&gt;<a class="code" href="classRecDataRecord.html#a8">FindTemporary</a>(<span class="stringliteral">"Truthifier"</span>,<span class="stringliteral">"Truthifier"</span>);
00054   <span class="keywordflow">if</span>(o) {
00055     <span class="comment">// Found one.</span>
00056     <a class="code" href="classTruthifier.html">Truthifier</a>* ct = const_cast&lt;Truthifier*&gt;(dynamic_cast&lt;const Truthifier*&gt;(o));
00057     <span class="keywordflow">if</span>(ct){
00058       <span class="keywordflow">if</span>(ct-&gt;<a class="code" href="classTruthifier.html#a2">IsValid</a>()) <span class="keywordflow">return</span> *ct;
00059       <span class="keywordflow">else</span> {
00060         ct-&gt;<a class="code" href="classTruthifier.html#a1">Reset</a>(mom,supressErrors);
00061         <span class="keywordflow">return</span> *ct;
00062         <span class="comment">// it's not valid. Tell the record to drop it.</span>
00063         <span class="comment">// whooops, this is illegal.</span>
00064         <span class="comment">//simsnarl-&gt;RemoveTemporary(o);</span>
00065       }
00066     }    
00067   }
00068 
00069   <span class="comment">// Ok, now there's no truthifier.</span>
00070   <span class="comment">// Make one.</span>
00071   <a class="code" href="classTruthifier.html">Truthifier</a>* t = <span class="keyword">new</span> <a class="code" href="classTruthifier.html#a0">Truthifier</a>(mom, supressErrors);
00072 
00073   <span class="comment">// Save it.</span>
00074   simsnarl-&gt;<a class="code" href="classRecDataRecord.html#a13">AdoptTemporary</a>(t);
00075   
00076   <span class="comment">// return it.</span>
00077   <span class="keywordflow">return</span> *t;
00078 }
00079 
00080 <span class="comment">// ----------------------------------------------------------------------- //</span>
<a name="l00081"></a><a class="code" href="classTruthifier.html#a1">00081</a> <span class="keywordtype">void</span> <a class="code" href="classTruthifier.html#a1">Truthifier::Reset</a>( <span class="keyword">const</span> <a class="code" href="classMomNavigator.html">MomNavigator</a>* mom, Bool_t supressErrors ) 
00082 {
00088 
00089   <a class="code" href="classTruthifier.html#r0">fMom</a> = mom;
00090   <a class="code" href="classTruthifier.html#r2">fRddb</a> = 0;
00091   <a class="code" href="classTruthifier.html#r3">fStdHep</a> = 0;
00092   <a class="code" href="classTruthifier.html#r6">fNeutrinoList</a>.clear();
00093   <a class="code" href="classTruthifier.html#r7">fTrackIndexToNeutrinoIndex</a>.clear();
00094   <a class="code" href="classTruthifier.html#r8">fNeutrinoIndexToTrackIndex</a>.clear();
00095   <a class="code" href="classTruthifier.html#r9">fTrackToHit</a>.clear();
00096   <a class="code" href="classTruthifier.html#r10">fHitToSignal</a>.clear();
00097   <a class="code" href="classTruthifier.html#r11">fSignalToDigit</a>.clear();
00098   <a class="code" href="classTruthifier.html#r12">fSignals</a>.clear(); 
00099   <a class="code" href="classTruthifier.html#r1">fValid</a>=<span class="keyword">false</span>;
00100 
00101   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r0">fMom</a> ==0 ) <span class="keywordflow">return</span>;
00102   
00103   <span class="comment">// Find the simsnarl.</span>
00104   <a class="code" href="classSimSnarlRecord.html">SimSnarlRecord</a>* simsnarl = 0;
00105   TObject* tobj;
00106   TIter    fragiter = mom-&gt;FragmentIter();
00107 
00108   <span class="comment">// Get the simsnarl.</span>
00109   <span class="keywordflow">while</span>( ( tobj = fragiter.Next() ) ) {
00110     simsnarl = dynamic_cast&lt;SimSnarlRecord*&gt;(tobj);
00111     <span class="keywordflow">if</span>(simsnarl) <span class="keywordflow">break</span>;
00112   }
00113   <span class="keywordflow">if</span>(simsnarl==0) { <a class="code" href="MsgService_8h.html#a4">MSG</a>(<span class="stringliteral">"DataUtil"</span>,Msg::kWarning) &lt;&lt; <span class="stringliteral">"Can't find simsnarl.\n"</span>; <span class="keywordflow">return</span>; };
00114   
00115   <span class="comment">// Get the scint hit array.</span>
00116   <a class="code" href="classTruthifier.html#r5">fScintHitArray</a> = 
00117     dynamic_cast&lt;const TObjArray*&gt;(simsnarl-&gt;<a class="code" href="classRecDataRecord.html#a7">FindComponent</a>(0,<span class="stringliteral">"DigiScintHits"</span>));
00118   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r5">fScintHitArray</a>==0) { 
00119 
00120     <span class="keywordflow">if</span>(!supressErrors) <a class="code" href="MsgService_8h.html#a4">MSG</a>(<span class="stringliteral">"DataUtil"</span>,Msg::kWarning) &lt;&lt; <span class="stringliteral">"Can't find scint hit array.\n"</span>; 
00121 
00122   } <span class="keywordflow">else</span> {
00123   
00124     <span class="comment">// Build the array of hits.</span>
00125     TIter hitarrayIter(<a class="code" href="classTruthifier.html#r5">fScintHitArray</a>);
00126     <span class="keywordflow">while</span>( (tobj = hitarrayIter.Next()) ) {
00127       <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* scinthit = dynamic_cast&lt;DigiScintHit*&gt;(tobj);
00128       <span class="keywordflow">if</span>(scinthit)
00129         <a class="code" href="classTruthifier.html#r9">fTrackToHit</a>[scinthit-&gt;<a class="code" href="classDigiScintHit.html#a6">TrackId</a>()].push_back(scinthit);
00130     }
00131 
00132   }
00133 
00134   <span class="comment">// Get the signal array.</span>
00135   <span class="keyword">const</span> TObjArray* signalArray = 
00136     dynamic_cast&lt;const TObjArray*&gt;(simsnarl-&gt;<a class="code" href="classRecDataRecord.html#a7">FindComponent</a>(0,<span class="stringliteral">"DigiSignal"</span>));
00137   <span class="keywordflow">if</span>(signalArray==0) { 
00138 
00139     <span class="keywordflow">if</span>(!supressErrors) <a class="code" href="MsgService_8h.html#a4">MSG</a>(<span class="stringliteral">"DataUtil"</span>,Msg::kWarning) &lt;&lt; <span class="stringliteral">"Can't find signal array.\n"</span>;
00140   
00141   } <span class="keywordflow">else</span> {
00142 
00143     <span class="comment">// Build the array of signals.</span>
00144     TIter signalIter(signalArray);
00145     <span class="keywordflow">while</span>( (tobj = signalIter.Next()) ) {
00146       <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = dynamic_cast&lt;DigiSignal*&gt;(tobj);
00147       <span class="keywordflow">if</span>(signal) {
00148         <a class="code" href="classTruthifier.html#r12">fSignals</a>[signal-&gt;<a class="code" href="classDigiSignal.html#a4">GetId</a>()] = signal;
00149         <span class="keywordflow">for</span>(UInt_t i=0;i&lt;signal-&gt;GetNumberOfHits();i++) {
00150           <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit = signal-&gt;GetHit(i);
00151           <span class="keywordflow">if</span>(hit) 
00152             <a class="code" href="classTruthifier.html#r10">fHitToSignal</a>[hit].push_back(signal);
00153         }
00154       }
00155     }
00156     <span class="keywordflow">if</span>(!supressErrors) <a class="code" href="MsgService_8h.html#a4">MSG</a>(<span class="stringliteral">"DataUtil"</span>,Msg::kDebug) &lt;&lt; <span class="stringliteral">"Got "</span> &lt;&lt; <a class="code" href="classTruthifier.html#r12">fSignals</a>.size() &lt;&lt; <span class="stringliteral">" signals."</span> &lt;&lt; std::endl;
00157 
00158   }
00159 
00160   <span class="comment">// Get the StdHep list.</span>
00161   <a class="code" href="classTruthifier.html#r3">fStdHep</a> = dynamic_cast&lt;const TClonesArray*&gt;(simsnarl-&gt;<a class="code" href="classRecDataRecord.html#a7">FindComponent</a>(<span class="stringliteral">"TClonesArray"</span>,<span class="stringliteral">"StdHep"</span>));
00162   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r3">fStdHep</a> ==0) {
00163    <span class="keywordflow">if</span>(!supressErrors)  <a class="code" href="MsgService_8h.html#a4">MSG</a>(<span class="stringliteral">"DataUtil"</span>,Msg::kWarning) &lt;&lt; <span class="stringliteral">"Can't find StdHep list.\n"</span>;
00164   } <span class="keywordflow">else</span> {
00165     <span class="comment">// Look through initial pariticle list. Associate track ID with originating neutrinos</span>
00166     Int_t siz = <a class="code" href="classTruthifier.html#r3">fStdHep</a>-&gt;GetEntriesFast();
00167     <a class="code" href="classTruthifier.html#r7">fTrackIndexToNeutrinoIndex</a>.resize(siz);
00168     <a class="code" href="classTruthifier.html#r6">fNeutrinoList</a>.clear();
00169     Int_t neu = 0;
00170     <span class="keywordflow">for</span>(Int_t ind=0; ind&lt;siz; ind++) {
00171       TParticle* part = dynamic_cast&lt;TParticle*&gt;((*fStdHep)[ind]);
00172       
00173       <span class="comment">// Is this a lepton?</span>
00174       <span class="keywordflow">if</span>(<a class="code" href="NtpStNC_8h.html#a17">abs</a>(part-&gt;GetPdgCode())&gt;=12 &amp;&amp;
00175          <a class="code" href="NtpStNC_8h.html#a17">abs</a>(part-&gt;GetPdgCode())&lt;=16 
00176          ) {
00177         <span class="comment">// Is the status code "Documentation" or "null"?</span>
00178         <span class="comment">// This should indicate that it was an initial particle</span>
00179         <span class="comment">// into the event generator.</span>
00180         Int_t status = part-&gt;GetStatusCode();
00181         <span class="keywordflow">if</span>( status == 3 || status == 0 ) {
00182           <span class="comment">// We got a neutrino event!</span>
00183           neu=ind;
00184           <a class="code" href="classTruthifier.html#r6">fNeutrinoList</a>.push_back(ind);
00185         }
00186       }
00187       <a class="code" href="classTruthifier.html#r7">fTrackIndexToNeutrinoIndex</a>[ind]=neu;
00188       <a class="code" href="classTruthifier.html#r8">fNeutrinoIndexToTrackIndex</a>[neu].push_back(ind);
00189     }    
00190   }
00191 
00192   <span class="comment">// Get the NeuKin list.</span>
00193   <a class="code" href="classTruthifier.html#r4">fNeuKins</a> = dynamic_cast&lt;const TClonesArray*&gt;(simsnarl-&gt;<a class="code" href="classRecDataRecord.html#a7">FindComponent</a>(<span class="stringliteral">"TClonesArray"</span>,<span class="stringliteral">"NeuKinList"</span>));
00194   
00195   <span class="comment">// Find the RDDB.</span>
00196   <span class="keyword">const</span> <a class="code" href="classRawHeader.html">RawHeader</a>* rawhead =0;
00197   <a class="code" href="classTruthifier.html#r2">fRddb</a> =0;
00198   fragiter.Reset();
00199   <span class="keywordflow">while</span>( ( tobj = fragiter.Next() ) ) {
00200     <a class="code" href="classRawRecord.html">RawRecord</a>* rawRec = dynamic_cast&lt;RawRecord*&gt;(tobj);
00201     <span class="keywordflow">if</span>(rawRec) {
00202       rawhead = rawRec-&gt;<a class="code" href="classRawRecord.html#a3">GetRawHeader</a>();
00203       TIter itr = rawRec-&gt;<a class="code" href="classRawRecord.html#a6">GetRawBlockIter</a>();
00204       <a class="code" href="classRawDataBlock.html">RawDataBlock</a>* rawBlk;
00205       <span class="keywordflow">while</span> ( ( rawBlk = dynamic_cast&lt;RawDataBlock*&gt;(itr.Next()) ) ) {
00206         <a class="code" href="classTruthifier.html#r2">fRddb</a> = dynamic_cast&lt;RawDigitDataBlock*&gt;(rawBlk);
00207         <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r2">fRddb</a>) {
00208           <span class="comment">// Got one!</span>
00209           TIter diter = <a class="code" href="classTruthifier.html#r2">fRddb</a>-&gt;<a class="code" href="classRawDigitDataBlock.html#a13">GetDatumIter</a>();
00210           <a class="code" href="classRawDigit.html">RawDigit</a>* rawDigit;
00211           diter.Reset();
00212           <span class="keywordflow">while</span>( ( rawDigit = (<a class="code" href="classRawDigit.html">RawDigit</a>*) diter.Next() ) ) {
00213             <span class="comment">// Relate this digit to the signal</span>
00214             <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = <a class="code" href="classTruthifier.html#a17">GetSignal</a>(rawDigit);
00215             <span class="keywordflow">if</span>(signal) {
00216               <a class="code" href="classTruthifier.html#r11">fSignalToDigit</a>[signal] = rawDigit;
00217             }
00218           }
00219         }
00220       }
00221     }
00222   } <span class="comment">// Ugly ugly ugly</span>
00223 
00224   <span class="comment">// See if we're good enough.</span>
00225   <a class="code" href="classTruthifier.html#r1">fValid</a> = <span class="keyword">true</span>;
00226 
00227 
00228   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r2">fRddb</a>==0) {
00229     <span class="comment">//if(!supressErrors) MSG("DataUtil",Msg::kError) &lt;&lt; "Couldn't find RDDB. Truthifier is invalid. \n";</span>
00230     <a class="code" href="classTruthifier.html#r1">fValid</a> = <span class="keyword">false</span>;
00231   }
00232   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r9">fTrackToHit</a>.size()==0) {
00233     <span class="comment">//if(!supressErrors) MSG("DataUtil",Msg::kError) &lt;&lt; "No hits found. Truthifier is invalid. \n";</span>
00234     <a class="code" href="classTruthifier.html#r1">fValid</a> = <span class="keyword">false</span>;
00235   }
00236   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r10">fHitToSignal</a>.size()==0) {
00237     <span class="comment">//if(!supressErrors) MSG("DataUtil",Msg::kError) &lt;&lt; "No map hit-&gt;signal. Truthifier is invalid. \n";</span>
00238     <a class="code" href="classTruthifier.html#r1">fValid</a> = <span class="keyword">false</span>;
00239   }
00240   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r11">fSignalToDigit</a>.size()==0) {
00241     <span class="comment">//if(!supressErrors) MSG("DataUtil",Msg::kError) &lt;&lt; "No map signal-&gt;digit found. Truthifier is invalid. \n";</span>
00242     <a class="code" href="classTruthifier.html#r1">fValid</a> = <span class="keyword">false</span>;
00243   }
00244   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r12">fSignals</a>.size()==0) {
00245     <span class="comment">//if(!supressErrors)  MSG("DataUtil",Msg::kError) &lt;&lt; "No signals found. Truthifier is invalid. \n";</span>
00246     <a class="code" href="classTruthifier.html#r1">fValid</a> = <span class="keyword">false</span>;
00247   }  
00248   <span class="keywordflow">if</span> ((!<a class="code" href="classTruthifier.html#r1">fValid</a>)&amp;&amp;(!supressErrors)) {
00249     <a class="code" href="MsgService_8h.html#a7">MAXMSG</a>(<span class="stringliteral">"DataUtil"</span>,Msg::kWarning,5) 
00250       &lt;&lt; <span class="stringliteral">"Truthifier built but is invalid. Not MC or null snarl."</span> &lt;&lt; endl;
00251   }
00252 }
00253 
00255 <span class="comment">// Utility.</span>
<a name="l00256"></a><a class="code" href="classTruthifier.html#a3">00256</a> std::vector&lt;Int_t&gt; <a class="code" href="classTruthifier.html#a3">Truthifier::GetListOfNeutrinoIndecies</a>()<span class="keyword"> const</span>
00257 <span class="keyword"></span>{
00258   <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#r6">fNeutrinoList</a>;
00259 }
00260 
<a name="l00261"></a><a class="code" href="classTruthifier.html#a5">00261</a> <span class="keyword">const</span> TParticle*   <a class="code" href="classTruthifier.html#a5">Truthifier::GetStdHepParticle</a>(Int_t index)<span class="keyword"> const</span>
00262 <span class="keyword"></span>{
00263   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r3">fStdHep</a>) {
00264     TParticle* part = dynamic_cast&lt;TParticle*&gt;((*fStdHep)[index]);
00265     <span class="keywordflow">return</span> part;
00266   }
00267   <span class="keywordflow">return</span> 0;
00268 }
00269 
<a name="l00270"></a><a class="code" href="classTruthifier.html#a4">00270</a> Int_t   <a class="code" href="classTruthifier.html#a4">Truthifier::GetStdHepSize</a>()<span class="keyword"> const</span>
00271 <span class="keyword"></span>{
00272   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r3">fStdHep</a>) {
00273     <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#r3">fStdHep</a>-&gt;GetEntries();
00274   }
00275   <span class="keywordflow">return</span> 0;
00276 }
00277 
<a name="l00278"></a><a class="code" href="classTruthifier.html#a8">00278</a> <span class="keyword">const</span> <a class="code" href="classREROOT__NeuKin.html">REROOT_NeuKin</a>* <a class="code" href="classTruthifier.html#a8">Truthifier::GetNeuKin</a>(Int_t i)<span class="keyword"> const</span>
00279 <span class="keyword"></span>{
00280   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r4">fNeuKins</a>) {
00281     <span class="keywordflow">return</span> dynamic_cast&lt;const REROOT_NeuKin*&gt;((*fNeuKins)[i]);
00282   }
00283   <span class="keywordflow">return</span> 0;
00284 }
00285 
<a name="l00286"></a><a class="code" href="classTruthifier.html#a9">00286</a> <span class="keyword">const</span> <a class="code" href="classREROOT__NeuKin.html">REROOT_NeuKin</a>* <a class="code" href="classTruthifier.html#a9">Truthifier::GetNeuKinOfParticle</a>(Int_t index)<span class="keyword"> const</span>
00287 <span class="keyword"></span>{
00288   <span class="comment">// Find matching neutrino</span>
00289   <span class="keywordflow">for</span>(Int_t i=<a class="code" href="classTruthifier.html#r6">fNeutrinoList</a>.size()-1;i&gt;=0;i--) {
00290     <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r6">fNeutrinoList</a>[i] &lt;= index) {
00291       <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#a8">GetNeuKin</a>(i);
00292     }
00293   }
00294   <span class="keywordflow">return</span> 0;
00295 }
00296 
<a name="l00297"></a><a class="code" href="classTruthifier.html#a6">00297</a> Int_t   <a class="code" href="classTruthifier.html#a6">Truthifier::GetScintHitListSize</a>()<span class="keyword"> const</span>
00298 <span class="keyword"></span>{
00299   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r5">fScintHitArray</a>) {
00300     <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#r5">fScintHitArray</a>-&gt;GetEntriesFast();
00301   }
00302   <span class="keywordflow">return</span> 0;
00303 }
00304 
<a name="l00305"></a><a class="code" href="classTruthifier.html#a7">00305</a> <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* <a class="code" href="classTruthifier.html#a7">Truthifier::GetScintHit</a>(Int_t index)<span class="keyword"> const</span>
00306 <span class="keyword"></span>{
00307   <span class="keywordflow">if</span>(index &gt;= <a class="code" href="classTruthifier.html#a6">GetScintHitListSize</a>()) <span class="keywordflow">return</span> 0;
00308   <span class="keywordflow">return</span> dynamic_cast&lt;const DigiScintHit*&gt;( (*fScintHitArray)[index] );
00309 }
00310 
00311 
00312 
<a name="l00313"></a><a class="code" href="classTruthifier.html#a10">00313</a> <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>*   <a class="code" href="classTruthifier.html#a10">Truthifier::GetRawDigit</a>(<span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh)<span class="keyword"> const</span>
00314 <span class="keyword"></span>{
00315   <span class="keywordtype">int</span> digitIndex = cdh.<a class="code" href="classCandDigitHandle.html#a9">GetRawDigitIndex</a>();
00316   <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* <a class="code" href="CheckGC_8cxx.html#a1">digit</a> = 0;
00317   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r2">fRddb</a>) <a class="code" href="CheckGC_8cxx.html#a1">digit</a> = <a class="code" href="classTruthifier.html#r2">fRddb</a>-&gt;<a class="code" href="classRawDigitDataBlock.html#a12">At</a>(digitIndex);
00318   <span class="keywordflow">return</span> <a class="code" href="CheckGC_8cxx.html#a1">digit</a>;
00319 }
00320 
00321 
00323 <span class="comment">// FORWARD TRACKING</span>
00324 <span class="comment">// </span>
00325 <span class="comment">// Routines to go from Particle-&gt;Digit</span>
00326 <span class="comment">//</span>
00327 
<a name="l00328"></a><a class="code" href="classTruthifier.html#a16">00328</a> Int_t <a class="code" href="classTruthifier.html#a16">Truthifier::GetNeutrinoOfTrack</a>( Int_t track )<span class="keyword"> const</span>
00329 <span class="keyword"></span>{
00330   <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#r7">fTrackIndexToNeutrinoIndex</a>[<a class="code" href="NtpStNC_8h.html#a17">abs</a>(track)];
00331 }
00332 
00333 
00334 <span class="comment">// ----------------------------------------------------------------------- //</span>
00335 <span class="keyword">const</span> std::vector&lt;const DigiSignal*&gt;&amp; 
<a name="l00336"></a><a class="code" href="classTruthifier.html#a11">00336</a> <a class="code" href="classTruthifier.html#a11">Truthifier::GetSignalVector</a>( <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit )<span class="keyword"> const</span>
00337 <span class="keyword"></span>{
00341   HitToSignal_t::const_iterator it = <a class="code" href="classTruthifier.html#r10">fHitToSignal</a>.find(hit);
00342   <span class="keywordflow">if</span>(it!=<a class="code" href="classTruthifier.html#r10">fHitToSignal</a>.end()) <span class="keywordflow">return</span> it-&gt;second;
00343 
00344   <span class="keyword">static</span> std::vector&lt;const DigiSignal*&gt; nullResult;
00345   <span class="keywordflow">return</span> nullResult;
00346 }
00347 
00348 <span class="comment">// ----------------------------------------------------------------------- //</span>
00349 <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* 
<a name="l00350"></a><a class="code" href="classTruthifier.html#a12">00350</a> <a class="code" href="classTruthifier.html#a10">Truthifier::GetRawDigit</a>( <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal )<span class="keyword"> const</span>
00351 <span class="keyword"></span>{
00355   SignalToDigit_t::const_iterator it = <a class="code" href="classTruthifier.html#r11">fSignalToDigit</a>.find(signal);
00356   <span class="keywordflow">if</span>(it!=<a class="code" href="classTruthifier.html#r11">fSignalToDigit</a>.end()) <span class="keywordflow">return</span> it-&gt;second;
00357   <span class="keywordflow">return</span> 0;
00358 }
00359 
00360 <span class="comment">// ----------------------------------------------------------------------- //</span>
00361 <span class="keyword">const</span> std::vector&lt;const RawDigit*&gt;&amp; 
<a name="l00362"></a><a class="code" href="classTruthifier.html#a13">00362</a> <a class="code" href="classTruthifier.html#a13">Truthifier::GetRawDigitVector</a>( <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit )<span class="keyword"> const</span>
00363 <span class="keyword"></span>{
00371   <span class="keyword">static</span> std::vector&lt;const RawDigit*&gt; output;
00372   output.clear();
00373   <span class="keyword">const</span> std::vector&lt;const DigiSignal*&gt;&amp; signalList
00374     = <a class="code" href="classTruthifier.html#a11">GetSignalVector</a>(hit);
00375   <span class="keywordflow">for</span>(UInt_t i=0;i&lt;signalList.size();i++) {
00376     output.push_back(<a class="code" href="classTruthifier.html#a10">GetRawDigit</a>(signalList[i]));
00377   }
00378   <span class="keywordflow">return</span> output;
00379 }
00380 
00381 
00382 <span class="comment">// ----------------------------------------------------------------------- //</span>
00383 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00384"></a><a class="code" href="classTruthifier.html#a14">00384</a> std::vector&lt;const T*&gt; <a class="code" href="classTruthifier.html#a14">Truthifier::GetCandidatesFromParticle</a>(<span class="keywordtype">int</span> ParticleId, 
00385                                                               <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* list)<span class="keyword"> const</span>
00386 <span class="keyword"></span>{
00391   std::vector&lt;const T*&gt; output;
00392 
00393   <span class="comment">// Loop throuth the list.</span>
00394   TIter it = list-&gt;<a class="code" href="classCandHandle.html#a18">GetDaughterIterator</a>();
00395   TObject* obj;
00396   <span class="keywordflow">while</span>( (obj=it.Next()) ) {
00397     <span class="keyword">const</span> T* thing = dynamic_cast&lt;const T*&gt;(obj);
00398     <span class="keywordflow">if</span>(thing) {
00399       <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* handle = dynamic_cast&lt;const CandHandle*&gt;(thing);
00400       <span class="keywordflow">if</span>(handle)
00401         <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#a42">IsCandidateFromParticle</a>(ParticleId,handle)) output.push_back(thing);
00402     }
00403   }; 
00404   
00405   <span class="keywordflow">return</span> output;
00406 }
00407 
00408 <span class="comment">// ----------------------------------------------------------------------- //</span>
00409 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00410"></a><a class="code" href="classTruthifier.html#a15">00410</a> std::vector&lt;const T*&gt; <a class="code" href="classTruthifier.html#a15">Truthifier::GetCandidatesFromTrack</a>(<span class="keywordtype">int</span> TrackId, 
00411                                                          <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* list)<span class="keyword"> const</span>
00412 <span class="keyword"></span>{
00417   std::vector&lt;const T*&gt; output;
00418 
00419   <span class="comment">// Loop throuth the list.</span>
00420   TIter it = list-&gt;<a class="code" href="classCandHandle.html#a18">GetDaughterIterator</a>();
00421   TObject* obj;
00422   <span class="keywordflow">while</span>( (obj=it.Next()) ) {
00423     <span class="keyword">const</span> T* thing = dynamic_cast&lt;const T*&gt;(obj);
00424     <span class="keywordflow">if</span>(thing) {
00425       <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* handle = dynamic_cast&lt;const CandHandle*&gt;(thing);
00426       <span class="keywordflow">if</span>(handle)
00427         <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#a43">IsCandidateFromTrack</a>(TrackId,handle)) output.push_back(thing);
00428     }
00429   }; 
00430   
00431   <span class="keywordflow">return</span> output;
00432 }
00433 
00434 
00435 <span class="comment">/*</span>
00436 <span class="comment">  // For me.</span>
00437 <span class="comment">void Truthifier::Test() const </span>
00438 <span class="comment">{</span>
00439 <span class="comment">  std::vector&lt;const CandDigitHandle*&gt; output;</span>
00440 <span class="comment">  </span>
00441 <span class="comment">  if(fMom==0) return;</span>
00442 <span class="comment">  const CandHandle* list = DataUtil::GetCandidate&lt;CandHandle&gt;</span>
00443 <span class="comment">    (fMom,"CandStripSRListHandle","CandStripSRList");</span>
00444 <span class="comment"></span>
00445 <span class="comment">  CandDigitsFrom(output,list);</span>
00446 <span class="comment">  MSG("DataUtil",Msg::kInfo) &lt;&lt; "total cand digits:" &lt;&lt; output.size() &lt;&lt; endl;</span>
00447 <span class="comment"></span>
00448 <span class="comment">  std::vector&lt;const CandStripHandle*&gt; outlist;</span>
00449 <span class="comment">  outlist = GetCandidatesFromParticle&lt;CandStripHandle&gt;(13,list);</span>
00450 <span class="comment">  </span>
00451 <span class="comment">  MSG("DataUtil",Msg::kInfo) &lt;&lt; "total muon strips:" &lt;&lt; outlist.size() &lt;&lt; endl;  </span>
00452 <span class="comment">}</span>
00453 <span class="comment">*/</span>
00454 
00456 <span class="comment">// BACKWARD TRACKING</span>
00457 <span class="comment">// </span>
00458 <span class="comment">// Routines to go from Digit-&gt;Particle</span>
00459 <span class="comment">//</span>
00460 
00461 
00462 <span class="comment">// ----------------------------------------------------------------------- //</span>
<a name="l00463"></a><a class="code" href="classTruthifier.html#a18">00463</a> <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* <a class="code" href="classTruthifier.html#a17">Truthifier::GetSignal</a>( <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* digit )<span class="keyword"> const</span>
00464 <span class="keyword"></span>{
00469 
00470   <span class="keywordflow">if</span>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>==0) <span class="keywordflow">return</span> NULL;
00471 
00472   <span class="keyword">const</span> <a class="code" href="classRawDigiDigitMixIn.html">RawDigiDigitMixIn</a>* ddigit = dynamic_cast&lt;const RawDigiDigitMixIn*&gt;(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>);
00473   <span class="keywordflow">if</span>(ddigit==0) <span class="keywordflow">return</span> NULL;
00474 
00475   UInt_t id = ddigit-&gt;<a class="code" href="classRawDigiDigitMixIn.html#a3">GetDigiSignalIndex</a>();
00476   
00477   SignalMap_t::const_iterator it = <a class="code" href="classTruthifier.html#r12">fSignals</a>.find(id);
00478   <span class="keywordflow">if</span>(it!=<a class="code" href="classTruthifier.html#r12">fSignals</a>.end()) <span class="keywordflow">return</span> it-&gt;second;
00479 
00480   <span class="keywordflow">return</span> NULL;
00481 }
00482 
00483 <span class="comment">// ----------------------------------------------------------------------- //</span>
<a name="l00484"></a><a class="code" href="classTruthifier.html#a17">00484</a> <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* <a class="code" href="classTruthifier.html#a17">Truthifier::GetSignal</a>( <span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh )<span class="keyword"> const</span>
00485 <span class="keyword"></span>{
00490   <span class="keywordtype">int</span> digitIndex = cdh.<a class="code" href="classCandDigitHandle.html#a9">GetRawDigitIndex</a>();
00491   <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* <a class="code" href="CheckGC_8cxx.html#a1">digit</a> = 0;
00492   <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r2">fRddb</a>) <a class="code" href="CheckGC_8cxx.html#a1">digit</a> = <a class="code" href="classTruthifier.html#r2">fRddb</a>-&gt;<a class="code" href="classRawDigitDataBlock.html#a12">At</a>(digitIndex);
00493   <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#a17">GetSignal</a>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>);
00494 }
00495 
00496 
00497 <span class="comment">// ----------------------------------------------------------------------- //</span>
00498 <a class="code" href="classDigiSignal.html#w0">DigiSignal::DigiPmtTruth_t</a>
<a name="l00499"></a><a class="code" href="classTruthifier.html#a19">00499</a> <a class="code" href="classTruthifier.html#a19">Truthifier::GetSignalTruthFlags</a>( <span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh )<span class="keyword"> const</span>
00500 <span class="keyword"></span>{
00504   <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = <a class="code" href="classTruthifier.html#a17">GetSignal</a>(cdh);
00505   <span class="keywordflow">if</span>(signal==0) <span class="keywordflow">return</span> DigiSignal::kUnknown;
00506   <span class="keywordflow">return</span> signal-&gt;<a class="code" href="classDigiSignal.html#a7">GetTruth</a>();
00507 }
00508 
00509 <span class="comment">// ----------------------------------------------------------------------- //</span>
00510 <a class="code" href="classDigiSignal.html#w0">DigiSignal::DigiPmtTruth_t</a> 
<a name="l00511"></a><a class="code" href="classTruthifier.html#a20">00511</a> <a class="code" href="classTruthifier.html#a19">Truthifier::GetSignalTruthFlags</a>( <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* digit )<span class="keyword"> const</span>
00512 <span class="keyword"></span>{
00516   <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = <a class="code" href="classTruthifier.html#a17">GetSignal</a>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>);
00517   <span class="keywordflow">if</span>(signal==0) <span class="keywordflow">return</span> DigiSignal::kUnknown;
00518   <span class="keywordflow">return</span> signal-&gt;<a class="code" href="classDigiSignal.html#a7">GetTruth</a>();
00519 }
00520 
00521 <span class="comment">// ----------------------------------------------------------------------- //</span>
<a name="l00522"></a><a class="code" href="classTruthifier.html#a21">00522</a> Bool_t <a class="code" href="classTruthifier.html#a21">Truthifier::DigitIsOnlyCrosstalk</a>( <span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh )<span class="keyword"> const</span>
00523 <span class="keyword"></span>{
00529   <a class="code" href="classDigiSignal.html#w0">DigiSignal::DigiPmtTruth_t</a> flags = <a class="code" href="classTruthifier.html#a19">GetSignalTruthFlags</a>(cdh);
00530   <span class="keywordflow">if</span>(  ( (flags &amp; DigiSignal::kCrosstalk) || (flags &amp; DigiSignal::kCrosstalkOptical) )
00531        &amp;&amp; ( ! (flags &amp; DigiSignal::kGenuine) ) ) {
00532     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00533   }
00534   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00535 }
00536  
00537 <span class="comment">// ----------------------------------------------------------------------- //</span>
<a name="l00538"></a><a class="code" href="classTruthifier.html#a22">00538</a> Bool_t <a class="code" href="classTruthifier.html#a21">Truthifier::DigitIsOnlyCrosstalk</a>( <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* digit )<span class="keyword"> const</span>
00539 <span class="keyword"></span>{
00545   <a class="code" href="classDigiSignal.html#w0">DigiSignal::DigiPmtTruth_t</a> flags = <a class="code" href="classTruthifier.html#a19">GetSignalTruthFlags</a>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>);
00546   <span class="keywordflow">if</span>(  ( (flags &amp; DigiSignal::kCrosstalk) || (flags &amp; DigiSignal::kCrosstalkOptical) )
00547        &amp;&amp; ( ! (flags &amp; DigiSignal::kGenuine) ) ) {
00548     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00549   }
00550   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00551 
00552 }
00553 
00554 
00555 <span class="comment">// ----------------------------------------------------------------------- //</span>
00556 Float_t 
<a name="l00557"></a><a class="code" href="classTruthifier.html#a24">00557</a> <a class="code" href="classTruthifier.html#a24">Truthifier::IsSignalFromParticle</a>( Int_t particleID,  <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal )<span class="keyword"> const</span>
00558 <span class="keyword"></span>{
00563   <span class="keywordflow">if</span>(! signal) <span class="keywordflow">return</span> 0;
00564   Float_t <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> = 0;
00565   Float_t totalMatch = 0;
00566   UInt_t n = signal-&gt;<a class="code" href="classDigiSignal.html#a9">GetNumberOfHits</a>();
00567   <span class="keywordflow">for</span>(UInt_t i=0; i&lt;n; i++) {
00568     <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit = signal-&gt;<a class="code" href="classDigiSignal.html#a10">GetHit</a>(i);
00569     Float_t weight = signal-&gt;<a class="code" href="classDigiSignal.html#a11">GetHitWeight</a>(i);
00570     <span class="keywordflow">if</span>(hit-&gt;<a class="code" href="classDigiScintHit.html#a9">ParticleId</a>() == particleID)  totalMatch += weight;
00571     <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> += weight;
00572   }
00573   <span class="keywordflow">if</span>(<a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>&lt;=0) <span class="keywordflow">return</span> 0;  <span class="comment">// Guard against FPEs</span>
00574   <span class="keywordflow">return</span> totalMatch/<a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>;
00575 }
00576 
00577 <span class="comment">// ----------------------------------------------------------------------- //</span>
00578 Float_t 
<a name="l00579"></a><a class="code" href="classTruthifier.html#a25">00579</a> <a class="code" href="classTruthifier.html#a25">Truthifier::IsSignalFromTrack</a>( Int_t trackID,  <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal )<span class="keyword"> const</span>
00580 <span class="keyword"></span>{
00585   <span class="keywordflow">if</span>(! signal) <span class="keywordflow">return</span> 0;
00586   Float_t <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> = 0;
00587   Float_t totalMatch = 0;
00588   UInt_t n = signal-&gt;<a class="code" href="classDigiSignal.html#a9">GetNumberOfHits</a>();
00589   <span class="keywordflow">for</span>(UInt_t i=0; i&lt;n; i++) {
00590     <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit = signal-&gt;<a class="code" href="classDigiSignal.html#a10">GetHit</a>(i);
00591     Float_t weight = signal-&gt;<a class="code" href="classDigiSignal.html#a11">GetHitWeight</a>(i);
00592     <span class="keywordflow">if</span>(hit-&gt;<a class="code" href="classDigiScintHit.html#a6">TrackId</a>() == trackID)  totalMatch += weight;
00593     <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> += weight;
00594   }
00595   <span class="keywordflow">if</span>(<a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>&lt;=0) <span class="keywordflow">return</span> 0;  <span class="comment">// Guard against FPEs</span>
00596   <span class="keywordflow">return</span> totalMatch/<a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>;
00597 }
00598 
00599 <span class="comment">// ----------------------------------------------------------------------- //</span>
00600 Float_t 
<a name="l00601"></a><a class="code" href="classTruthifier.html#a26">00601</a> <a class="code" href="classTruthifier.html#a26">Truthifier::IsSignalFromNeutrino</a>( Int_t neutrinoID,  <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal, Double_t max_t )<span class="keyword"> const</span>
00602 <span class="keyword"></span>{
00606   <span class="keywordflow">if</span>(! signal) <span class="keywordflow">return</span> 0;
00607   Float_t <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> = 0;
00608   Float_t totalMatch = 0;
00609   UInt_t n = signal-&gt;<a class="code" href="classDigiSignal.html#a9">GetNumberOfHits</a>();
00610   <span class="keywordflow">for</span>(UInt_t i=0; i&lt;n; i++) {
00611     <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit = signal-&gt;<a class="code" href="classDigiSignal.html#a10">GetHit</a>(i);
00612     Float_t weight = signal-&gt;<a class="code" href="classDigiSignal.html#a11">GetHitWeight</a>(i);
00613     <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> += weight;
00614     <span class="keywordtype">int</span> trackId = <a class="code" href="NtpStNC_8h.html#a17">abs</a>(hit-&gt;<a class="code" href="classDigiScintHit.html#a6">TrackId</a>());
00615 
00616     <span class="keywordflow">if</span>(<a class="code" href="classTruthifier.html#r7">fTrackIndexToNeutrinoIndex</a>[trackId]==neutrinoID) {
00617       <span class="keywordflow">if</span>(hit-&gt;<a class="code" href="classDigiScintHit.html#a13">T1</a>()&lt;=max_t)
00618         totalMatch += weight;
00619     }
00620   }
00621   <span class="keywordflow">if</span>(<a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>&lt;=0) <span class="keywordflow">return</span> 0;  <span class="comment">// Guard against FPEs</span>
00622   <span class="keywordflow">return</span> totalMatch/<a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>;
00623 }
00624 
00625 
00626 <span class="comment">// ----------------------------------------------------------------------- //</span>
00627 <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* 
<a name="l00628"></a><a class="code" href="classTruthifier.html#a27">00628</a> <a class="code" href="classTruthifier.html#a27">Truthifier::GetBiggestHit</a>( <span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh )<span class="keyword"> const</span>
00629 <span class="keyword"></span>{
00634   <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = <a class="code" href="classTruthifier.html#a17">GetSignal</a>(cdh);
00635   <span class="keywordflow">if</span>(!signal) <span class="keywordflow">return</span> 0;
00636   <span class="keywordflow">return</span> signal-&gt;<a class="code" href="classDigiSignal.html#a13">GetBiggestHit</a>();
00637 }
00638 <span class="comment">// ----------------------------------------------------------------------- //</span>
00639 <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* 
<a name="l00640"></a><a class="code" href="classTruthifier.html#a28">00640</a> <a class="code" href="classTruthifier.html#a27">Truthifier::GetBiggestHit</a>( <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* digit )<span class="keyword"> const</span>
00641 <span class="keyword"></span>{
00646   <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = <a class="code" href="classTruthifier.html#a17">GetSignal</a>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>);
00647   <span class="keywordflow">if</span>(!signal) <span class="keywordflow">return</span> 0;
00648   <span class="keywordflow">return</span> signal-&gt;<a class="code" href="classDigiSignal.html#a13">GetBiggestHit</a>();
00649 }
00650 
00651 
00652 
00653 <span class="comment">// ----------------------------------------------------------------------- //</span>
00654 Float_t 
<a name="l00655"></a><a class="code" href="classTruthifier.html#a30">00655</a> <a class="code" href="classTruthifier.html#a29">Truthifier::IsDigitFromParticle</a>( Int_t particleID,  <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* digit )<span class="keyword"> const</span>
00656 <span class="keyword"></span>{
00661   <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#a24">IsSignalFromParticle</a>(particleID,<a class="code" href="classTruthifier.html#a17">GetSignal</a>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>));
00662 }
00663 
00664 <span class="comment">// ----------------------------------------------------------------------- //</span>
00665 Float_t 
<a name="l00666"></a><a class="code" href="classTruthifier.html#a29">00666</a> <a class="code" href="classTruthifier.html#a29">Truthifier::IsDigitFromParticle</a>( Int_t particleID,  <span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh )<span class="keyword"> const</span>
00667 <span class="keyword"></span>{
00672   <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#a24">IsSignalFromParticle</a>(particleID,<a class="code" href="classTruthifier.html#a17">GetSignal</a>(cdh));
00673 }
00674 
00675 
00676 <span class="comment">// ----------------------------------------------------------------------- //</span>
00677 Float_t 
<a name="l00678"></a><a class="code" href="classTruthifier.html#a32">00678</a> <a class="code" href="classTruthifier.html#a31">Truthifier::IsDigitFromTrack</a>( Int_t trackID,  <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* digit )<span class="keyword"> const</span>
00679 <span class="keyword"></span>{
00684   <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#a25">IsSignalFromTrack</a>(trackID,<a class="code" href="classTruthifier.html#a17">GetSignal</a>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>));
00685 }
00686 
00687 <span class="comment">// ----------------------------------------------------------------------- //</span>
00688 Float_t 
<a name="l00689"></a><a class="code" href="classTruthifier.html#a34">00689</a> <a class="code" href="classTruthifier.html#a33">Truthifier::IsDigitFromNeutrino</a>( Int_t neutrinoID,  <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* digit, Double_t max_t )<span class="keyword"> const</span>
00690 <span class="keyword"></span>{
00695   <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#a26">IsSignalFromNeutrino</a>(neutrinoID,<a class="code" href="classTruthifier.html#a17">GetSignal</a>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>),max_t);
00696 }
00697 
00698 <span class="comment">// ----------------------------------------------------------------------- //</span>
00699 Float_t 
<a name="l00700"></a><a class="code" href="classTruthifier.html#a31">00700</a> <a class="code" href="classTruthifier.html#a31">Truthifier::IsDigitFromTrack</a>( Int_t trackID,  <span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh )<span class="keyword"> const</span>
00701 <span class="keyword"></span>{
00706   <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#a25">IsSignalFromTrack</a>(trackID,<a class="code" href="classTruthifier.html#a17">GetSignal</a>(cdh));
00707 }
00708 
00709 
00710 <span class="comment">// ----------------------------------------------------------------------- //</span>
00711 Float_t 
<a name="l00712"></a><a class="code" href="classTruthifier.html#a33">00712</a> <a class="code" href="classTruthifier.html#a33">Truthifier::IsDigitFromNeutrino</a>( Int_t neutrinoID,  <span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh, Double_t max_t )<span class="keyword"> const</span>
00713 <span class="keyword"></span>{
00718   <span class="keywordflow">return</span> <a class="code" href="classTruthifier.html#a26">IsSignalFromNeutrino</a>(neutrinoID,<a class="code" href="classTruthifier.html#a17">GetSignal</a>(cdh),max_t);
00719 }
00720 
00721 
00722 
00723 <span class="comment">// ----------------------------------------------------------------------- //</span>
<a name="l00724"></a><a class="code" href="classTruthifier.html#a35">00724</a> <a class="code" href="classPlexStripEndId.html">PlexStripEndId</a> <a class="code" href="classTruthifier.html#a35">Truthifier::BestSEIdOfDigit</a>(<span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>* cdh)<span class="keyword"> const</span>
00725 <span class="keyword"></span>{
00730   <span class="comment">// Get list of the stripends.</span>
00731   std::map&lt;PlexStripEndId,float&gt; ends;
00732   std::map&lt;PlexStripEndId,float&gt;::iterator endit;
00733 
00734   <span class="keywordflow">if</span>(!cdh) {
00735     <a class="code" href="MsgService_8h.html#a4">MSG</a>(<span class="stringliteral">"DataUtil"</span>,Msg::kError) &lt;&lt; <span class="stringliteral">"BestSEIdOfDigit was handed null CandDigitHandle*"</span> &lt;&lt; endl;
00736     <span class="keywordflow">return</span> <a class="code" href="classPlexStripEndId.html">PlexStripEndId</a>();
00737   }
00738 
00739   <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = <a class="code" href="classTruthifier.html#a17">GetSignal</a>(*cdh);
00740   <span class="keywordflow">if</span>(signal) {
00741     <span class="keywordflow">for</span>(UInt_t i=0; i&lt;signal-&gt;<a class="code" href="classDigiSignal.html#a9">GetNumberOfHits</a>(); i++) {
00742       <a class="code" href="classPlexStripEndId.html">PlexStripEndId</a> seid = signal-&gt;<a class="code" href="classDigiSignal.html#a10">GetHit</a>(i)-&gt;<a class="code" href="classDigiScintHit.html#a10">StripEndId</a>();
00743       <span class="keywordtype">float</span> weight = signal-&gt;<a class="code" href="classDigiSignal.html#a11">GetHitWeight</a>(i);
00744       ends[seid] += weight;
00745     }
00746   } <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="classPlexStripEndId.html">PlexStripEndId</a>();
00747 
00748   <span class="comment">// Find the best one.</span>
00749   <a class="code" href="classPlexStripEndId.html">PlexStripEndId</a> best;
00750   <span class="keywordtype">float</span> bestpe = 0;
00751   <span class="keywordflow">for</span>(endit = ends.begin(); endit!= ends.end(); endit++) {
00752     <span class="keywordflow">if</span>(endit-&gt;second &gt; bestpe) {
00753       bestpe = endit-&gt;second;
00754       best = endit-&gt;first;
00755     }
00756   }
00757   
00758   <span class="keywordflow">if</span>(best.<a class="code" href="classPlexStripEndId.html#a21">IsValid</a>()) best.<a class="code" href="classPlexStripEndId.html#a23">SetEnd</a>(cdh-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a19">GetEnd</a>());
00759   
00760   <span class="keywordflow">return</span> best;
00761 }
00762 
00763 <span class="comment">// ----------------------------------------------------------------------- //</span>
00764 <span class="keywordtype">void</span>
<a name="l00765"></a><a class="code" href="classTruthifier.html#a36">00765</a> <a class="code" href="classTruthifier.html#a36">Truthifier::GetAllScintHits</a>(<span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* digit,       
00766                             std::set&lt;const DigiScintHit*&gt;&amp; outSet)<span class="keyword"> const</span>
00767 <span class="keyword"></span>{
00768   <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = <a class="code" href="classTruthifier.html#a17">GetSignal</a>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>);
00769   <span class="keywordflow">if</span>(!signal) <span class="keywordflow">return</span>;
00770   UInt_t n = signal-&gt;<a class="code" href="classDigiSignal.html#a9">GetNumberOfHits</a>();
00771   <span class="keywordflow">for</span>(UInt_t i=0; i&lt;n; i++) {
00772     <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit = signal-&gt;<a class="code" href="classDigiSignal.html#a10">GetHit</a>(i);
00773     outSet.insert(hit);
00774   }
00775 }
00776 
00777 <span class="comment">// ----------------------------------------------------------------------- //</span>
00778 <span class="keywordtype">void</span>
<a name="l00779"></a><a class="code" href="classTruthifier.html#a37">00779</a> <a class="code" href="classTruthifier.html#a36">Truthifier::GetAllScintHits</a>(<span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh,   
00780                             std::set&lt;const DigiScintHit*&gt;&amp; outSet)<span class="keyword"> const</span>
00781 <span class="keyword"></span>{
00782   <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = <a class="code" href="classTruthifier.html#a17">GetSignal</a>(cdh);
00783   <span class="keywordflow">if</span>(!signal) <span class="keywordflow">return</span>;
00784   UInt_t n = signal-&gt;<a class="code" href="classDigiSignal.html#a9">GetNumberOfHits</a>();
00785   <span class="keywordflow">for</span>(UInt_t i=0; i&lt;n; i++) {
00786     <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit = signal-&gt;<a class="code" href="classDigiSignal.html#a10">GetHit</a>(i);
00787     outSet.insert(hit);
00788   }
00789 }
00790 
00791 <span class="comment">// ----------------------------------------------------------------------- //</span>
00792 <span class="keywordtype">void</span>
<a name="l00793"></a><a class="code" href="classTruthifier.html#a38">00793</a> <a class="code" href="classTruthifier.html#a36">Truthifier::GetAllScintHits</a>(<span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* candidate,   
00794                             std::set&lt;const DigiScintHit*&gt;&amp; outSet)<span class="keyword"> const</span>
00795 <span class="keyword"></span>{
00796   <span class="keywordflow">if</span>(!candidate) <span class="keywordflow">return</span>;
00797   std::vector&lt;const CandDigitHandle*&gt; digits;
00798   <a class="code" href="classTruthifier.html#d0">CandDigitsFrom</a>(digits,candidate);
00799 
00800   <span class="keywordflow">for</span>(UInt_t i=0;i&lt;digits.size();i++) 
00801     <a class="code" href="classTruthifier.html#a36">GetAllScintHits</a>(*(digits[i]),outSet);
00802 }
00803 
00804 <span class="comment">// ----------------------------------------------------------------------- //</span>
00805 Float_t 
<a name="l00806"></a><a class="code" href="classTruthifier.html#a39">00806</a> <a class="code" href="classTruthifier.html#a39">Truthifier::GetTotalEnergy</a>( <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* digit, Int_t particleID )<span class="keyword"> const </span>
00807 <span class="keyword"></span>{
00808   <span class="comment">// Get the total energy of all scinthits that lent energy to this digit.</span>
00809   <span class="comment">// If particleID is non-zero, only add energy from that particle type</span>
00810   <span class="comment">// (-ve or +ve of that type)</span>
00811  
00812   std::set&lt;const DigiScintHit*&gt; hits;
00813   std::set&lt;const DigiScintHit*&gt;::iterator it;
00814   Float_t <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> = 0;
00815   <a class="code" href="classTruthifier.html#a36">GetAllScintHits</a>(<a class="code" href="CheckGC_8cxx.html#a1">digit</a>,hits);
00816   <span class="keywordflow">for</span>(it = hits.begin(); it!= hits.end(); it++) {
00817     <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit = *it;
00818     <span class="keywordflow">if</span>(hit)
00819       <span class="keywordflow">if</span>((particleID==0) || (<a class="code" href="NtpStNC_8h.html#a17">abs</a>(hit-&gt;<a class="code" href="classDigiScintHit.html#a9">ParticleId</a>()) == particleID))
00820         <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> += hit-&gt;<a class="code" href="classDigiScintHit.html#a22">DE</a>();
00821   }
00822 
00823   <span class="keywordflow">return</span> <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>;
00824 }
00825 
00826 <span class="comment">// ----------------------------------------------------------------------- //</span>
00827 Float_t 
<a name="l00828"></a><a class="code" href="classTruthifier.html#a40">00828</a> <a class="code" href="classTruthifier.html#a39">Truthifier::GetTotalEnergy</a>( <span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; cdh, Int_t particleID )<span class="keyword"> const </span>
00829 <span class="keyword"></span>{
00830   <span class="comment">// Get the total energy of all scinthits that lent energy to this digit.</span>
00831   <span class="comment">// If particleID is non-zero, only add energy from that particle type</span>
00832   <span class="comment">// (-ve or +ve of that type)</span>
00833  
00834   std::set&lt;const DigiScintHit*&gt; hits;
00835   std::set&lt;const DigiScintHit*&gt;::iterator it;
00836   Float_t <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> = 0;
00837   <a class="code" href="classTruthifier.html#a36">GetAllScintHits</a>(cdh,hits);
00838   <span class="keywordflow">for</span>(it = hits.begin(); it!= hits.end(); it++) {
00839     <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit = *it;
00840     <span class="keywordflow">if</span>(hit)
00841       <span class="keywordflow">if</span>((particleID==0) || (<a class="code" href="NtpStNC_8h.html#a17">abs</a>(hit-&gt;<a class="code" href="classDigiScintHit.html#a9">ParticleId</a>()) == particleID))
00842         <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> += hit-&gt;<a class="code" href="classDigiScintHit.html#a22">DE</a>();
00843   }
00844 
00845   <span class="keywordflow">return</span> <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>;
00846 }
00847 
00848 <span class="comment">// ----------------------------------------------------------------------- //</span>
00849 Float_t 
<a name="l00850"></a><a class="code" href="classTruthifier.html#a41">00850</a> <a class="code" href="classTruthifier.html#a39">Truthifier::GetTotalEnergy</a>( <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* candidate, Int_t particleID )<span class="keyword"> const</span>
00851 <span class="keyword"></span>{
00852   <span class="comment">// Get the total energy of all scinthits that lent energy to this digit.</span>
00853   <span class="comment">// If particleID is non-zero, only add energy from that particle type</span>
00854   <span class="comment">// (-ve or +ve of that type)</span>
00855  
00856   std::set&lt;const DigiScintHit*&gt; hits;
00857   std::set&lt;const DigiScintHit*&gt;::iterator it;
00858   Float_t <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> = 0;
00859   <a class="code" href="classTruthifier.html#a36">GetAllScintHits</a>(candidate,hits);
00860   <span class="keywordflow">for</span>(it = hits.begin(); it!= hits.end(); it++) {
00861     <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit = *it;
00862     <span class="keywordflow">if</span>(hit)
00863       <span class="keywordflow">if</span>((particleID==0) || (<a class="code" href="NtpStNC_8h.html#a17">abs</a>(hit-&gt;<a class="code" href="classDigiScintHit.html#a9">ParticleId</a>()) == particleID))
00864         <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> += hit-&gt;<a class="code" href="classDigiScintHit.html#a22">DE</a>();
00865   }
00866 
00867   <span class="keywordflow">return</span> <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>;
00868 }
00869 
00870 
00871 
00872 <span class="comment">// ----------------------------------------------------------------------- //</span>
00873 Float_t 
<a name="l00874"></a><a class="code" href="classTruthifier.html#a42">00874</a> <a class="code" href="classTruthifier.html#a42">Truthifier::IsCandidateFromParticle</a>( Int_t particleID,  <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* candidate )<span class="keyword"> const</span>
00875 <span class="keyword"></span>{
00879   <span class="keywordflow">if</span>(!candidate) <span class="keywordflow">return</span> 0;
00880   std::vector&lt;const CandDigitHandle*&gt; digits;
00881   <a class="code" href="classTruthifier.html#d0">CandDigitsFrom</a>(digits,candidate);
00882 
00883   <span class="comment">// Test each digit. to see if it satisfies.</span>
00884   Float_t <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> = 0;
00885   <span class="keywordflow">for</span>(UInt_t i=0;i&lt;digits.size();i++) 
00886     <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> += <a class="code" href="classTruthifier.html#a29">IsDigitFromParticle</a>(particleID,*digits[i]);
00887   
00888   <span class="keywordflow">return</span> <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>;
00889 }
00890 
00891 <span class="comment">// ----------------------------------------------------------------------- //</span>
00892 Float_t 
<a name="l00893"></a><a class="code" href="classTruthifier.html#a43">00893</a> <a class="code" href="classTruthifier.html#a43">Truthifier::IsCandidateFromTrack</a>( Int_t trackID,  <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* candidate )<span class="keyword"> const</span>
00894 <span class="keyword"></span>{
00898   <span class="keywordflow">if</span>(!candidate) <span class="keywordflow">return</span> 0;
00899   std::vector&lt;const CandDigitHandle*&gt; digits;
00900   <a class="code" href="classTruthifier.html#d0">CandDigitsFrom</a>(digits,candidate);
00901 
00902   <span class="comment">// Test each digit. to see if it satisfies.</span>
00903   Float_t <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> = 0;
00904   <span class="keywordflow">for</span>(UInt_t i=0;i&lt;digits.size();i++) 
00905     <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> += <a class="code" href="classTruthifier.html#a31">IsDigitFromTrack</a>(trackID,*digits[i]);
00906   
00907   <span class="keywordflow">return</span> <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>;
00908 }
00909 
00910 <span class="comment">// ----------------------------------------------------------------------- //</span>
00911 Float_t 
<a name="l00912"></a><a class="code" href="classTruthifier.html#a44">00912</a> <a class="code" href="classTruthifier.html#a44">Truthifier::IsCandidateGenuine</a>( <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* candidate )<span class="keyword"> const</span>
00913 <span class="keyword"></span>{
00917   <span class="keywordflow">if</span>(!candidate) <span class="keywordflow">return</span> 0;
00918   std::vector&lt;const CandDigitHandle*&gt; digits;
00919   <a class="code" href="classTruthifier.html#d0">CandDigitsFrom</a>(digits,candidate);
00920 
00921   <span class="comment">// Test each digit. to see if it satisfies.</span>
00922   Float_t <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a> = 0;
00923   <span class="keywordflow">for</span>(UInt_t i=0;i&lt;digits.size();i++) {
00924     <a class="code" href="classDigiSignal.html#w0">DigiSignal::DigiPmtTruth_t</a> flags = <a class="code" href="classTruthifier.html#a19">GetSignalTruthFlags</a>(*digits[i]);       
00925     <span class="keywordflow">if</span>(flags &amp; DigiSignal::kGenuine) {
00926       <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>++;
00927     }
00928   }
00929 
00930   <span class="keywordflow">return</span> <a class="code" href="BDSwicPeds_8cxx.html#a5">total</a>/(<span class="keywordtype">float</span>)(digits.size());
00931 }
00932 
00933 <span class="comment">// ----------------------------------------------------------------------- //</span>
<a name="l00934"></a><a class="code" href="classTruthifier.html#a45">00934</a> <span class="keywordtype">void</span> <a class="code" href="classTruthifier.html#a45">Truthifier::Print</a>(<span class="keyword">const</span> Option_t*)<span class="keyword"> const</span>
00935 <span class="keyword"></span>{
00941 
00942   <span class="comment">// Go through all tracks.</span>
00943   TrackToHit_t::const_iterator hitItr = <a class="code" href="classTruthifier.html#r9">fTrackToHit</a>.begin();
00944   <span class="keywordflow">for</span>( ; hitItr!=<a class="code" href="classTruthifier.html#r9">fTrackToHit</a>.end(); hitItr++) {
00945     std::cout &lt;&lt; <span class="stringliteral">"+--- TRACK "</span> &lt;&lt; hitItr-&gt;first &lt;&lt; <span class="stringliteral">" ---------\n"</span>;
00946     
00947     <span class="comment">// For each scint hit</span>
00948     <span class="keywordflow">for</span>(UInt_t ihit=0; ihit&lt;hitItr-&gt;second.size(); ihit++) {
00949       <span class="keyword">const</span> <a class="code" href="classDigiScintHit.html">DigiScintHit</a>* hit =  (hitItr-&gt;second)[ihit];
00950       std::cout &lt;&lt; <span class="stringliteral">"|+-- DigiScintHit: "</span> &lt;&lt; hit-&gt;<a class="code" href="classDigiScintHit.html#a27">AsString</a>() &lt;&lt; std::endl;
00951       
00952       <span class="comment">// For each signal</span>
00953       HitToSignal_t::const_iterator htsItr = <a class="code" href="classTruthifier.html#r10">fHitToSignal</a>.find(hit);
00954       <span class="keywordflow">if</span>(htsItr != <a class="code" href="classTruthifier.html#r10">fHitToSignal</a>.end()) {
00955         <span class="keywordflow">for</span>(UInt_t isig = 0; isig&lt;htsItr-&gt;second.size(); isig++) {
00956           
00957           <span class="keyword">const</span> <a class="code" href="classDigiSignal.html">DigiSignal</a>* signal = (htsItr-&gt;second)[isig];
00958           SignalToDigit_t::const_iterator stdItr = <a class="code" href="classTruthifier.html#r11">fSignalToDigit</a>.find(signal);
00959           <span class="keywordflow">if</span>(stdItr != <a class="code" href="classTruthifier.html#r11">fSignalToDigit</a>.end()) {
00960             <span class="keyword">const</span> <a class="code" href="classRawDigit.html">RawDigit</a>* <a class="code" href="CheckGC_8cxx.html#a1">digit</a> = stdItr-&gt;second;
00961             std::cout &lt;&lt; <span class="stringliteral">" |-- RawDigit: "</span> &lt;&lt; *<a class="code" href="CheckGC_8cxx.html#a1">digit</a> &lt;&lt; std::endl;
00962             std::cout &lt;&lt; <span class="stringliteral">" |   DigiSignal: "</span> 
00963                       &lt;&lt; signal-&gt;<a class="code" href="classDigiSignal.html#a5">GetCharge</a>() / Munits::fC 
00964                &lt;&lt; <span class="stringliteral">" fC"</span> 
00965                       &lt;&lt; <span class="stringliteral">"  Truth: "</span> &lt;&lt; <a class="code" href="DigiSignal_8h.html#a0">AsString</a>(signal-&gt;<a class="code" href="classDigiSignal.html#a7">GetTruth</a>()) &lt;&lt; std::endl;      
00966           }
00967         }
00968         
00969       }
00970       
00971     }
00972   }
00973 }
00974 
00975 
00977 <span class="comment">// Private functions.</span>
00978 <span class="comment">// </span>
00979 <span class="comment">//</span>
00980 
00981 <span class="comment">// ----------------------------------------------------------------------- //</span>
<a name="l00982"></a><a class="code" href="classTruthifier.html#d0">00982</a> <span class="keywordtype">void</span> <a class="code" href="classTruthifier.html#d0">Truthifier::CandDigitsFrom</a>(std::vector&lt;const CandDigitHandle*&gt;&amp; output, 
00983                                 <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* list)<span class="keyword"> const</span>
00984 <span class="keyword"></span>{
00985   <span class="keywordflow">if</span>(!list) <span class="keywordflow">return</span>;
00986  
00987   <span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>* cdh = 
00988     dynamic_cast&lt;const CandDigitHandle*&gt;(list);
00989  
00990   <span class="keywordflow">if</span>(cdh){
00991     output.push_back(cdh);
00992     <span class="keywordflow">return</span>;
00993   }
00994 
00995   TIter it = list-&gt;<a class="code" href="classCandHandle.html#a18">GetDaughterIterator</a>();
00996   TObject* obj;
00997   <span class="keywordflow">while</span>( (obj=it.Next()) ) {
00998     <span class="keyword">const</span> <a class="code" href="classCandHandle.html">CandHandle</a>* newHandle = dynamic_cast&lt;const CandHandle*&gt;(obj);
00999     <span class="keywordflow">if</span>(newHandle)
01000       <a class="code" href="classTruthifier.html#d0">CandDigitsFrom</a>(output,newHandle);
01001   }; 
01002 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Feb 14 22:48:57 2009 for loon by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
