<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>loon: GfxDigit.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>GfxDigit.cxx</h1><a href="EventDisplay_2GfxDigit_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include "<a class="code" href="EventDisplay_2GfxDigit_8h.html">GfxDigit.h</a>"</span>
00002 <span class="preprocessor">#include "<a class="code" href="EventDisplay_2GfxDigitList_8h.html">GfxDigitList.h</a>"</span>
00003 <span class="preprocessor">#include "<a class="code" href="EventDisplay_2GfxDigitListCfg_8h.html">GfxDigitListCfg.h</a>"</span>
00004 <span class="preprocessor">#include "<a class="code" href="EventDisplay_2ViewState_8h.html">ViewState.h</a>"</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="Mint_8h.html">Midad/Base/Mint.h</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="Midad_2Util_2Util_8h.html">Midad/Util/Util.h</a>&gt;</span>
00007 
00008 <span class="preprocessor">#include &lt;<a class="code" href="UgliGeomHandle_8h.html">UgliGeometry/UgliGeomHandle.h</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="UgliStripHandle_8h.html">UgliGeometry/UgliStripHandle.h</a>&gt;</span>
00010 
00011 
00012 <span class="preprocessor">#include &lt;<a class="code" href="CandDigitHandle_8h.html">CandDigit/CandDigitHandle.h</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="CandStripHandle_8h.html">RecoBase/CandStripHandle.h</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="CandSliceHandle_8h.html">RecoBase/CandSliceHandle.h</a>&gt;</span>
00015 
00016 <span class="preprocessor">#include &lt;<a class="code" href="PlexSEIdAltL_8h.html">Plex/PlexSEIdAltL.h</a>&gt;</span>
00017 <span class="preprocessor">#include &lt;<a class="code" href="PlexVetoShieldHack_8h.html">Plex/PlexVetoShieldHack.h</a>&gt;</span>
00018 <span class="preprocessor">#include &lt;<a class="code" href="ZoomPad_8h.html">Midad/Base/ZoomPad.h</a>&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="Range_8h.html">Midad/Util/Range.h</a>&gt;</span>
00020 
00021 <span class="preprocessor">#include &lt;<a class="code" href="MsgService_8h.html">MessageService/MsgService.h</a>&gt;</span>
00022 <a class="code" href="MsgService_8h.html#a3">CVSID</a>(<span class="stringliteral">"$Id: GfxDigit.cxx,v 1.14 2005/11/10 17:01:05 musser Exp $"</span>);
00023 
00024 <span class="preprocessor">#include &lt;TEllipse.h&gt;</span>
00025 <span class="preprocessor">#include &lt;TBox.h&gt;</span>
00026 <span class="preprocessor">#include &lt;TPolyLine.h&gt;</span>
00027 <span class="preprocessor">#include &lt;TPad.h&gt;</span>
00028 
00029 <span class="preprocessor">#include &lt;iostream&gt;</span>
00030 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00031 
00032 ClassImp(<a class="code" href="classGfxDigit.html">GfxDigit</a>)
00033 
00034 #<span class="keywordflow">if</span> 0
00035 <a class="code" href="classGfxDigit.html#a0">GfxDigit::GfxDigit</a>()
00036     : fDigit(0)
00037       ,fParent(0)
00038       ,fImp(0)
00039 {
00040 }
00041 <span class="preprocessor">#endif</span>
<a name="l00042"></a><a class="code" href="classGfxDigit.html#a0">00042</a> <span class="preprocessor"></span><a class="code" href="classGfxDigit.html#a0">GfxDigit::GfxDigit</a>(<span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; csh, <a class="code" href="classGfxDigitList.html">GfxDigitList</a>&amp; parent)
00043     : fDigit(&amp;csh)
00044       ,fItem(0)
00045       ,fParent(&amp;parent)
00046       ,fImp(0)
00047 {
00048 }
<a name="l00049"></a><a class="code" href="classGfxDigit.html#a1">00049</a> <a class="code" href="classGfxDigit.html#a0">GfxDigit::GfxDigit</a>(<span class="keyword">const</span> <a class="code" href="classCandDigitHandle.html">CandDigitHandle</a>&amp; csh, 
00050                    <span class="keyword">const</span> <a class="code" href="classPlexSEIdAltLItem.html">PlexSEIdAltLItem</a>&amp; itm, <a class="code" href="classGfxDigitList.html">GfxDigitList</a>&amp; parent)
00051     : fDigit(&amp;csh)
00052       ,fItem(&amp;itm)
00053       ,fParent(&amp;parent)
00054       ,fImp(0)
00055 {
00056 <span class="comment">//   if (fItem) {</span>
00057 <span class="comment">//     PlexStripEndId seid = fItem-&gt;GetSEId(); </span>
00058 <span class="comment">//     MSG("Midad",Msg::kInfo) &lt;&lt; "fItem on " &lt;&lt; seid.AsString() &lt;&lt; endl;</span>
00059 <span class="comment">//  }</span>
00060 }
<a name="l00061"></a><a class="code" href="classGfxDigit.html#a2">00061</a> <a class="code" href="classGfxDigit.html#a0">GfxDigit::GfxDigit</a>(<span class="keyword">const</span> <a class="code" href="classGfxDigit.html">GfxDigit</a>&amp; rhs)
00062   : TObject()
00063     ,fDigit(rhs.fDigit), fItem(rhs.fItem), fParent(rhs.fParent), fImp(0)
00064 {
00065 }
<a name="l00066"></a><a class="code" href="classGfxDigit.html#a3">00066</a> <a class="code" href="classGfxDigit.html">GfxDigit</a>&amp; <a class="code" href="classGfxDigit.html#a3">GfxDigit::operator=</a>(<span class="keyword">const</span> <a class="code" href="classGfxDigit.html">GfxDigit</a>&amp; rhs)
00067 {
00068     <span class="keywordflow">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00069     <a class="code" href="classGfxDigit.html#r0">fDigit</a> = rhs.<a class="code" href="classGfxDigit.html#r0">fDigit</a>;
00070     <a class="code" href="classGfxDigit.html#r1">fItem</a> = rhs.<a class="code" href="classGfxDigit.html#r1">fItem</a>;
00071     <a class="code" href="classGfxDigit.html#r2">fParent</a> = rhs.<a class="code" href="classGfxDigit.html#r2">fParent</a>;
00072     <a class="code" href="classGfxDigit.html#r3">fImp</a> = 0;
00073     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00074 }
00075 
<a name="l00076"></a><a class="code" href="classGfxDigit.html#a4">00076</a> <a class="code" href="classGfxDigit.html#a4">GfxDigit::~GfxDigit</a>()
00077 {
00078   this-&gt;<a class="code" href="classGfxDigit.html#a5">Clear</a>();
00079 }
00080 
<a name="l00081"></a><a class="code" href="classGfxDigit.html#a19">00081</a> <span class="keywordtype">void</span> <a class="code" href="classGfxDigit.html#a5">GfxDigit::Clear</a>(<span class="keyword">const</span> Option_t*)
00082 {
00083   <span class="keywordflow">if</span> (<a class="code" href="classGfxDigit.html#r3">fImp</a>) <span class="keyword">delete</span> <a class="code" href="classGfxDigit.html#r3">fImp</a>; <a class="code" href="classGfxDigit.html#r3">fImp</a>=0;
00084 }
00085 
<a name="l00086"></a><a class="code" href="classGfxDigit.html#d0">00086</a> <span class="keywordtype">bool</span> <a class="code" href="classGfxDigit.html#d0">GfxDigit::GetRealCoords</a>(<span class="keywordtype">double</span>&amp; cx, <span class="keywordtype">double</span>&amp; cy, <span class="keywordtype">double</span>&amp; dx, <span class="keywordtype">double</span>&amp; dy)
00087 {
00088     <a class="code" href="classUgliGeomHandle.html">UgliGeomHandle</a> ugh(*<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandHandle.html#a27">GetVldContext</a>());
00089     <a class="code" href="classUgliStripHandle.html">UgliStripHandle</a> ush;
00090     <span class="keywordflow">if</span> (!<a class="code" href="classGfxDigit.html#r1">fItem</a>) {
00091       ush = ugh.<a class="code" href="classUgliGeomHandle.html#a12">GetStripHandle</a>(<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a8">GetBestItem</a>().<a class="code" href="classPlexSEIdAltLItem.html#a4">GetSEId</a>());
00092     }
00093     <span class="keywordflow">else</span> {
00094       ush = ugh.<a class="code" href="classUgliGeomHandle.html#a12">GetStripHandle</a>(<a class="code" href="classGfxDigit.html#r1">fItem</a>-&gt;<a class="code" href="classPlexSEIdAltLItem.html#a4">GetSEId</a>());
00095     }
00096     
00097     <span class="keywordflow">if</span>(!<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a17">IsVetoShield</a>()){      
00098       
00099       <span class="keywordflow">if</span> (!ush.<a class="code" href="classUgliStripHandle.html#a7">IsValid</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00100       cx = ush.<a class="code" href="classUgliStripHandle.html#a20">GlobalPos</a>(0).Z();
00101       cy = ush.<a class="code" href="classUgliStripHandle.html#a13">GetTPos</a>();
00102       dx = 1.5*ush.<a class="code" href="classUgliStripHandle.html#a11">GetHalfThickness</a>();
00103       dy = 1.5*ush.<a class="code" href="classUgliStripHandle.html#a12">GetHalfWidth</a>();
00104       <span class="keywordflow">return</span> <span class="keyword">true</span>;
00105     }
00106     <span class="keywordflow">else</span>{
00107       <span class="keywordflow">if</span> (!ush.<a class="code" href="classUgliStripHandle.html#a7">IsValid</a>())<span class="keywordflow">return</span> <span class="keyword">false</span>;
00108       TVector3 stripxyz0(ush.<a class="code" href="classUgliStripHandle.html#a20">GlobalPos</a>(-ush.<a class="code" href="classUgliStripHandle.html#a10">GetHalfLength</a>()));
00109       TVector3 stripxyz1(ush.<a class="code" href="classUgliStripHandle.html#a20">GlobalPos</a>(ush.<a class="code" href="classUgliStripHandle.html#a10">GetHalfLength</a>()));
00110      
00111       cx = 0.5*(stripxyz0[0]+stripxyz1[0]);
00112       cy = 0.5*(stripxyz0[1]+stripxyz1[1]);     
00113       dy = 1.5*ush.<a class="code" href="classUgliStripHandle.html#a11">GetHalfThickness</a>();
00114       dx = 1.5*ush.<a class="code" href="classUgliStripHandle.html#a12">GetHalfWidth</a>();
00115       <span class="keywordflow">return</span> <span class="keyword">true</span>;
00116     }
00117 }
00118 
00119 
<a name="l00120"></a><a class="code" href="classGfxDigit.html#d1">00120</a> <span class="keywordtype">bool</span> <a class="code" href="classGfxDigit.html#d1">GfxDigit::GetDiscreteCoords</a>(<span class="keywordtype">double</span>&amp; cx, <span class="keywordtype">double</span>&amp; cy, <span class="keywordtype">double</span>&amp; dx, <span class="keywordtype">double</span>&amp; dy)
00121 {
00122     <a class="code" href="classPlexStripEndId.html">PlexStripEndId</a> seid;
00123 
00124     <span class="keywordflow">if</span> (!<a class="code" href="classGfxDigit.html#r1">fItem</a>) {
00125         seid = <a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a8">GetBestItem</a>().<a class="code" href="classPlexSEIdAltLItem.html#a4">GetSEId</a>();
00126     }
00127     <span class="keywordflow">else</span> {
00128         seid = <a class="code" href="classGfxDigit.html#r1">fItem</a>-&gt;<a class="code" href="classPlexSEIdAltLItem.html#a4">GetSEId</a>();
00129     }
00130     cx = seid.<a class="code" href="classPlexPlaneId.html#a7">GetPlane</a>();
00131     cy = seid.<a class="code" href="classPlexStripEndId.html#a8">GetStrip</a>();
00132     dx = 0.15;
00133     dy = 0.75;
00134     <span class="keywordflow">if</span> (<a class="code" href="classGfxDigit.html#r1">fItem</a>) 
00135         <a class="code" href="MsgService_8h.html#a4">MSG</a>(<span class="stringliteral">"Midad"</span>,Msg::kVerbose) &lt;&lt; seid.<a class="code" href="classPlexStripEndId.html#a6">AsString</a>() 
00136                                    &lt;&lt; <span class="stringliteral">" cx = "</span> &lt;&lt; cx  
00137                                    &lt;&lt; <span class="stringliteral">" cy = "</span> &lt;&lt; cy &lt;&lt; endl;
00138     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00139 }
00140 
<a name="l00141"></a><a class="code" href="classGfxDigit.html#d2">00141</a> <span class="keywordtype">float</span> <a class="code" href="classGfxDigit.html#d2">GfxDigit::GetRelativeValue</a>(GfxDigitListCfg::MeasureScale_t ms)
00142 {
00143 
00144   <span class="keyword">const</span> <a class="code" href="classPlexSEIdAltL.html">PlexSEIdAltL</a>&amp; altl = <a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>();
00145   <span class="keywordflow">if</span> (ms == GfxDigitListCfg::kCharge) {
00146     <a class="code" href="classRange.html">RangeDouble</a>&amp; qrange = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a13">GetMint</a>().<a class="code" href="classMint.html#a24">GetChargeRange</a>();
00147     <span class="keywordtype">double</span> den = qrange.<a class="code" href="classRange.html#a6">Min</a>() - qrange.<a class="code" href="classRange.html#a7">Max</a>();
00148     <span class="keywordflow">if</span> (den &gt; 0)
00149       <span class="keywordflow">return</span> (altl.<a class="code" href="classPlexSEIdAltL.html#a8">GetBestItem</a>().<a class="code" href="classPlexSEIdAltLItem.html#a8">GetPE</a>() - qrange.<a class="code" href="classRange.html#a6">Min</a>()) / den;
00150   }
00151   <span class="keywordflow">else</span> {                      <span class="comment">// time</span>
00152     <a class="code" href="classRange.html">RangeDouble</a>&amp; trange = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a13">GetMint</a>().<a class="code" href="classMint.html#a22">GetTimeRange</a>();
00153     <span class="keywordtype">double</span> den = trange.<a class="code" href="classRange.html#a7">Max</a>() - trange.<a class="code" href="classRange.html#a6">Min</a>();
00154     <span class="keywordflow">if</span> (den &gt; 0)
00155       
00156       <span class="keywordflow">return</span> (altl.<a class="code" href="classPlexSEIdAltL.html#a8">GetBestItem</a>().<a class="code" href="classPlexSEIdAltLItem.html#a11">GetTime</a>() - trange.<a class="code" href="classRange.html#a6">Min</a>()) / den;
00157   }
00158   <span class="keywordflow">return</span> 1.0;
00159 }
00160 
<a name="l00161"></a><a class="code" href="classGfxDigit.html#d3">00161</a> <span class="keywordtype">void</span> <a class="code" href="classGfxDigit.html#d3">GfxDigit::ModifyCoords</a>(<span class="keywordtype">double</span>&amp; cx, <span class="keywordtype">double</span>&amp; cy, <span class="keywordtype">double</span>&amp; dx, <span class="keywordtype">double</span>&amp; dy)
00162 {
00163     <span class="keywordtype">int</span> strip_sign = 0;
00164     <span class="keywordflow">if</span>( <a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a17">IsVetoShield</a>()) <span class="keywordflow">return</span>;
00165     <a class="code" href="namespaceStripEnd.html#a0">StripEnd::StripEnd_t</a> end; 
00166     <span class="keywordflow">if</span> (!<a class="code" href="classGfxDigit.html#r1">fItem</a>) {
00167         end = <a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a8">GetBestItem</a>().<a class="code" href="classPlexSEIdAltLItem.html#a4">GetSEId</a>().<a class="code" href="classPlexStripEndId.html#a7">GetEnd</a>();
00168     }
00169     <span class="keywordflow">else</span> {
00170         end = <a class="code" href="classGfxDigit.html#r1">fItem</a>-&gt;<a class="code" href="classPlexSEIdAltLItem.html#a4">GetSEId</a>().<a class="code" href="classPlexStripEndId.html#a7">GetEnd</a>();
00171     }
00172     <span class="keywordflow">if</span> (end == StripEnd::kNegative) strip_sign = -1;
00173     <span class="keywordflow">if</span> (end == StripEnd::kPositive) strip_sign = +1;
00174 
00175     <a class="code" href="classGfxDigitListCfg.html">GfxDigitListCfg</a>&amp; cfg = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a7">GetCfg</a>();
00176     
00177     <span class="comment">// Scale down size of strip</span>
00178     GfxDigitListCfg::SizeBy_t sb = cfg.<a class="code" href="classGfxDigitListCfg.html#a4">GetSizeBy</a>();
00179     <span class="keywordtype">double</span> size_scale = this-&gt;<a class="code" href="classGfxDigit.html#d2">GetRelativeValue</a>(cfg.<a class="code" href="classGfxDigitListCfg.html#a2">GetSizeIs</a>());
00180 
00181     size_scale *= cfg.<a class="code" href="classGfxDigitListCfg.html#a0">GetSizeFactor</a>();
00182 
00183     <span class="keywordflow">switch</span> (sb) {
00184     <span class="keywordflow">case</span> GfxDigitListCfg::kFixed:
00185         <span class="comment">// nothing</span>
00186         <span class="keywordflow">break</span>;
00187     <span class="keywordflow">case</span> GfxDigitListCfg::kLinear:
00188         dx *= size_scale;
00189         dy *= size_scale;
00190         <span class="keywordflow">break</span>;
00191     <span class="keywordflow">case</span> GfxDigitListCfg::kLogLinear:
00192         dx *= <a class="code" href="Midad_2Util_2Util_8h.html#a0">logify_relative</a>(size_scale);
00193         dy *= <a class="code" href="Midad_2Util_2Util_8h.html#a0">logify_relative</a>(size_scale);
00194         <span class="keywordflow">break</span>;
00195     <span class="keywordflow">case</span> GfxDigitListCfg::kLogArea:
00196         dx *= <a class="code" href="Midad_2Util_2Util_8h.html#a0">logify_relative</a>(sqrt(size_scale));
00197         dy *= <a class="code" href="Midad_2Util_2Util_8h.html#a0">logify_relative</a>(sqrt(size_scale));
00198         <span class="keywordflow">break</span>;
00199     <span class="keywordflow">case</span> GfxDigitListCfg::kArea: <span class="keywordflow">default</span>:
00200         dx *= sqrt(size_scale);
00201         dy *= sqrt(size_scale);
00202         <span class="keywordflow">break</span>;
00203     }
00204 
00205     <span class="comment">// modify for any odd shape</span>
00206     GfxDigitListCfg::DigitEnd_t si = cfg.<a class="code" href="classGfxDigitListCfg.html#a1">GetStripEnd</a>();
00207     <span class="keywordflow">switch</span> (si) {
00208     <span class="keywordflow">case</span> GfxDigitListCfg::kHalf:
00209         dy *= strip_sign * 0.5;
00210         cy += dy;
00211         <span class="keywordflow">break</span>;
00212     <span class="keywordflow">case</span> GfxDigitListCfg::kBowTie:
00213         dx *= strip_sign * 0.5;
00214         dy *= strip_sign * 0.5;
00215         cx += dx;
00216         cy += dy;
00217         <span class="keywordflow">break</span>;
00218     <span class="keywordflow">case</span> GfxDigitListCfg::kFull: 
00219         <span class="comment">// fall through</span>
00220     <span class="keywordflow">case</span> GfxDigitListCfg::kBit:
00221         <span class="comment">// fall through</span>
00222     <span class="keywordflow">default</span>:
00223         <span class="comment">// do nothing</span>
00224         <span class="keywordflow">break</span>;
00225     }    
00226 }
00227 
<a name="l00228"></a><a class="code" href="classGfxDigit.html#d4">00228</a> <span class="keywordtype">bool</span> <a class="code" href="classGfxDigit.html#d4">GfxDigit::SetColor</a>(){
00229 
00230   <a class="code" href="classGfxDigit.html#r4">fColor</a> = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a11">GetDigitColor</a>(*<a class="code" href="classGfxDigit.html#r0">fDigit</a>); 
00231   <span class="keywordflow">if</span>(<a class="code" href="classGfxDigit.html#r1">fItem</a>)  {<a class="code" href="classGfxDigit.html#r4">fColor</a> = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a11">GetDigitColor</a>(*<a class="code" href="classGfxDigit.html#r0">fDigit</a>, *<a class="code" href="classGfxDigit.html#r1">fItem</a>);}
00232   Bool_t found=<span class="keyword">true</span>;
00233   <a class="code" href="classCandSliceHandle.html">CandSliceHandle</a> * slice = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a16">GetEVD</a>()-&gt;<a class="code" href="classEVD.html#a28">GetCandSlice</a>();
00234   <span class="keywordflow">if</span>(slice){
00235     found=<span class="keyword">false</span>;
00236     TIter stripItr(slice-&gt;<a class="code" href="classCandHandle.html#a18">GetDaughterIterator</a>());
00237     <span class="keywordflow">while</span> (<a class="code" href="classCandStripHandle.html">CandStripHandle</a> *strip = dynamic_cast&lt;CandStripHandle*&gt;
00238            (stripItr())){
00239       TIter digitItr(strip-&gt;<a class="code" href="classCandHandle.html#a18">GetDaughterIterator</a>());
00240       <span class="keywordflow">while</span> (<a class="code" href="classCandDigitHandle.html">CandDigitHandle</a> *dig=dynamic_cast&lt;CandDigitHandle*&gt;(digitItr())) {
00241         <span class="keywordflow">if</span>(dig-&gt;<a class="code" href="classCandDigitHandle.html#a5">GetChannelId</a>()==<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a5">GetChannelId</a>() &amp;&amp; dig-&gt;<a class="code" href="classCandDigitHandle.html#a9">GetRawDigitIndex</a>()==<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a9">GetRawDigitIndex</a>()){    
00242           found=<span class="keyword">true</span>;
00243           <span class="keywordflow">break</span>;
00244         }
00245       }
00246     }
00247   }
00248   <a class="code" href="classCandEventHandle.html">CandEventHandle</a> * ev = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a16">GetEVD</a>()-&gt;<a class="code" href="classEVD.html#a30">GetCandEvent</a>();
00249   <span class="keywordflow">if</span>(ev){
00250     found=<span class="keyword">false</span>;
00251     TIter stripItr(ev-&gt;<a class="code" href="classCandHandle.html#a18">GetDaughterIterator</a>());
00252     <span class="keywordflow">while</span> (<a class="code" href="classCandStripHandle.html">CandStripHandle</a> *strip = dynamic_cast&lt;CandStripHandle*&gt;
00253            (stripItr())){
00254       TIter digitItr(strip-&gt;<a class="code" href="classCandHandle.html#a18">GetDaughterIterator</a>());
00255       <span class="keywordflow">while</span> (<a class="code" href="classCandDigitHandle.html">CandDigitHandle</a> *dig=dynamic_cast&lt;CandDigitHandle*&gt;(digitItr())) {
00256         <span class="keywordflow">if</span>(dig-&gt;<a class="code" href="classCandDigitHandle.html#a5">GetChannelId</a>()==<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a5">GetChannelId</a>() &amp;&amp; dig-&gt;<a class="code" href="classCandDigitHandle.html#a9">GetRawDigitIndex</a>()==<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a9">GetRawDigitIndex</a>()){    
00257           found=<span class="keyword">true</span>;
00258           <span class="keywordflow">break</span>;
00259         }
00260       }
00261     }
00262   }
00263   <span class="keywordflow">if</span>(<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a6">GetCharge</a>(CalDigitType::kPE)&lt;5)<a class="code" href="classGfxDigit.html#r4">fColor</a>=10;
00264   <span class="keywordflow">if</span>(<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a6">GetCharge</a>(CalDigitType::kPE)&lt;2)<a class="code" href="classGfxDigit.html#r4">fColor</a>=20;
00265   <span class="keywordflow">if</span>(!found &amp;&amp; !<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a17">IsVetoShield</a>() )<a class="code" href="classGfxDigit.html#r4">fColor</a>=<a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a16">GetEVD</a>()-&gt;<a class="code" href="classEVD.html#a24">GetGhostColor</a>();
00266   <span class="keywordflow">if</span> (!<a class="code" href="classGfxDigit.html#r4">fColor</a>){
00267     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00268   }
00269   
00270   TAttFill* att_fill = dynamic_cast&lt;TAttFill*&gt;(<a class="code" href="classGfxDigit.html#r3">fImp</a>);
00271   <span class="keywordflow">if</span> (!att_fill) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00272   att_fill-&gt;SetFillColor(<a class="code" href="classGfxDigit.html#r4">fColor</a>);
00273   <span class="keywordflow">if</span> (!<a class="code" href="classGfxDigit.html#r1">fItem</a>) {
00274     att_fill-&gt;SetFillStyle(1001);
00275   }
00276   <span class="keywordflow">else</span> {
00277     att_fill-&gt;SetFillStyle(0);
00278     <span class="keyword">const</span> <a class="code" href="classPlexSEIdAltLItem.html">PlexSEIdAltLItem</a>&amp; best = <a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a8">GetBestItem</a>();
00279     <span class="keywordflow">if</span> ( <a class="code" href="classGfxDigit.html#r1">fItem</a> == &amp;best ) att_fill-&gt;SetFillStyle(1001); 
00280   }
00281   <span class="keywordflow">if</span>(<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a17">IsVetoShield</a>()) att_fill-&gt;SetFillStyle(1001);
00282   TAttLine* att_line = dynamic_cast&lt;TAttLine*&gt;(<a class="code" href="classGfxDigit.html#r3">fImp</a>);
00283   <span class="keywordflow">if</span> (!att_line) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00284   att_line-&gt;SetLineColor(<a class="code" href="classGfxDigit.html#r4">fColor</a>);
00285   att_line-&gt;SetLineWidth(1);
00286   
00287   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00288 }
00289 
<a name="l00290"></a><a class="code" href="classGfxDigit.html#a6">00290</a> <span class="keywordtype">void</span> <a class="code" href="classGfxDigit.html#a6">GfxDigit::Configure</a>()
00291 {
00292     <span class="comment">// here we make our imp.</span>
00293     <span class="keywordflow">if</span> (<a class="code" href="classGfxDigit.html#r3">fImp</a>) { <span class="keyword">delete</span> <a class="code" href="classGfxDigit.html#r3">fImp</a>; <a class="code" href="classGfxDigit.html#r3">fImp</a> = 0; }
00294 
00295     <a class="code" href="classGfxDigitListCfg.html">GfxDigitListCfg</a>&amp; cfg = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a7">GetCfg</a>();
00296 
00297     <a class="code" href="classGfxDigit.html#r5">fCx</a> = <a class="code" href="classGfxDigit.html#r6">fCy</a> = <a class="code" href="classGfxDigit.html#r7">fDx</a> = <a class="code" href="classGfxDigit.html#r8">fDy</a> = 0.0;
00298     <span class="keywordflow">if</span>((<a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxBase.html#a5">GetGraphicsView</a>() == GraphicsView::kXY || 
00299        <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxBase.html#a5">GetGraphicsView</a>() == GraphicsView::kUV) &amp;&amp;  (!<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a17">IsVetoShield</a>()))<span class="keywordflow">return</span>;
00300     
00301     <span class="keywordflow">switch</span> (<a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxBase.html#a9">GetViewState</a>()-&gt;<a class="code" href="classViewState.html#a11">GetSpatialMetric</a>()) {
00302     <span class="keywordflow">case</span> ViewState::metric_is_continuous:
00303         this-&gt;<a class="code" href="classGfxDigit.html#d0">GetRealCoords</a>(<a class="code" href="classGfxDigit.html#r5">fCx</a>,fCy,fDx,fDy);
00304         <span class="keywordflow">break</span>;
00305     <span class="keywordflow">case</span> ViewState::metric_is_discreet: <span class="keywordflow">default</span>:
00306         this-&gt;<a class="code" href="classGfxDigit.html#d1">GetDiscreteCoords</a>(<a class="code" href="classGfxDigit.html#r5">fCx</a>,fCy,fDx,fDy);
00307         <span class="keywordflow">break</span>;
00308     }
00309 
00310 
00311     <span class="keywordtype">double</span> dx = fDx, dy = fDy;
00312     <span class="keywordflow">if</span> (cfg.<a class="code" href="classGfxDigitListCfg.html#a3">GetScaleIs</a>() == GfxDigitListCfg::kAbsolute) {
00313         fDx = 1.0;
00314         fDy = 4.0;
00315         this-&gt;<a class="code" href="classGfxDigit.html#d3">ModifyCoords</a>(<a class="code" href="classGfxDigit.html#r5">fCx</a>,fCy,fDx,fDy);
00316         this-&gt;<a class="code" href="classGfxDigit.html#d5">RelToAbs</a>(dx,dy);
00317     }
00318     <span class="keywordflow">else</span> {
00319         this-&gt;<a class="code" href="classGfxDigit.html#d3">ModifyCoords</a>(<a class="code" href="classGfxDigit.html#r5">fCx</a>,fCy,fDx,fDy);
00320     }
00321 
00322     <span class="keywordflow">switch</span> (cfg.<a class="code" href="classGfxDigitListCfg.html#a5">GetShapeIs</a>()) {
00323     <span class="keywordflow">case</span> GfxDigitListCfg::kEllipse: 
00324         <a class="code" href="classGfxDigit.html#r3">fImp</a> = <span class="keyword">new</span> TEllipse(<a class="code" href="classGfxDigit.html#r5">fCx</a>,fCy,dx,dy);
00325         <span class="keywordflow">break</span>;
00326     <span class="keywordflow">default</span>:
00327       <span class="keywordflow">if</span>(!<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a17">IsVetoShield</a>()){
00328         <a class="code" href="classGfxDigit.html#r3">fImp</a> = <span class="keyword">new</span> TBox(<a class="code" href="classGfxDigit.html#r5">fCx</a>+dx,fCy+dy,<a class="code" href="classGfxDigit.html#r5">fCx</a>-dx,fCy-dy);
00329       }
00330       <span class="keywordflow">else</span> {
00331         Double_t dylist[5] = {-dy,-dy,dy,dy,-dy};
00332         Double_t dxlist[5] = {-dx,dx,dx,-dx,-dx};
00333         Double_t rot=0.9;
00334         <span class="keywordflow">if</span>(<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a21">GetPlaneView</a>()==PlaneView::kVSWallOnEdge){
00335           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> id=0;id&lt;6;id++){
00336             <span class="keywordtype">double</span> tmp=dylist[id];
00337             dylist[id]=dxlist[id];
00338             dxlist[id]=tmp;
00339           }
00340         }
00341         <span class="keywordflow">if</span>(<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a21">GetPlaneView</a>()==PlaneView::kVSTopEastSlant){
00342           <span class="keywordtype">double</span> newdx;
00343           <span class="keywordtype">double</span> newdy;
00344           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> id=0;id&lt;6;id++){
00345             newdx=dxlist[id]*cos(-rot)+dylist[id]*sin(-rot);
00346             newdy=-dxlist[id]*sin(-rot)+dylist[id]*cos(-rot);
00347             dxlist[id]=newdx;
00348             dylist[id]=newdy;
00349           }
00350         }
00351         <span class="keywordflow">if</span>(<a class="code" href="classGfxDigit.html#r0">fDigit</a>-&gt;<a class="code" href="classCandDigitHandle.html#a7">GetPlexSEIdAltL</a>().<a class="code" href="classPlexSEIdAltL.html#a21">GetPlaneView</a>()==PlaneView::kVSTopWestSlant){
00352           <span class="keywordtype">double</span> newdx;
00353           <span class="keywordtype">double</span> newdy;
00354           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> id=0;id&lt;6;id++){
00355             newdx=dxlist[id]*cos(rot)+dylist[id]*sin(rot);
00356             newdy=-dxlist[id]*sin(rot)+dylist[id]*cos(rot);
00357             dxlist[id]=newdx;
00358             dylist[id]=newdy;
00359           }       
00360         }
00361         Double_t xbox[5]={<a class="code" href="classGfxDigit.html#r5">fCx</a>+dxlist[0],<a class="code" href="classGfxDigit.html#r5">fCx</a>+dxlist[1],<a class="code" href="classGfxDigit.html#r5">fCx</a>+dxlist[2],<a class="code" href="classGfxDigit.html#r5">fCx</a>+dxlist[3],<a class="code" href="classGfxDigit.html#r5">fCx</a>+dxlist[0]};
00362         Double_t ybox[5]={fCy+dylist[0],fCy+dylist[1],fCy+dylist[2],fCy+dylist[3],fCy+dylist[0]};
00363         <a class="code" href="classGfxDigit.html#r3">fImp</a> = <span class="keyword">new</span> TPolyLine(5,xbox,ybox);
00364       }
00365       <span class="keywordflow">break</span>;
00366     }
00367 }
00368 
00369 
<a name="l00370"></a><a class="code" href="classGfxDigit.html#a7">00370</a> <span class="keywordtype">void</span> <a class="code" href="classGfxDigit.html#a7">GfxDigit::ExecuteEvent</a>(<span class="keywordtype">int</span> event, <span class="keywordtype">int</span> px, <span class="keywordtype">int</span> py)
00371 {
00372     <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a5">ExecuteEvent</a>(event,px,py,<span class="keyword">this</span>);
00373 }
<a name="l00374"></a><a class="code" href="classGfxDigit.html#a8">00374</a> <span class="keywordtype">void</span> <a class="code" href="classGfxDigit.html#a8">GfxDigit::Paint</a>(Option_t* option)
00375 {
00376     <span class="keywordflow">if</span> (!<a class="code" href="classGfxDigit.html#r3">fImp</a>) <span class="keywordflow">return</span>;
00377     <span class="keywordflow">if</span> (<a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a15">DigitsHidden</a>()) <span class="keywordflow">return</span>;
00378     <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classGfxDigit.html#d4">SetColor</a>()) <span class="keywordflow">return</span>;
00379 
00380     <a class="code" href="classGfxDigitListCfg.html">GfxDigitListCfg</a>&amp; cfg = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a7">GetCfg</a>();
00381     <span class="keywordflow">if</span> (cfg.<a class="code" href="classGfxDigitListCfg.html#a3">GetScaleIs</a>() == GfxDigitListCfg::kAbsolute) {
00382         <span class="keywordtype">double</span> dx, dy;
00383         this-&gt;<a class="code" href="classGfxDigit.html#d5">RelToAbs</a>(dx,dy);
00384         <span class="keywordflow">switch</span> (cfg.<a class="code" href="classGfxDigitListCfg.html#a5">GetShapeIs</a>()) {
00385         <span class="keywordflow">case</span> GfxDigitListCfg::kEllipse: {
00386             TEllipse* el= dynamic_cast&lt;TEllipse*&gt;(<a class="code" href="classGfxDigit.html#r3">fImp</a>);
00387             el-&gt;SetR1(dx);
00388             el-&gt;SetR2(dy);
00389             el-&gt;Paint(<a class="code" href="rerootjob_8cc.html#a5">option</a>);
00390            <span class="keywordflow">break</span>;
00391         }
00392         <span class="keywordflow">default</span>:
00393             TBox* box = dynamic_cast&lt;TBox*&gt;(<a class="code" href="classGfxDigit.html#r3">fImp</a>);
00394             box-&gt;SetX1(<a class="code" href="classGfxDigit.html#r5">fCx</a>+dx);
00395             box-&gt;SetY1(<a class="code" href="classGfxDigit.html#r6">fCy</a>+dy);
00396             box-&gt;SetX2(<a class="code" href="classGfxDigit.html#r5">fCx</a>-dx);
00397             box-&gt;SetY2(<a class="code" href="classGfxDigit.html#r6">fCy</a>-dy);
00398             box-&gt;Paint();
00399             <span class="keywordflow">break</span>;
00400         }
00401     }
00402     <span class="keywordflow">else</span> {
00403         <a class="code" href="classGfxDigit.html#r3">fImp</a>-&gt;Paint(<a class="code" href="rerootjob_8cc.html#a5">option</a>);
00404     }
00405 }
00406 
<a name="l00407"></a><a class="code" href="classGfxDigit.html#a9">00407</a> <span class="keywordtype">int</span> <a class="code" href="classGfxDigit.html#a9">GfxDigit::DistancetoPrimitive</a>(<span class="keywordtype">int</span> px, <span class="keywordtype">int</span> py)
00408 {
00409     <span class="keywordflow">if</span> (<a class="code" href="classGfxDigit.html#r3">fImp</a>) <span class="keywordflow">return</span> <a class="code" href="classGfxDigit.html#r3">fImp</a>-&gt;DistancetoPrimitive(px,py);
00410     <span class="keywordflow">return</span> 0xdead;
00411 }
00412 
<a name="l00413"></a><a class="code" href="classGfxDigit.html#d5">00413</a> <span class="keywordtype">void</span> <a class="code" href="classGfxDigit.html#d5">GfxDigit::RelToAbs</a>(<span class="keywordtype">double</span>&amp; dx, <span class="keywordtype">double</span>&amp; dy)
00414 {
00415     dx = gPad-&gt;AbsPixeltoX((<span class="keywordtype">int</span>)<a class="code" href="classGfxDigit.html#r7">fDx</a>) - gPad-&gt;AbsPixeltoX(0);
00416     dy = gPad-&gt;AbsPixeltoY((<span class="keywordtype">int</span>)<a class="code" href="classGfxDigit.html#r8">fDy</a>) - gPad-&gt;AbsPixeltoY(0);
00417 <span class="comment">//    cerr &lt;&lt; Form("dx=%f(%f)  dy=%f(%f)",fDx,dx,fDy,dy) &lt;&lt; endl;</span>
00418 }
00419 
<a name="l00420"></a><a class="code" href="classGfxDigit.html#a12">00420</a> <span class="keywordtype">void</span> <a class="code" href="classGfxDigit.html#a12">GfxDigit::ConfigGui</a>(<span class="keywordtype">void</span>)
00421 {
00422     <span class="keywordflow">if</span> (!<a class="code" href="classGfxDigit.html#r2">fParent</a>) <span class="keywordflow">return</span>;
00423     <a class="code" href="classGfxDigitListCfg.html">GfxDigitListCfg</a>&amp; cfg = <a class="code" href="classGfxDigit.html#r2">fParent</a>-&gt;<a class="code" href="classGfxDigitList.html#a7">GetCfg</a>();
00424     cfg.<a class="code" href="classGfxCfg.html#a3">GuiConfig</a>();
00425 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Feb 16 04:50:37 2009 for loon by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
