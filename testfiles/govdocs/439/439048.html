<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>HitBinSE.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>HitBinSE.cxx</h1><a href="HitBinSE_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="preprocessor">#include "<a class="code" href="HitBinSE_8h.html">Midad/HitBinSE.h</a>"</font>
00002 <font class="preprocessor">#include "<a class="code" href="Midad_2DigitListModel_8h.html">Midad/DigitListModel.h</a>"</font>
00003 <font class="preprocessor">#include "<a class="code" href="DigitListScenery_8h.html">Midad/DigitListScenery.h</a>"</font>
00004 <font class="preprocessor">#include "<a class="code" href="Range_8h.html">Midad/Range.h</a>"</font>
00005 <font class="preprocessor">#include "<a class="code" href="Scene_8h.html">Midad/Scene.h</a>"</font>
00006 <font class="preprocessor">#include "<a class="code" href="UgliGeomHandle_8h.html">UgliGeometry/UgliGeomHandle.h</a>"</font>
00007 <font class="preprocessor">#include "<a class="code" href="UgliStripHandle_8h.html">UgliGeometry/UgliStripHandle.h</a>"</font>
00008 <font class="preprocessor">#include "<a class="code" href="CandDigitHandle_8h.html">CandDigit/CandDigitHandle.h</a>"</font>
00009 <font class="preprocessor">#include "<a class="code" href="Munits_8h.html">Conventions/Munits.h</a>"</font>
00010 
00011 <font class="comment">//#if __GNUC_MINOR__ &gt; 91</font>
00012 <font class="preprocessor">#if 0</font>
00013 <font class="preprocessor"></font><font class="preprocessor">#include &lt;sstream&gt;</font>
00014 <font class="preprocessor">#else</font>
00015 <font class="preprocessor"></font><font class="preprocessor">#include "TString.h"</font>
00016 <font class="preprocessor">#endif</font>
00017 <font class="preprocessor"></font>
<a name="l00018"></a><a class="code" href="classMidad_1_1HitBinSE.html#p0">00018</a> <font class="keyword">const</font> <font class="keywordtype">char</font>* <font class="keyword">const</font> <a class="code" href="classMidad_1_1HitBinSE.html#p0">Midad::HitBinSE::MeasureTypeString</a>[] = {
00019     <font class="stringliteral">"Charge"</font>,
00020     <font class="stringliteral">"Time"</font>,
00021     0
00022 };
<a name="l00023"></a><a class="code" href="classMidad_1_1HitBinSE.html#p1">00023</a> <font class="keyword">const</font> <font class="keywordtype">char</font>* <font class="keyword">const</font> <a class="code" href="classMidad_1_1HitBinSE.html#p1">Midad::HitBinSE::EndTypeString</a>[] = {
00024     <font class="stringliteral">"Full"</font>,
00025     <font class="stringliteral">"SideBySide"</font>,
00026     0
00027 };
00028 
<a name="l00029"></a><a class="code" href="classMidad_1_1HitBinSE.html#a0">00029</a> <a class="code" href="classMidad_1_1HitBinSE.html#a0">Midad::HitBinSE::HitBinSE</a>(<a class="code" href="classMidad_1_1DigitListScenery.html">DigitListScenery</a>* dls, <a class="code" href="classMidad_1_1HitList.html">HitList</a>&amp; hl)
00030     : fParent(dls),
00031       fHitList(hl),
00032       fInfo("")
00033 {
00034 }
<a name="l00035"></a><a class="code" href="classMidad_1_1HitBinSE.html#a1">00035</a> <a class="code" href="classMidad_1_1HitBinSE.html#a1">Midad::HitBinSE::~HitBinSE</a>()
00036 {
00037 }
00038 
<a name="l00039"></a><a class="code" href="classMidad_1_1HitBinSE.html#a4">00039</a> <font class="keywordtype">void</font> <a class="code" href="classMidad_1_1HitBinSE.html#a4">Midad::HitBinSE::Configure</a>(<font class="keyword">const</font> <a class="code" href="structMidad_1_1HitBinSE_1_1HitBinStyle.html">HitBinStyle</a>&amp; style)
00040 {
00041     <a class="code" href="classMidad_1_1DigitListModel.html">DigitListModel</a>* dlm = <a class="code" href="classMidad_1_1HitBinSE.html#o0">fParent</a>-&gt;<a class="code" href="classMidad_1_1DigitListScenery.html#a3">GetDigitList</a>();
00042     <font class="keywordflow">if</font> (!dlm) <font class="keywordflow">return</font>;
00043 
00044     <font class="comment">// Physical center position and size</font>
00045     <font class="keywordtype">double</font> loc, height, half_width;
00046     <font class="keywordtype">bool</font> rotated = <font class="keyword">false</font>;
00047     <font class="keywordtype">double</font> value;
00048     <font class="keyword">const</font> <font class="keywordtype">char</font>* unit=0;
00049 
00050     Scene::SceneType scene_type = <a class="code" href="classMidad_1_1HitBinSE.html#o0">fParent</a>-&gt;<a class="code" href="classMidad_1_1Scenery.html#a11">GetScene</a>()-&gt;<a class="code" href="classMidad_1_1Scene.html#a13">GetSceneType</a>();
00051 
00052     <font class="keywordflow">switch</font> (style.<a class="code" href="structMidad_1_1HitBinSE_1_1HitBinStyle.html#m0">measure_type</a>) {
00053     <font class="keywordflow">case</font> <a class="code" href="classMidad_1_1HitBinSE.html#s4s0">kCharge</a>:
00054         height = <a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a5">GetCharge</a>();
00055         value = height;
00056         unit = <font class="stringliteral">"pe"</font>;
00057         <font class="keywordflow">break</font>;
00058     <font class="keywordflow">case</font> <a class="code" href="classMidad_1_1HitBinSE.html#s4s1">kTime</a>:
00059         height = <a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a7">GetFirstTime</a>();
00060         value = height/Munits::nanosecond;
00061         unit = <font class="stringliteral">"ns"</font>;
00062         <font class="keywordflow">break</font>;
00063     <font class="keywordflow">default</font>:
00064         <font class="keywordflow">return</font>;
00065     }
00066 
00067     <font class="keyword">const</font> <font class="keywordtype">char</font>* loc_unit = 0;
00068     <font class="keywordtype">double</font> loc_value;
00069     <font class="keywordflow">switch</font> (scene_type) {
00070     <font class="keywordflow">case</font>  Scene::kU: <font class="keywordflow">case</font> Scene::kV: {
00071         <a class="code" href="classUgliGeomHandle.html">UgliGeomHandle</a> ugh(*<a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>[0].first-&gt;GetVldContext());
00072         <a class="code" href="classUgliStripHandle.html">UgliStripHandle</a> ush = ugh.<a class="code" href="classUgliGeomHandle.html#a10">GetStripHandle</a>(<a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a4">GetSEId</a>());
00073         <font class="keywordflow">if</font> (!ush.<a class="code" href="classUgliStripHandle.html#a5">IsValid</a>()) <font class="keywordflow">return</font>;
00074         loc = ush.<a class="code" href="classUgliStripHandle.html#a11">GetTPos</a>();
00075         loc_value = loc/Munits::centimeter;
00076         loc_unit = <font class="stringliteral">"cm"</font>;
00077         half_width = ush.<a class="code" href="classUgliStripHandle.html#a10">GetHalfWidth</a>();
00078         rotated = <font class="keyword">true</font>;
00079         <font class="keywordflow">break</font>;
00080     }
00081     <font class="keywordflow">case</font> Scene::kUStrip: <font class="keywordflow">case</font> Scene::kVStrip:
00082         loc = <a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a4">GetSEId</a>().<a class="code" href="classPlexStripEndId.html#a8">GetStrip</a>();
00083         loc_value = loc;
00084         loc_unit = <font class="stringliteral">"strip"</font>;
00085         half_width = 0.5;
00086         rotated = <font class="keyword">true</font>;
00087         <font class="keywordflow">break</font>;
00088 
00089     <font class="keywordflow">case</font> Scene::kZ: {
00090         <a class="code" href="classUgliGeomHandle.html">UgliGeomHandle</a> ugh(*<a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>[0].first-&gt;GetVldContext());
00091         <a class="code" href="classUgliStripHandle.html">UgliStripHandle</a> ush = ugh.<a class="code" href="classUgliGeomHandle.html#a10">GetStripHandle</a>(<a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a4">GetSEId</a>());
00092         <font class="keywordflow">if</font> (!ush.<a class="code" href="classUgliStripHandle.html#a5">IsValid</a>()) <font class="keywordflow">return</font>;
00093         loc = ush.<a class="code" href="classUgliStripHandle.html#a16">GlobalPos</a>(0).Z();
00094         loc_value = loc/Munits::centimeter;
00095         loc_unit = <font class="stringliteral">"cm"</font>;
00096         half_width = ush.<a class="code" href="classUgliStripHandle.html#a9">GetHalfThickness</a>();
00097         rotated = <font class="keyword">false</font>;
00098         <font class="keywordflow">break</font>;
00099     }
00100     <font class="keywordflow">case</font> Scene::kZPlane:
00101         loc = <a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a4">GetSEId</a>().<a class="code" href="classPlexPlaneId.html#a7">GetPlane</a>();
00102         loc_value = loc;
00103         loc_unit = <font class="stringliteral">"plane"</font>;
00104         half_width = 0.5;
00105         rotated = <font class="keyword">false</font>;
00106         <font class="keywordflow">break</font>;
00107 
00108     <font class="keywordflow">case</font> Scene::kTime:
00109         loc = 0.5 + (int)(<a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a7">GetFirstTime</a>()/Munits::nanosecond);
00110         loc_value = loc;
00111         loc_unit = <font class="stringliteral">"ns"</font>;
00112         half_width = 0.5;
00113         rotated = <font class="keyword">false</font>;
00114         <font class="keywordflow">break</font>;
00115     <font class="keywordflow">default</font>:
00116         <font class="keywordflow">return</font>;
00117     }
00118 
00119 
00120     <font class="keywordflow">if</font> (style.<a class="code" href="structMidad_1_1HitBinSE_1_1HitBinStyle.html#m2">end_type</a> == <a class="code" href="classMidad_1_1HitBinSE.html#s5s3">kSideBySide</a>) {
00121         half_width *= 0.5;
00122         <font class="keywordflow">if</font> (<a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a4">GetSEId</a>().<a class="code" href="classPlexStripEndId.html#a7">GetEnd</a>() == <a class="code" href="classStripEnd.html#s11s2">StripEnd::kNegative</a>) 
00123             half_width  *= -1.0;
00124     }
00125 
00126     <font class="keywordtype">double</font> color, cmin, cmax, crel;
00127     <font class="keywordflow">switch</font> (style.<a class="code" href="structMidad_1_1HitBinSE_1_1HitBinStyle.html#m1">color_is</a>) {
00128     <font class="keywordflow">case</font> <a class="code" href="classMidad_1_1HitBinSE.html#s4s0">kCharge</a>:
00129         color = <a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a5">GetCharge</a>();
00130         cmin = dlm-&gt;<a class="code" href="classMidad_1_1DigitListModel.html#a2">GetChargeRange</a>()-&gt;<a class="code" href="classRange.html#a6">Min</a>();
00131         cmax = dlm-&gt;<a class="code" href="classMidad_1_1DigitListModel.html#a2">GetChargeRange</a>()-&gt;<a class="code" href="classRange.html#a7">Max</a>();
00132         <font class="keywordflow">break</font>;
00133     <font class="keywordflow">case</font> <a class="code" href="classMidad_1_1HitBinSE.html#s4s1">kTime</a>:
00134         color = <a class="code" href="classMidad_1_1HitBinSE.html#o1">fHitList</a>.<a class="code" href="classMidad_1_1HitList.html#a7">GetFirstTime</a>();
00135         cmin = dlm-&gt;<a class="code" href="classMidad_1_1DigitListModel.html#a4">GetTimeRange</a>()-&gt;<a class="code" href="classRange.html#a6">Min</a>();
00136         cmax = dlm-&gt;<a class="code" href="classMidad_1_1DigitListModel.html#a4">GetTimeRange</a>()-&gt;<a class="code" href="classRange.html#a7">Max</a>();
00137         <font class="keywordflow">break</font>;
00138     <font class="keywordflow">default</font>:
00139         <font class="keywordflow">return</font>;
00140     }
00141 
00142     crel = (color - cmin)/(cmax - cmin);
00143     <font class="keywordflow">if</font> (crel &gt; 1.0) crel=1.0;
00144 
00145     <font class="keywordtype">int</font> colnum = (int)(crel*49) + 51; <font class="comment">// funky ROOT color numbers</font>
00146 
00147     <font class="keywordflow">if</font> (style.<a class="code" href="structMidad_1_1HitBinSE_1_1HitBinStyle.html#m3">filled</a>) {
00148         this-&gt;SetFillColor(colnum);
00149         this-&gt;SetFillStyle(1001);
00150     }
00151     <font class="keywordflow">else</font> {
00152         this-&gt;SetLineColor(colnum);
00153         this-&gt;SetFillStyle(0);
00154         this-&gt;SetLineWidth(1);
00155     }
00156     <font class="keywordflow">if</font> (rotated) {
00157         this-&gt;SetX1(0.0);
00158         this-&gt;SetX2(height);
00159         this-&gt;SetY1(loc-half_width);
00160         this-&gt;SetY2(loc+half_width);
00161     }
00162     <font class="keywordflow">else</font> {
00163         this-&gt;SetX1(loc-half_width);
00164         this-&gt;SetX2(loc+half_width);
00165         this-&gt;SetY1(0.0);
00166         this-&gt;SetY2(height);
00167     }
00168 
00169 <font class="comment">//#if __GNUC_MINOR__ &gt; 91</font>
00170 <font class="preprocessor">#if 0</font>
00171 <font class="preprocessor"></font>    stringstream ss;
00172     ss &lt;&lt; height &lt;&lt; <font class="stringliteral">" "</font> &lt;&lt; unit &lt;&lt; <font class="stringliteral">" @ "</font> &lt;&lt; loc_value &lt;&lt; <font class="stringliteral">" "</font> &lt;&lt; loc_unit;
00173     <a class="code" href="classMidad_1_1HitBinSE.html#o2">fInfo</a> = ss.str();
00174 <font class="preprocessor">#else</font>
00175 <font class="preprocessor"></font>    TString ts;
00176     ts += height;
00177     ts += <font class="stringliteral">" "</font>;
00178     ts += unit;
00179     ts += <font class="stringliteral">" @ "</font>;
00180     ts += loc_value;
00181     ts += <font class="stringliteral">" "</font>;
00182     ts += loc_unit;
00183     <a class="code" href="classMidad_1_1HitBinSE.html#o2">fInfo</a> = ts.Data();
00184 <font class="preprocessor">#endif</font>
00185 <font class="preprocessor"></font>}
00186 
<a name="l00187"></a><a class="code" href="classMidad_1_1HitBinSE.html#a3">00187</a> <a class="code" href="structRange2D.html">RangeDouble2D</a> <a class="code" href="classMidad_1_1HitBinSE.html#a3">Midad::HitBinSE::GetBounds</a>() 
00188 {
00189     <a class="code" href="structRange2D.html">RangeDouble2D</a> rd2d(GetX1(),GetY1(),GetX2(),GetY2());
00190     <font class="keywordflow">return</font> rd2d;
00191 }
</pre></div><hr><address align="right"><small>Generated on Wed Sep 4 19:01:04 2002 for loon by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.16 </small></address>
</body>
</html>
